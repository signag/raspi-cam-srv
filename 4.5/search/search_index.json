{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Home","text":"<p>raspiCamSrv is a Web server for Raspberry Pi systems providing an App for control and streaming of CSI and USB cameras as well as for controlling a large variety of connected GPIO devices.</p> <p>While all currently connected cameras are accessible by the system, up to two cameras can be operated simultaneously at a time, supporting multi-camera features like Stereo Vision.</p> <p>Interoperability between Cameras and GPIO devices is achieved through the freely configurable event handling infrastructure.</p> <p>raspiCamSrv supports all Raspberry Pi platforms from Pi Zero to Pi 5, running Bullseye, Bookworm or Trixie OS.</p> <p>Besides the currently available Raspberry Pi cameras, also compatible CSI cameras from other providers can be used. USB web cams are seamlessly integrated.</p> <p>raspiCamSrv is built with Flask 3.x and uses the Picamera2 library.   Due to responsive layout from W3.CSS, all modern browsers on PC, Mac or mobile devices can be used as clients.</p> <p>For resources and latest version, refer to the raspiCamSrv GitHub Repository</p> <p></p>"},{"location":"API/","title":"raspiCamSrv API","text":"<p>The raspiCamSrv API allows access to several RaspberryPi camera functions through WebService endpoints.</p> <p>Configuration of the API is done on the Settings/API screen.</p>"},{"location":"API/#postman-test-collection","title":"Postman Test Collection","text":"<p>For testing the API, a Postman collection is available at docs/api/postman which can be downloaded and imported into a Postman instance.</p> <p></p>"},{"location":"API/#api-documentation","title":"API Documentation","text":"<p>The docs/api/postman folder contains also the API Documentation generated from Postman.</p>"},{"location":"API/#variables","title":"Variables","text":"<p>The collection uses a set of variables:</p> <p></p> <p><code>base_url</code>, <code>user</code> and <code>pwd</code> need to be adjusted to the current environment for a user which has been previously created in raspiCamSrv.</p> <p><code>access_token</code> and <code>refresh_token</code> will be automatically filled from responses of the /api/login and /api/refresh endpoints.</p>"},{"location":"API/#usage","title":"Usage","text":""},{"location":"API/#1-login","title":"1. Login","text":"<p>Use the <code>api login</code> request to log in to raspiCamSrv and receive an Access Token and a Refresh Token</p>"},{"location":"API/#2-interact-with-raspicamsrv","title":"2. Interact with raspiCamSrv","text":"<p>Use any of the GET requests to interact with raspiCamSrv.</p> <p>These requests use the Access Token for authentication.</p>"},{"location":"API/#3-refresh-the-access-token","title":"3. Refresh the Access Token","text":"<p>If a request returns a token expiration error, refresh the Access Token using the <code>api refresh</code> request.</p> <p>This will use the Refresh Token for authentication and return a fresh Access Token.</p>"},{"location":"Authentication/","title":"raspiCamSrv Authorization","text":"<p>Access to the raspiCamSrv server requires login with Username and Password.  A user session will live as long as the browser remains open, even if the tab with a raspiCamSrv dialog has been closed.</p> <p>The basic principle is that the first user in the system will be automatically registered as SuperUser. Only the SuperUser will be able to register new users or remove users from the system.</p> <p>After the database has been initialized with <code>flask --app raspiCamSrv init-db</code> (see RaspiCamSrv Installation) Step 11), there is no user in the database.</p> <p>In this situation, any connect to the server will open the Register screen:  </p> <p>Now, the SuperUser can complete his registration and will then be redirected to the Log In screen:   From now on, the Register screen will no longer be available through the menu.  Also, direct access through the Register screen URL will only be allowed for the SuperUser. Other users will be redirected to the Live screen.</p>"},{"location":"Authentication/#user-management","title":"User Management","text":"<p>For management of users, the Settings screen has an additional section Users which is visible only for the SuperUser:  </p> <p>The list shows all registered users with</p> <ul> <li>unique user ID</li> <li>user Name</li> <li>Initial, indicating whether the user has been initially created by the SuperUser and needs to change password on first log-in.</li> <li>SuperUser, indicating the user registered as SuperUser</li> </ul> <p>The SuperUser can</p> <ul> <li>register new users using the Register New User button</li> <li>remove users which have been selected in the list</li> </ul>"},{"location":"Authentication/#password","title":"Password","text":"<p>Users with flag \"Initial\" will automatically be requested to change their password when they log in for the first time.  All users can change their password before they are logged in.</p> <p>  After the password has been successfully changed, the Log In screen will be opened.</p>"},{"location":"Authentication/#old-user-schema","title":"Old User Schema","text":"<p>The functionality described above is available for systems installed after Feb. 15, 2024.  Systems installed before but updated (git pull) later, still work with the old user schema.</p> <p>In this case, all users are considered SuperUsers.</p> <p>The User Management functionality in the Settings screen will be available for all users.  However, a hint is shown to update the database schema:</p> <p></p>"},{"location":"Background%20Processes/","title":"raspiCamSrv Tasks and Background Processes","text":"<p>The figure below gives an overview of the different tasks available in raspiCamSrv and their relation to raspiCamSrv Configurations and camera strams.  For more information on the components, see the Picamera2 manual, chapter 4.2.</p> <p></p> <p>The tasks marked in green are executed in background processes (Threads) and may run simultaneously.</p> <p>The status of each of these processes is indicated with status indicators:</p> <p></p>"},{"location":"Background%20Processes/#default-configuration","title":"Default Configuration","text":"<p>The association between raspiCamSrv Configurations and camera streams shown in the figure above, is the default configuration.</p> <p>In addition, default values for other configuration parameters are harmonized in such a way that all background processes can run simultaneously.  This is especially important for the live stream which will remain active while a video is recorded, while photos are taken or while a Photo Series is executed.</p> <p>raspiCamSrv merges the different configurations to a single one which is applied when the camera is started.</p> <p>This requires that the following configuration parameters must have the same values for the different configurations:</p> <ul> <li>Transform</li> <li>Colour Space</li> <li>Queue</li> </ul> <p>The values for Buffer Count can be different. In the merge process, the largest number of buffers will be selected.</p>"},{"location":"Background%20Processes/#configuration-changes","title":"Configuration Changes","text":"<p>All configuration scan be changed, including the association between configuration and camera stream (except raw).</p> <p>If a configuration change, for example Transform, is made for a single configuration, for example Video, it is no longer possible to use a common configuration for all tasks.   </p> <p>If then, for example, a video is recorded, the video thread needs to run in exclusive mode because it cannot share configuration with the Live Stream. For this purpose:</p> <ol> <li>The Live Stream must be stopped and paused during video recording</li> <li>The Encoder for the Live Stream must be stopped</li> <li>The camera must be stopped</li> <li>The camera must be configured with the Video configuration</li> <li>The camera must be started</li> <li>The encoder for video must be started while the video is being recorded</li> <li>The encoder must be stopped when video recording is finished</li> <li>The camera must be stopped</li> <li>The camera must be configured for the LiveStream, including eventally compatible configurations</li> <li>The camera must be started</li> <li>The MJPEG encoder for Live Stream must be started</li> <li>The Live Stream Thread must be started</li> </ol> <p>In case of harmonized configurations, only steps 7 and 8 would have been required.</p>"},{"location":"Cam/","title":"Cam - Camera Usage","text":"<p>This menu gives access to the available high-level camera usage scenarios, in particular in the case of multiple cameras connected to a Raspberry Pi (currently only Pi 5 can connect two CSI cameras).</p> <p>When connecting USB cameras, in addition to CSI cameras, you can in principle, get access to as many cameras as you can connect. However, raspiCamSrv can only operate up to 2 cameras simultaneusly. </p> <p>So, you will need to select which of the connected cameras (see Information) shall be used as Active Camera and as Second Camera.</p> <ul> <li>The Web Cam dialog demonstrates how to stream video or image from your cameras.</li> <li>The Multi-Cam dialog allows controlling both cameras individually or synchronously.    (This dialog is only available for multi-camera systems)</li> <li>The Camera Calibration dialog can be used for calibration and rectification of stereo cameras.   (This dialog is only available if Stereo Vision is activated in the Settings dialog)</li> <li>The Stereo-Cam dialog can be used for visualization of depth maps as well as for viewing and recording of 3D videos.     (This dialog is only available if Stereo Vision is activated in the Settings) </li> </ul>"},{"location":"CamCalibration/","title":"Camera Calibration","text":"<p>This dialog allows calibration of the stereo camera system in order to improve the quality of the stereo result.</p> <p>NOTE:The dialog is only accessible if Stereo Vision has been activated.</p> <p>REMINDER: When finished with calibration you will need to Store Configuration in order to preserve the results over a server restart.</p> <p></p> <p>When opened without existing calibration data, the dialog allows configuring the calibration process:</p> <ul> <li>Calibration Pattern allows selecting the pattern to be used for calibration.   Currently, only the Chessboard pattern from OpenCV is supported.   This pattern needs to be printed or displayed on a tablet for being used during the calibration process.   </li> <li>Pattern Size specifies the number of columns and rows of identifiable vertices of the pattern. 9x6 is appropriate for the standard chessboard pattern. (Only the inner vertices count)</li> <li>In Number of Photos required you can specify how many photos you want to use for calibration.   The dialog allows selecting as few as 5 photos but this is only to see how quality decreases with the number of photos. 20-30 will be a better choice.</li> <li>Number of Photos taken will show the current number of photos.</li> <li>Rectify Scale is a parameter used during rectification.    \"Valid Pixels Only\" will include only valid pixels in the final result and will remove black areas.   \"All Pixels\" will include all pixels in the final result of transformed images.</li> </ul>"},{"location":"CamCalibration/#picture-taking","title":"Picture Taking","text":"<p>The process of photo taking is automatic:</p> <p>When the pattern is presented to the cameras so that it is fully visible in both cameras, the system will try to find the specified number of corners.  Only if this is successful, the image will be stored.  After 2 seconds, the next pair of images will be analyzed until sufficient photos have been taken.</p> <p>The process is started with button Start taking Pattern Photos which will request a confirmation:</p> <p></p> <p>and signal readiness to take a photo:</p> <p></p> <p>Now you need to bring the pattern in the visible area and slowly change its orientation and position within the image areas.</p> <p></p> <p>If not all required corners could be found at the current position, this will be indicated:</p> <p></p>"},{"location":"CamCalibration/#picture-review","title":"Picture Review","text":"<p>After all required pictures have been taken, camera streaming stops and the stored pictures are presented for being reviewed:</p> <p></p> <p>A navigation bar is shown which allows scrolling through the taken images.   Images with bad quality can be removed.</p> <p>Show Corners will present images where the found corners are shown:</p> <p></p> <p>If photos have been removed, the missing ones need to be filled up using button \"Continue taking Pattern Photos\" </p> <p></p> <p>Button Reset Calibration Photos will remove all photos and reset the calibration process after a confirmation.</p>"},{"location":"CamCalibration/#calibration","title":"Calibration","text":"<p>When the required number of photos have been taken, you can continue with calibration.</p> <p></p> <p>Display of the time of calibration as well as the RMS Re-Projection Error indicate that valid calibration data are available.</p> <p>The color with which the error is shown, (green, yellow, red) indicates the quality of the calibration:</p> <ul> <li>&lt; 0.5 px : excellent</li> <li>0.5 - 1 px : acceptable</li> <li> <p>1 px : poor</p> </li> </ul>"},{"location":"CamCalibration/#calibration-data-storage","title":"Calibration Data Storage","text":"<p>Calibration photos (with and without corners) are stored underneath the <code>raspiCamSrv/static</code> folder:</p> <p></p>"},{"location":"CamMulticam/","title":"Multi-Camera Control","text":"<p>NOTE: This dialog is only available for systems with two or more CSI or USB cameras connected (see Info).</p> <p>raspiCamSrv can simultaneously operate two cameras: the Active Camera and the Second Camera.  If more cameras are connected and available (usually USB cameras), Active and Second Camera must be selected out of these.</p> <p>While live streams for both cameras are shown, this dialog allows photo taking and video recording either individually with each of the two cameras or simultaneously with both.</p> <p></p> <p>The left side of the page always shows the active camera.</p> <p>The screenshot, above, shows a configuration with four available cameras.  If more than two cameras are available, the stream titles are dropdown lists from which you can select Active or Second Camera.   In every case, the other camera is not selectable because one camera cannot have two roles.</p> <p>If there are just two cameras available, the drop-down lists are replaced by normal text.</p> <p>When switching the cameras, either with the Switch Cameras button on this side or by changing the camera in the Settings, the streams will be exchanged.</p>"},{"location":"CamMulticam/#buttons","title":"Buttons","text":""},{"location":"CamMulticam/#photo-raw-video","title":"Photo / Raw / Video","text":"<p>Every camera has an own set of action buttons which apply only to this camera.  Their function is identical to that of the corresponding buttons on the Live screen</p> <p>The resulting photos or place holders will not be shown on this page.   They are stored in camera-specific subfolders and are accessible through the Photos dialog</p> <p>For the active camera, the last photo or placeholder is shown in the Photo Display of the Live screen and can be added to the display buffer for inspection of meta data or histogram..</p>"},{"location":"CamMulticam/#photo-both-raw-both-video-both","title":"Photo - Both / Raw - Both / Video - Both","text":"<p>When these buttons are pressed, the respective function is applied for both cameras.</p> <p>The media files will have the same name for both cameras, which is generated from the timestamp of command execution, but are stored in their camera-specific subfolder.   This allows identifying photos which have been synchronously taken and videos which have been synchronously started.</p> <p>NOTE: Currently, the actions on both cameras are executed sequentially, so that there may be a small subsecond delay.</p>"},{"location":"CamMulticam/#save-active-camera-settings-for-camera-switch","title":"Save Active Camera Settings for Camera Switch","text":"<p>This button stores the current Camera Configuration for all configurations as well as the current Controls settings for the active camera in a specific structure (streamingCfg) so that it can be reused for streaming in a case that the other camera has been activated.      In addition, also the camera-related settings of Trigger (Trigger/Motion and Trigger/Camera) will be stored in the streamingCfg.   (See also Configuring MJPEG Stream and jpeg Photo)</p>"},{"location":"CamMulticam/#synchronize-configurations","title":"Synchronize Configurations","text":"<p>This button is disabled if the two cameras are of different model.</p> <p>If they are the same model, the button can be used to transfer the configuration, controls and camera-related Trigger settings from the active camera to the second camera. This is especially useful in the case of Stereo Vision where both cameras should be operated with identical configuration.</p> <p>NOTE: the button does not save the settings for the active camera in the streamingCfg structure. This must be done explicitly and is recommended to be done before synchronizing.</p>"},{"location":"CamMulticam/#switch-cameras","title":"Switch Cameras","text":"<p>With this button, you can switch the cameras so that the one sown on the right side will become the active camera.</p> <p>In case you have made changes of Configuration, Controls or camera-related Trigger settings (Trigger/Motion and Trigger/Camera) which have not yet been saved for Camera Switch, there will be a warning:    To make sure your configuration changes survive the camera switxh, push Save Active Camera Settings for Camera Switch</p>"},{"location":"CamMulticam/#process-status-indicators","title":"Process Status Indicators","text":"<p>Process Status Indicators show whether a camera is currently recording video or not.  This is done independently for the active camera   and for the other camera .</p> <p>NOTE that the recording status indicators are also activated when recording is started through the API</p>"},{"location":"CamMulticam/#configuring-mjpeg-stream-and-jpeg-photo","title":"Configuring MJPEG Stream and jpeg Photo","text":"<p>With raspiCamSrv, Camera Configuration and Controls apply always to the active camera (which camera is the active one, can be selected in the Settings).</p> <p>When the Flask server starts up without preloading stored configurations, the active camera and, if available, the second camera are preconfigured with parameter defaults.</p> <p>The entire Camera Configuration as well as the Controls for both cameras are stored in a specific streaming datastructure.</p> <p>When Camera Configuration and/or Controls for the active camera are modified, these settings will not be automatically stored in the streaming configuration.   This must be actively done with the Save Active Camera Settings for Camera Switch.</p> <p>When cameras are switched, configuration and controls for the active camera will be replaced by those from the second camera stored in the streaming datastructure.</p> <p>In order to configure your camera setup, you can proceed as follows:</p> <ol> <li>Select one of the cameras as active camera</li> <li>Adjust the Camera Configuration,   for example Transform and/or Sensor Mode with Stream Size</li> <li>Adjust the Controls,   for example focus/lensposition, zoom, AutoExposure or others</li> <li>When the setup is satisfactory, go to the Multi-Cam dialog and press the Save Active Camera Settings for Camera Switch button.</li> <li>Then switch cameras with the &lt;&lt;&lt; Switch Cameras &gt;&gt;&gt; button.</li> <li>Repeat steps 2. to 4. for the other camera</li> <li>If you now switch cameras, each stream, photo, raw photo and video should show in the way specifically configured for the camera.</li> <li>Now you can go to the Settings screen and push the Store Configuration button in order to persist the streaming data along with the other configuration settings.</li> <li>If you want the entire configuration, including the streaming configuration, to be loaded when the server starts up, check the related checkbox in the Settings screen.</li> </ol>"},{"location":"CamStereo/","title":"Stereo-Cam","text":"<p>This dialog features stereo camera capabilities and can be used for visualizing Depth Maps and 3D Video. Both can also be streamed independently.</p> <p>NOTE:The dialog is only accessible if Stereo Vision has been activated.</p> <p></p>"},{"location":"CamStereo/#stereo-camera","title":"Stereo Camera","text":"<p>A precondition for Stereo Vision with raspiCamSrv is a system which allows connecting a pair of non-USB cameras of the same model.    These cameras need to be arranged as a stereo system with a typical human eye distance:</p> <p></p> <p>For a 3D-printable model, see Raspberry Pi Camera 3 Stereo Case</p> <p>NOTE: Stereo Vision needs to be activated in the Settings dialog.</p>"},{"location":"CamStereo/#implementation","title":"Implementation","text":"<p>Stereo Vision in raspiCamSrv is based on OpenCV and is inspired by a variety of examples on LearnOpenCV such as Making A Low-Cost Stereo Camera Using OpenCV, from which also part of the code has been adapted and integrated with raspiCamSrv.</p>"},{"location":"CamStereo/#depth-maps","title":"Depth Maps","text":"<p>(See Wikipedia article on Depth Maps)</p> <p>The Stereo-Cam dialog usually opens with the following layout:</p> <p></p> <p>When opening, the system starts the Live view for both cameras as indicated by the Process Status indicators and shows the streams of left and right camera in the upper part of the dialog.</p> <p>The lower left part allows configuration of the intended Stereo Vision:</p> <ul> <li>Intent distinguishes the basic intent and allows selection between Depth Map and 3D Video.</li> <li>Rectified Images, when activated uses the rectified images (see Camera Calibration) instead of the original ones to construct the stereo image.</li> <li>Algorithm allows selecting the Open CV algorithm to be used when constructing the depth map.</li> <li>Algorithm Reference links to the respective references in Open CV (Stereo Block Matching or Semi-Global Matching) where the parameters for the different algorithms are explained.</li> </ul> <p>Pushing Start with Depth Map selected as Intent, will start a background process which applies the algorithm to the images of left and right video stream to produce a stream of depth map images:</p> <p></p> <p>The activity of the Stereo thread, in addition to the two camera live view threads, is indicated by the different color of the Process Status indicators for the two cameras.</p>"},{"location":"CamStereo/#streaming","title":"Streaming","text":"<p>The Stereo stream can also be accessed through the URL which is shown underneath the stream in the dialog.</p> <p>This URL, when called independently from the raspiCamSrv UI, will automatically start all necessary streaming processes.</p> <p>The necessity of authentication can be configured in the Settings.</p>"},{"location":"CamStereo/#3d-video","title":"3D Video","text":"<p>(See Wikipedia article on 3D Video)</p> <p>Starting Stereo processing with Intent \"3D Video\" will show the scene as 3D video which needs to be viewed with Red-Cyan color 3D glasses to see the 3D effect:</p> <p></p> <p>Here, you also have the possibility to record the stream as video.</p> <p>Videos, recorded in this way, are stored under <code>\\static\\photos\\camera_S</code> and can be accessed with the Photos dialog by selecting the \"Stereo\" camera:</p> <p></p>"},{"location":"CamWebcam/","title":"Web Cam Access","text":"<p>raspiCamSrv enables webcam functionalities with Raspberry Pi cameras as well as with USB cameras.</p> <p>For Pi 5 with two camera ports, both cameras can be streamed simultaneously.   Alternatively, you can choose one of the connected USB cameras as Active or Second camera.</p> <p>This page shows the URLS for MJPEG streaming as well as for photo snapshots:</p> <p></p> <p>The left side of the page always shows the active camera.  If an additional camera is available, video stream and photo are shown on the right side.</p> <p>When switching the cameras, either with the Switch Cameras button in Multi-Cam or by changing the camera in the Settings, the streams will be exchanged.  The video_feed endpoint will always refer to the active camera, which is also shown in the title bar.   The video_feed2 endpoint will always refer to the other camera, if available.</p> <p>The configuration and camera stream used for video and photo capture are indicated.</p> <p>The links shown on the page open a new browser window.</p>"},{"location":"CamWebcam/#video-stream","title":"Video Stream","text":"<p>The video stream will always use the LIVE configuration.  By default, this configuration uses the lores camera stream.  The camera stream as well as its stream size can be configured in the Configuration screen.</p>"},{"location":"CamWebcam/#photo-snapshot","title":"Photo Snapshot","text":"<p>For the photo snapshot, you can choose between using the LIVE configuration, usually configured with the lores stream with low resolution and a snapshot using the FOTO configuration, usually configured with the main stream with high resolution.</p> <p>NOTE: Photo snapshots with high resolution assume an active live stream where the lores and the main streams of the camera are simultaneously configured (see raspiCamSrv Tasks). </p> <p>If your configurations for LIVE and FOTO are incompatible (for example using a different Colour Space or when both use the main stream with different resolutions), the live stream will request exclusive camera access with only the LIVE configuration activated. In this case, the URL for the high resolution photo snapshot will return an image with the resolution configured for LIVE.</p> <p>If the live stream is active at the time when the photo snapshot is triggered, the snapshot will be taken immediately.   Otherwise, the live stream will be activated before the snapshot is taken. This requres starting the camera and giving it time to gather sufficient information for the auto-algorithms, which results in larger latency (1 to 1.5 sec).</p>"},{"location":"CameraControls/","title":"raspiCamSrv Camera Controls","text":"<p>NOTE: The subsequent description is essentially related to CSI cameras. For USB cameras, see Camera Controls for USB Cameras. </p> <p>Picamera2 allows for a set of 36 camera control parameters which can be adjusted while the camera is active.  From these, 8 parameters are just part of the image metadata and cannot be applied to the camera.</p> <p>In principle, the remaining 28 parameters can be applied to the camera at different times</p> <ol> <li>As part of the Camera Configuration.   Here raspiCamSrv supports adding any of these parameters to the configuration.  Control parameters included in the configuration have precedence over parameters not in the configuration.</li> <li>After camera configuration before camera start.  In raspiCamSrv, this applies for all photos and videos taken in a raspiCamSrv session.</li> <li>After the camera has been started.  In raspiCamSrv, this is only used for the live stream shown in the upper left quarter.  If controls have been modified and submitted, they will be directly applied to the live stream.</li> </ol> <p>Modification of camera controls does not affect raw photos.</p> <p>NOTE: For USB Cameras, Handling of Controls is slightly different.</p> <p>In raspiCamSrv all controls are explained through tooltips on the parameter name:   The texts for the tooltips have been mainly taken from the Picamera2 Manual or the  underlying libcamera documentation.</p> <p>The controls are grouped into</p> <ul> <li>Focus Handling</li> <li>Zoom &amp; Pan</li> <li>Auto-Exposure</li> <li>Exposure</li> <li>Image</li> </ul>"},{"location":"CameraControls/#basics","title":"Basics","text":"<p>All Control Parameter tabs (except Zoom and Pan) are structured similarly:</p> <ul> <li>Every tab is a form. This means that all parameters shown can be modified without any effect.  Only when the form is submitted through the Submit button, the settings are saved in the server configuration and directly applied to the live stream.</li> <li>Every parameter has a preceeding checkbox, which allows activation/deactivation of the control parameter within the configuration.  Only if the checkbox is checked, the parameter can be modified.  If the checkbox is unchecked, the control is not effective independently from its value.</li> <li>Individual parameters may have restictions either as distinct values or ranges of allowed values.  It should normally not be possible to enter a value which will not be accepted by the camera.</li> <li>Some camera systems support only a subset of the available control parameters.  For example, Raspberry Pi camera models 1 and 2 have no focus management.  This is recognized by rapiCamSrv and these parameters will not be presented to the user.</li> <li>All forms for the different parameter groups on different tabs are part of the same web page.  If values are modified without submitting, the modification will be visible even if another tab has been selected in the meantime.  If modifications are not submitted on their own tab, they will be lost in the next request/response cycle which can be triggered by a submit on another tab.</li> </ul>"},{"location":"CameraControls_AutoExposure/","title":"Camera Controls / Auto-Exposure","text":"<p>This tab includes parameters which control the Auto Exposure (AE) algorithm of the camera.</p>"},{"location":"CameraControls_Exposure/","title":"Camera Controls / Exposure","text":"<p>This tab includes parameters related to exposure control.</p>"},{"location":"CameraControls_Image/","title":"Camera Controls / Image","text":"<p>This tab includes parameters controlling the image appearance</p>"},{"location":"CameraControls_UsbCams/","title":"Camera Controls for USB Cameras","text":"<p>raspiCamSrv supports a limited set of controls for USB Cameras:</p> <ul> <li>Switch between auto focus and manual focus</li> <li>Adjustment of focal distance</li> <li>Zoom, pan, tilt</li> <li>Enabling/disabling automatic white balance</li> <li>Adjusting the color temperature in case of manual white balance</li> <li>Adjusting the sharpness</li> <li>Adjusting the contrast</li> <li>Adjusting color saturation</li> <li>adjusting brightness</li> </ul> <p>Whereas zoom/pan/tilt, as well as horizontal and vertical flipping, is controlled through OpenCV by modifying each individual frame delivered by the camera, the other controls are affected through the V4l2 (Video for Linux) interface to the camera.</p> <p>Every camera advertises the supported controls along with the related range of valid values.  This information is queried from the USB camera while raspiCamSrv initializes the camera information.</p> <p>The list of supported controls as well as their minimum, maximum, step and default values are used tho customize the individual controls screens to the currently active camera.</p>"},{"location":"CameraControls_UsbCams/#focus-handling-usb-cameras","title":"Focus Handling USB Cameras","text":""},{"location":"CameraControls_UsbCams/#image-control-usb-cameras","title":"Image Control USB Cameras","text":"<p>In these dialogs, the input fields have value ranges and defaults appropriate for the active camera type.  Value ranges and default values are also visible in the tooltips.</p>"},{"location":"CameraControls_UsbCams/#applying-controls-to-usb-cameras","title":"Applying Controls to USB Cameras","text":"<p>The supported controls ara applied to USB cameras through v4l2 commands, such as:</p> <p><code>v4l2-ctl --set-ctrl=contrast=50</code></p>"},{"location":"Configuration/","title":"raspiCamSrv Camera Configuration","text":"<p>Configuration parameters are so basic that they need to be applied before the camera is started.</p> <p>Picamera2 provides three configuration bases which can be taken as is for a specific use case or they can be adjusted in one or several aspects.</p> <p>These are:</p> <ul> <li>Preview configuration  for previews on a screen connected to the Raspberry Pi</li> <li>Still configuration  for photos</li> <li>Video configuration  for videos</li> </ul> <p>raspiCamSrv does not make direct use of these configurations.</p> <p>Instead, the following configurations can be fully configured:</p> <ul> <li>Live View configuration  which will be applied to the live stream</li> <li>Photo configuration  which will be applied when normal photos are taken</li> <li>Raw Photo configuration  which will be applied when raw photos are taken</li> <li>Video configuration  which will be applied when videos are recorded</li> </ul> <p>Configuration changes may have an impact on the way how tasks and background processes are executed. If specific parameters, such as Transform are changed for a specific use case only, for example for Video, video recording will require that the Live Stream is stopped and paused while the video is being recorded.  For more details, see raspiCamSrv Tasks and Background Processes.</p>"},{"location":"Configuration/#usb-cameras","title":"USB Cameras","text":"<p>The schema of configuration use cases, conceptually originating from Picamera2, is also retained for USB cameras. However, there are specific differences related to Colour Space, Buffer Count, Queue parameters. Also Controls cannot be included in the configuration as with Picamera2.</p> <p>A major difference is that USB cameras accessed through OpenCV, do not allow using different streams.  As a consequence, live stream in parallel to photo taking or video recording would only be possible with identical configurations.   Since this does not seam to make sense because of performance issues, raspiCamSrv always requests exclusive use of the camera when taking photos or recording videos.  Motion Capturing works in the same way for USB and CSI cameras.</p>"},{"location":"Configuration/#configuration-tab","title":"Configuration Tab","text":"<p>The Config submenu includes a tab Tuning which is described in raspiCamSrv Camera Tuning and not here.</p> <p>An individual configuration tab is available for each use case. All tabs have essentially the same structure:   </p> <p>As a general aspect, the green Submenu bar includes an option to synchronize the aspect ratio of stream sizes across all configurations if this has been changed for the current configuration.  If this option is activated after it was previously deactivated, all aspect ratios will be set to the one of the current configuration. </p> <p>NOTE: For USB cameras this option is unchecked and the checkbox is disabled becaus USB cameras scale and crop with the correct aspect ratio intrinsically.</p> <p></p> <p>As always: any modifications need to be submitted before they can be effective</p>"},{"location":"Configuration/#transform","title":"Transform","text":"<p>With Transform, you can specify whether the image needs to be flipped horizontally, vertically or both. The latter case is identical to rotation of 180\u00b0.</p> <p>NOTE: When this is modified for one configuration, the settings are automatically transferred to all other configurations. This is necessary because raspiCamSrv simultaneously configures all streams (lores, main and raw) in order to allow using these in parallel for different purposes, such as live stream and video recording. The transform settings cannot be different for different streams at the same time.</p>"},{"location":"Configuration/#colour-space","title":"Colour Space","text":"<p>This allows selecting one of the supported colour spaces</p>"},{"location":"Configuration/#buffer-count","title":"Buffer Count","text":"<p>Specifies the number of buffers used by the camera for the specific use case.</p> <p>Values are preset in accordance with corresponding settings of the Picamera2 standard use cases</p>"},{"location":"Configuration/#queue","title":"Queue","text":"<p>Specifies whether the camera is allowed to queue up a frame ready for a capture request.</p>"},{"location":"Configuration/#sensor-mode","title":"Sensor Mode","text":"<p>When raspiCamSrv starts up, one of the first things is to query the camera system for the available Sensor Modes. These can be inspected on the Info screen.</p> <p>These modes are offered for selection here.  When a Sensor Mode is selected, its main characteristics are shown to the right.</p> <p>In addition to the available Sensor Modes, a \"Custom\" mode can be selected which allows especially to set the intended stream size (width and height if the image in pixels)</p> <p>For the Raw Photo use case, \"Custom\" cannot be selected. Raw photos will allways use the stream size of the selected Sensor Mode.</p>"},{"location":"Configuration/#stream","title":"Stream","text":"<p>Specifies the stream to be used for the respective use case.</p> <p>The camera system supports three streams (see Picamera2 Manual):</p> <ul> <li>the main stream</li> <li>the lowres stream</li> <li>and the raw stream</li> </ul> <p>The latter is for raw data output which bypasses the image signal processor.</p> <p>For the Raw Photo use case, this is the only stream which can be selected.</p>"},{"location":"Configuration/#stream-size-width-height","title":"Stream Size (width, height)","text":"<p>If a standard Sensor Mode has been selected, the size related to the mode is shown.</p> <p>If \"Custom\" has been selected as sensor mode, you may enter any size here (except for Raw Photos).  Produced photos or videos will then be in the specified format.</p> <p>If the option to synchronize aspect ratios (right side of green Submenu bar) is selected, the Stream Sizes for all other configurations will be adjusted to reproduce the aspect ratio of the current configuration.</p> <p>NOTE: If, after submitting a Live View configuration, you get an error message <code>lores Stream Size must not exceed main Stream Size (Photo)</code>, you need to go to the Photo configuration and adjust its Stream Size to the desired value.</p>"},{"location":"Configuration/#stream-size-aligned-with-sensor-modes","title":"Stream size aligned with Sensor Modes","text":"<p>If this option is activated, and if a stream size has been specified which is different from stream sizes of the available Sensor Modes, the Picamera2 Configuration will be asked to align the stream size. This may result in slightly different sizes which are, however, in better accordance with available Sensor Modes.</p>"},{"location":"Configuration/#stream-format","title":"Stream Format","text":"<p>It can be selected from a number of pixel and image formats supported by Picamera2.  For details, see Picamera2 Manual, Appendix A.</p> <p>Whereas for Live Stream, Photo and Video a format can be selected from the same list, the formats available for Raw Photo are different. These are specified in the Sensor Modes (see Info).  raspiCamSrv queries these from Picamera2 at server startup and offers the found formats in the configuration screen.</p>"},{"location":"Configuration/#display","title":"Display","text":"<p>This parameter is just shown for completeness.  It specifies the stream which shall be used for display on a monitor connected to the system.  This is not relevant in the scenario addressed by raspiCamSrv, which is usually headless.</p>"},{"location":"Configuration/#encode","title":"Encode","text":"<p>This specifies the stream which needs to be sent to the encoder.</p> <p>Settings are preconfigured and cannot be modified.</p> <p>Encoding is only necessary for the Live View (MJPEG encoding) and the Video use cases.</p> <p>For Video, the encoder depends on the video format chosen.</p>"},{"location":"Configuration/#controls-included-in-configuration","title":"Controls included in Configuration","text":"<p>A configuration for a specific use case may also include Camera Controls.</p> <p>Actually, Picamera2 requires that at least one control is included in the configuration.</p> <p>raspiCamSrv preconfigurs a control with specific settings in accordance with the Picamera2 standard use case configurations.</p> <p>In addition, the button Add Active Ctrls will include all controls which are currently active in the Camera Controls configuration.</p> <p>Values are taken as configured and cannot be modified here.</p> <p>In case a control parameter has a wrong value, it can be selected and then removed from the configuration with the Remove Selected Ctrls button.</p>"},{"location":"Console/","title":"Console","text":"<p>The Console group of dialogs provides functions for user interactions with the Raspberry Pi.</p> <p></p> <ul> <li>Versatile Buttons allow interaction with the Operating System by running OS commands or scripts.</li> <li>Action Buttons allow execution of various types [Actions] for interaction with GPIO-connected output devices or the camera system.</li> </ul>"},{"location":"ConsoleActionButtons/","title":"Console - Action Buttons","text":"<p>This page shows buttons which have been configured in the Settings / Action Buttons:</p> <p> The example layout of this screenshot is based on the example configuration shown for the Settings / Action Buttons screen.</p>"},{"location":"ConsoleActionButtons/#button-execution","title":"Button Execution","text":"<p>When the Action, configured for a button is executed, the behavior for the action is slightly different compared to invocation of an action on behalf of a Trigger. </p> <ul> <li> <p>If a device is busy at the time when a button is pressed, the action is not executed. Instead a \"Device busy\" information is shown in the status line:   </p> </li> <li> <p>Also, the action is not executed in an own thread but synchronously, so that the user needs to wait for action completion which is confirmed in the message line.</p> </li> </ul>"},{"location":"ConsoleVButtons/","title":"Console - Versatile Buttons","text":"<p>This page shows buttons which have been configured in the Settings / Versatile Buttons:</p> <p> The example layout of this screenshot is based on the example configuration shown for the Settings / Versatile Buttons screen.</p>"},{"location":"ConsoleVButtons/#button-execution","title":"Button Execution","text":"<p>When a button is clicked which is configured to require confirmation, a confirmation dialog is shown where execution can be refused:</p> <p></p>"},{"location":"ConsoleVButtons/#execution-result","title":"Execution Result","text":"<p>In the bottom part of the dialog the result of the command execution is shown:</p> <ul> <li>CommandThe command configured for the button.</li> <li>Run ArgumentsCommand execution is done using the Python subprocess.run method which receives arguments as a list. This list is obtained by parsing the command string with spaces as separators.</li> <li>Return CodeThe return code returned from command execution.</li> <li>StdoutOutput which command execution has sent to Stdout.Multiline output can be scrolled.</li> <li>StderrError information which command execution has sent to Stderr.Multiline output can be scrolled.</li> <li>Status LineThe status line at the bottom shows whether the command could be executed or not, irrespective of errors which might have occurred during command execution.</li> </ul> <p>The last Execution Result remains visible within the live time of the Flask server.</p> <p>Of course, no result will be visible if the Flask server has been restarted or of the Raspberry Pi has been rebooted.</p>"},{"location":"ConsoleVButtons/#interactive-commandline","title":"Interactive Commandline","text":"<p>If the Settings / Versatile Buttons have declared the commandline to be interactive, commands can be directly entered on the commandline:</p> <p></p>"},{"location":"FocusHandling/","title":"raspiCamSrv Focus Handling","text":"<p>Focus handling is not supported by camera versions 1 and 2.   </p> <p></p> <p>This tab includes various controls which affect the Auto Focus (AF) algorithm of the camera.</p> <p>The Autofocus Mode can be set to \"Manual\", \"Auto\" or \"Continuous\"</p>"},{"location":"FocusHandling/#manual-focus","title":"Manual Focus","text":"<p>When Autofocus Mode \"Manual\" is chosen, also the Focal Distance field must be activated and the distance must be set manually.</p> <p>Pressing Submit will apply the setting to the live stream and the changed focus will be immediately visible.</p>"},{"location":"FocusHandling/#continuous-focus","title":"Continuous Focus","text":"<p>When Autofocus Mode is set to \"Continuous\", the camera will, after submitting, continuously try to focus under consideration of settings for other focus handling parameters.</p>"},{"location":"FocusHandling/#automatic-focus","title":"Automatic Focus","text":"<p>When Autofocus Mode is set to \"Auto\", the camera will automatically focus after an autofocus cycle has been triggered.</p> <p>Before the cycle can be triggered through the Trigger Autofocus button, the settings must be applied with the Submit button.   </p> <p>Submitting the \"Auto\" Autofocus Mode will have no effect on the live stream.</p>"},{"location":"FocusHandling/#trigger-autofocus","title":"Trigger Autofocus","text":"<p>The effect of the autofocus cycle will essentially depend on the settings for the other AF control parameters.</p> <p>Whether or not the autofocus cycle was successful, will be shown in the message area at the bottom of the application window: </p> <p>If the autofocus cycle was successful, raspiCamSrv will request metadata from the camera and determine the focal distance from the LensPosition.</p> <p>The Value will be entered in the Focal Distance field, which will also be activated automatically.</p> <p>Also, the Autofocus Mode will be automatically set to \"Manual\" so that the measured Focal Distance can be used for future photos.</p> <p></p>"},{"location":"FocusHandling/#autofocus-windows","title":"Autofocus Windows","text":"<p>These are rectangle areas within the image which will be used by the AF algorithm to focus.</p> <p>Multiple rectangle areas can be specified.</p> <p>raspiCamSrv supports graphical specification of these areas in the following way.</p> <ol> <li>Activate the checkbox for Autofocus Windows. As result, a canvas will be drawn over the live stream area which is visible as thin red border:  </li> <li>Now you can use the mouse to draw rectangles on this canvas:   Position the cursor at one corner of the intended rectangle,  press the left mouse button,   and drag with mouse button down to the opposite corner.</li> <li>When the mouse button is released, the rectangle coordinates will be scaled to the current scaler crop settings and entered in the Autofocus Windows field. </li> <li>If required, you can draw additional rectangles in the same way.  While drawing rectangles, previously drawn rectangles will vanish without getting lost.</li> <li>Finally, when the mouse pointer leaves the canvas area, all rectangles will be shown over the live stream area.  Don't forget to push Submit because otherwise, these settings will get lost!</li> <li>In order to remove all areas, just deactivate the Autofocus Windows checkbox and activate it again.</li> </ol> <p>The canvas and the rectangles representing the AF Windows will remain visible as long as the Autofocus Windows checkbox is activated and whenever the Focus tab is visible.</p>"},{"location":"Information/","title":"raspiCamSrv Information on Camera System","text":"<p>This screen contains several tabs with information on the camera system:  (When no cameras are connected, see Info - No Cam)</p>"},{"location":"Information/#installed-cameras","title":"Installed Cameras","text":""},{"location":"Information/#raspberry-pi","title":"Raspberry Pi","text":"<p>This section shows information on the server hardware with Model and Board Revision</p> <p>For the operating system, the kernel version (result of <code>uname -r</code>), the Debian version (result of Description from <code>lsb_release -a</code> and <code>cat /etc/debian_version</code>) and the system architecture (32-/64-bit) (result from <code>dpkg-architecture --query DEB_HOST_ARCH</code>) are shown.</p> <p>Process Info shows current process information for the raspiCamSrv server process (result of Linux <code>ps -eLf</code> command)</p> <ul> <li>PID: Process ID of Flask process (PID)</li> <li>Start: Process start time (STIME): either start time (HH:MM) at current day or day (MonDD) when process was started.</li> <li>#Threads: Number of threads (NLWP)</li> <li>CPU Process: CPU time of process (TIME for LWP == PID) in HH:MM:SS</li> <li>CPU Threads: Sum of CPU time for threads ((TIME for LWP != PID)) in %H:MM:SS</li> </ul> <p>FFmpeg Info shows information on an ffmpeg process if encoding of .mp4 videos is currently active.  Recording of .mp4 videos may have been started manually or as an action within motion capturing</p> <p>raspiCamSrv Start shows the time when the raspiCamSrv server has been started.  At server start, raspiCamSrv checks whether or not the Raspberry Pi system time is synchronized with the time server.  When the device is booted and raspiCamSrv is automatically started, the time synchronization will occasionally be done after the Flask server has already been started.   In this case, in order to avoid timing issues, raspiCamSrv will wait at startup until time synchronization is completed.  The time shown here is the system time at the moment when the check for time synchronization was successful.  raspiCamSrv analyzes the output of command <code>timedatectl</code> to check the system clock synchronization status.   If this check fails or times out (60 sec), raspiCamSrv will start nevertheless. In this case, the information \"System time not synced at raspiCamSrv start\" will be shown here.</p> <p>Software Stack shows information on installed packages with Version (Ver) and the path from which the packages were loaded (Loc).</p>"},{"location":"Information/#camera-x","title":"Camera x","text":"<p>The tab lists all cameras currently connected to the system.</p> <p>Each camera has an identifying number (0, 1, ...) shown in the title above each parameter list.  The assignment of camera number to physical camera may change when CSI cameras are plugged into a different CSI port (Pi 5) or when USB cameras are plugged into a different USB port.</p> <p>When the server starts up, the first camera in the list of cameras is selected as active camera, unless a specific camera is activated when a stored configuration is loaded at startup..</p> <p>You may later switch to another camera on the Settings screen or the Multi Cam screen</p> <p>The active camera is indicated in the list.</p> <p>The active camera will also be shown in the title bar of the application after log-in.</p> <p>For USB cameras, the device through which the camera is accessible is also shown (See Detection of Cameras).</p> <p>The information \"(Not in use)\" for a USB camera indicates that the camera has been detected by raspiCamSrv but it is not in use because USB cameras have been deactivated in the Settings. In this case, the USB camera cannot be selected as active or second camera in the Settings screen or the Multi Cam screen.</p>"},{"location":"Information/#status","title":"Status","text":"<p>Current Status shows the status of the camera:</p> <ul> <li>open / closed</li> <li>started / stopped</li> <li>current Sensor Mode  This is only shown for the currently active camera if it is started.   If the Sensor Mode cannot currently be determined, 'unknown' is shown.   The Sensor Mode is usually automatically selected by the camera and normally corresponds to the largest Stream Size, requested by one of the Camera Configurations.</li> <li>inactiveis shown for USB cameras which are currently not in use as active or second camera.</li> <li>excludedis shown for a USB camera which is, in principle, available for being used with raspiCamSrv, but currently excluded in the Settings</li> <li>not supported (OpenCV missing)Is shown if a detected USB camera cannot be used within raspiCamSrv because OpenCV is not installed.</li> </ul> <p>See Camera Status and Number of Threads</p> <p>Under Tuning File, you can see whether the Default or a custom tuning file are currently in use.   See raspiCamSrv Camera Tuning.</p>"},{"location":"Information/#camera-connected-but-not-in-the-list","title":"Camera connected but not in the list?","text":"<p>If you have a USB camera connected which does not show up in the list, you may have plugged in the camera while raspiCamSrv was running.  In this case, you can use function Reload Cameras to identify hot-plugged cameras.</p>"},{"location":"Information/#streaming-clients","title":"Streaming Clients","text":"<p>The tab lists the clients which are currently using one of the camera streams.  Along with the IP address of the client, a list of streams is shown which the client is using:</p> <ul> <li>live_view The Live View streamindicated by Process Status Indicator </li> <li>video_feedThe video Stream for the active cameraindicated by Process Status Indicator </li> <li>video_feed2The video Stream for the second camera, if availableindicated by Process Status Indicator </li> </ul>"},{"location":"Information/#camera-properties","title":"Camera Properties","text":"<p>These are the properties of the camera which is currently active.</p> <p>(See Determining Camera Properties for USB Cameras)</p>"},{"location":"Information/#sensor-modes","title":"Sensor Modes","text":"<p>The camera system advertises the supported Sensor Modes with their characteristics.</p> <p>These are referred to within the Camera Configuration.</p> <p>The characteristics vor every Sensor Mode are shown on an individual tab:</p> <p></p> <p>USB cameras may advertise a large number of sensor modes. In this case, the remaining buttons for sensor mode selection can be found in a drop-down list: </p>"},{"location":"Information/#camera-status-and-number-of-threads","title":"Camera Status and Number of Threads","text":"<p>The number of threads used by the server process depends on the status of the camera(s).</p> <ul> <li>When all cameras are closed, there is just the server process and, in case of Bookworm systems, 2 threads which are started with the import of Picamera2.   Thus, there is a minimum of three threads (1 for Bullseye).</li> <li>Opening a camera starts additional threads which remain active while the camera is open.  The number of threads may depend on the camera infrastructure specific for the operating system.</li> <li>Starting a camera and/or starting an encoder starts additional threads depending on the chosen camera function and encoder.</li> <li>raspiCamSrv also uses threads for background processes, such as live stream, video recording, photo series and motion detection. These ramain active while these processes are running.</li> <li>Stopping and closing a camera will also stop the dependent threads and thus reduce the number of active threads.</li> <li>If .mp4 video is currently recorded (started manually or as an action within motion capturing), there will be an additional ffmpeg process with additional threads.</li> <li>In case of .mp4 video recording with H264Encoder and FfmpegOutput there seems to be an issue with threads:   In this case, there may be threads surviving when the encoder is stopped (see picamera2 Issue #1023).  So, when .mp4 videos have been recorded, the number of threads may not go down to 3 (1 for Bullseye) after all camaras have been closed.  Experience shows that such threads may survive for a longer time but typically, they show only minor or no CPU utilization.  Often, they vanish after the camera has been closed after live stream has stopped.</li> </ul> <p>raspiCamSrv closes the camera in case it is not used:</p> <ul> <li>When the live stream stops after 10 seconds of inactivity, the camera used for the live stream will be stopped and closed.</li> <li>After photos have been taken or videos have been recorded, the camera will be stopped and closed.</li> <li>For Photo Series, the camera will be stopped and closed after a shot if the interval to the next shot is &gt;60 sec.  This does not apply to Exposure Series and Focus Stacks.</li> <li>If motion detection is active, the live stream is kept activated which keeps the camera open and started.</li> <li>In case of Stereo Vision, the live streams for both cameras are kept active,</li> </ul>"},{"location":"Information/#detection-of-cameras","title":"Detection of Cameras","text":"<p>raspiCamSrv uses the <code>Picamera2.global_camera_info()</code> list (see Picamera2 Manual, ch. 8.7) to identify the currently connected cameras.</p> <p>For each camera, the information provided by Picamera2 includes</p> <ul> <li><code>Num</code>: The camera number by which a camera is identified within Picamera2 as well as in raspiCamSrv.</li> <li><code>Model</code>: The model name of the camera, as advertised by the camera driver</li> <li><code>Location</code>: A number reporting how the camera is mounted, as reported by libcamera.</li> <li><code>Rotation</code>: How the camera is rotated for normal operation, as reported by libcamera</li> <li><code>ID</code>: An identifier string for the camera, indicating how the camera is connected. You can tell from this value whether the camera is accessed using I2C or USB.</li> </ul>"},{"location":"Information/#identification-of-usb-cameras","title":"Identification of USB Cameras","text":"<p>A camera is identified as USB camera, if <code>usb</code> is found in the <code>ID</code>.</p> <p>In raspiCamSrv, USB cameras are accessed through OpenCV rather than through Picamera2, which provides only very limited support for USB cameras.</p> <p>However, with OpenCV, a camera cannot be accessed through the Picamera2 camera number (<code>Num</code>).   Instead, the <code>/dev/videoX</code> of the Linux kernel must be used.</p> <p>For mapping of the Picamera2 camera number (<code>Num</code>) to the device number, raspiCamSrv uses the following algorithm:</p> <p>Assuming that the <code>ID</code> is structured in the following way:</p> <p>e.g.:  <code>/base/axi/pcie@1000120000/rp1/usb@200000-2:1.0-046d:085c</code></p> Component Meaning <code>/base/axi/pcie@1000120000</code> Root of the system-on-chip\u2019s PCIe controller <code>/rp1/usb@200000</code> The RP1 I/O controller\u2019s USB host controller (i.e. USB root hub) <code>-2:1.0</code> USB device address and interface: port 2, interface 1.0 <code>-046d:085c</code> Vendor ID : Product ID (046d = Logitech, 085c = C922 Pro Stream Webcam) <p>Now, with Video for Linux (V4L2), we can list all video devices:</p> <p><code>v4l2-ctl --list-devices</code> reveals, for example:</p> <pre><code>...\nrpi-hevc-dec (platform:rpi-hevc-dec):\n        /dev/video19\n        /dev/media1\n\nLogi 4K Stream Edition (usb-xhci-hcd.0-1):\n        /dev/video2\n        /dev/video3\n        /dev/video4\n        /dev/video5\n        /dev/media4\n\nC922 Pro Stream Webcam (usb-xhci-hcd.0-2):\n        /dev/video0\n        /dev/video1\n        /dev/media3\n\n</code></pre> <p>Each header within the list shows the camera's model and port (<code>(usb-xhci-hcd.0-2)</code> indicates port 2)</p> <p>Now, by mapping model and port from the Picamera2 <code>ID</code> with corresponding information from <code>v4l2-ctl</code>, we can identify the group for each USB camera.</p> <p>The first entry in the list of devices for this group is assigned to the camera number, assuming that this represents the main camera stream, whereas subsequent entries are for alternative functions.</p>"},{"location":"Information/#determining-camera-properties-for-usb-cameras","title":"Determining Camera Properties for USB Cameras","text":"<p>Whereas camera properties of CSI cameras are directly provided by Picamera2 (see Picamera2 Manual, Appendix D), this is not the case for USB cameras.</p> <p>raspiCamSrv maps properties of USB cameras as far as possible to the Picamera2 datastructure for seamless integration of USB cameras.</p> <p>The USB camera properties are determined with the v4l2 through (e.g.):</p> <p><code>v4l2-ctl --device=/dev/video12 --all</code></p> <p>giving:</p> <pre><code>Driver Info:\n        Driver name      : uvcvideo\n        Card type        : C922 Pro Stream Webcam\n        Bus info         : usb-xhci-hcd.0-2\n        Driver version   : 6.12.47\n        Capabilities     : 0x84a00001\n                Video Capture\n                Metadata Capture\n                Streaming\n                Extended Pix Format\n                Device Capabilities\n        Device Caps      : 0x04200001\n                Video Capture\n                Streaming\n                Extended Pix Format\nMedia Driver Info:\n        Driver name      : uvcvideo\n        Model            : C922 Pro Stream Webcam\n        Serial           : A9382BFF\n        Bus info         : usb-xhci-hcd.0-2\n        Media version    : 6.12.47\n        Hardware revision: 0x00000016 (22)\n        Driver version   : 6.12.47\nInterface Info:\n        ID               : 0x03000002\n        Type             : V4L Video\nEntity Info:\n        ID               : 0x00000001 (1)\n        Name             : C922 Pro Stream Webcam\n        Function         : V4L2 I/O\n        Flags            : default\n        Pad 0x01000007   : 0: Sink\n          Link 0x0200001f: from remote pad 0x100000a of entity 'Processing 3' (Video Pixel Formatter): Data, Enabled, Immutable\nPriority: 2\nVideo input : 0 (Camera 1: ok)\nFormat Video Capture:\n        Width/Height      : 640/480\n        Pixel Format      : 'YUYV' (YUYV 4:2:2)\n        Field             : None\n        Bytes per Line    : 1280\n        Size Image        : 614400\n        Colorspace        : sRGB\n        Transfer Function : Rec. 709\n        YCbCr/HSV Encoding: ITU-R 601\n        Quantization      : Default (maps to Limited Range)\n        Flags             :\nCrop Capability Video Capture:\n        Bounds      : Left 0, Top 0, Width 640, Height 480\n        Default     : Left 0, Top 0, Width 640, Height 480\n        Pixel Aspect: 1/1\nSelection Video Capture: crop_default, Left 0, Top 0, Width 640, Height 480, Flags:\nSelection Video Capture: crop_bounds, Left 0, Top 0, Width 640, Height 480, Flags:\nStreaming Parameters Video Capture:\n        Capabilities     : timeperframe\n        Frames per second: 30.000 (30/1)\n        Read buffers     : 0\n\nUser Controls\n\n                     brightness 0x00980900 (int)    : min=0 max=255 step=1 default=128 value=128\n                       contrast 0x00980901 (int)    : min=0 max=255 step=1 default=128 value=128\n                     saturation 0x00980902 (int)    : min=0 max=255 step=1 default=128 value=128\n        white_balance_automatic 0x0098090c (bool)   : default=1 value=1\n                           gain 0x00980913 (int)    : min=0 max=255 step=1 default=0 value=0\n           power_line_frequency 0x00980918 (menu)   : min=0 max=2 default=2 value=2 (60 Hz)\n                                0: Disabled\n                                1: 50 Hz\n                                2: 60 Hz\n      white_balance_temperature 0x0098091a (int)    : min=2000 max=6500 step=1 default=4000 value=4000 flags=inactive\n                      sharpness 0x0098091b (int)    : min=0 max=255 step=1 default=128 value=128\n         backlight_compensation 0x0098091c (int)    : min=0 max=1 step=1 default=0 value=0\n\nCamera Controls\n\n                  auto_exposure 0x009a0901 (menu)   : min=0 max=3 default=3 value=3 (Aperture Priority Mode)\n                                1: Manual Mode\n                                3: Aperture Priority Mode\n         exposure_time_absolute 0x009a0902 (int)    : min=3 max=2047 step=1 default=250 value=250 flags=inactive\n     exposure_dynamic_framerate 0x009a0903 (bool)   : default=0 value=1\n                   pan_absolute 0x009a0908 (int)    : min=-36000 max=36000 step=3600 default=0 value=0\n                  tilt_absolute 0x009a0909 (int)    : min=-36000 max=36000 step=3600 default=0 value=0\n                 focus_absolute 0x009a090a (int)    : min=0 max=250 step=5 default=0 value=0 flags=inactive\n     focus_automatic_continuous 0x009a090c (bool)   : default=1 value=1\n                  zoom_absolute 0x009a090d (int)    : min=100 max=500 step=1 default=100 value=100\n\n</code></pre> <p>By parsing this information, relevant data for camera properties can be retrieved and mapped to camera property elements.</p> <p>The <code>PixelArraySize</code> is determined as the maximum size of the Sensor Modes found (see below)</p>"},{"location":"Information/#determining-sensor-modes-for-usb-cameras","title":"Determining Sensor Modes for USB Cameras","text":"<p>Whereas sensor modes of CSI cameras are directly provided by Picamera2 (see Picamera2 Manual, ch. 4.2.2.3), this is not the case for USB cameras.</p> <p>raspiCamSrv maps video formats of USB cameras as far as possible to the Picamera2 sensor mode datastructure for seamless integration of USB cameras.</p> <p>The USB camera video formats are determined with the v4l2 through (e.g.):</p> <p><code>v4l2-ctl --device=/dev/video12 --list-formats-ext</code></p> <p>giving:</p> <pre><code>ioctl: VIDIOC_ENUM_FMT\n        Type: Video Capture\n\n        [0]: 'YUYV' (YUYV 4:2:2)\n                Size: Discrete 640x480\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.042s (24.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                        Interval: Discrete 0.133s (7.500 fps)\n                        Interval: Discrete 0.200s (5.000 fps)\n                Size: Discrete 160x90\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.042s (24.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                        Interval: Discrete 0.133s (7.500 fps)\n                        Interval: Discrete 0.200s (5.000 fps)\n...\n\n                Size: Discrete 2304x1536\n                        Interval: Discrete 0.500s (2.000 fps)\n        [1]: 'MJPG' (Motion-JPEG, compressed)\n                Size: Discrete 640x480\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.042s (24.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                        Interval: Discrete 0.133s (7.500 fps)\n                        Interval: Discrete 0.200s (5.000 fps)\n...\n\n                Size: Discrete 1920x1080\n                        Interval: Discrete 0.033s (30.000 fps)\n                        Interval: Discrete 0.042s (24.000 fps)\n                        Interval: Discrete 0.050s (20.000 fps)\n                        Interval: Discrete 0.067s (15.000 fps)\n                        Interval: Discrete 0.100s (10.000 fps)\n                        Interval: Discrete 0.133s (7.500 fps)\n                        Interval: Discrete 0.200s (5.000 fps)\n\n</code></pre> <p>From this output the list of sensor modes is generated with information on Size and Format.</p> <p>The FPS, stored for each sensor mode is the maximum value of fps found for each format.</p>"},{"location":"Information/#determining-supported-controls","title":"Determining supported Controls","text":"<p>Every USB Camera advertises a list of controls which can be used to adjust focus or image appearance.</p> <p>Supported controls are determined with the v4l2 through (e.g.):</p> <p><code>v4l2-ctl --device=/dev/video12 --list-ctrls</code></p> <p>giving:</p> <pre><code>User Controls\n\n                     brightness 0x00980900 (int)    : min=0 max=255 step=1 default=128 value=128\n                       contrast 0x00980901 (int)    : min=0 max=255 step=1 default=128 value=128\n                     saturation 0x00980902 (int)    : min=0 max=255 step=1 default=128 value=128\n        white_balance_automatic 0x0098090c (bool)   : default=1 value=0\n                           gain 0x00980913 (int)    : min=0 max=255 step=1 default=0 value=0\n           power_line_frequency 0x00980918 (menu)   : min=0 max=2 default=2 value=2 (60 Hz)\n      white_balance_temperature 0x0098091a (int)    : min=2000 max=7500 step=10 default=4000 value=3000\n                      sharpness 0x0098091b (int)    : min=0 max=255 step=1 default=128 value=128\n         backlight_compensation 0x0098091c (int)    : min=0 max=1 step=1 default=1 value=1\n\nCamera Controls\n\n                  auto_exposure 0x009a0901 (menu)   : min=0 max=3 default=3 value=3 (Aperture Priority Mode)\n         exposure_time_absolute 0x009a0902 (int)    : min=3 max=2047 step=1 default=250 value=312 flags=inactive\n     exposure_dynamic_framerate 0x009a0903 (bool)   : default=0 value=0\n                   pan_absolute 0x009a0908 (int)    : min=-36000 max=36000 step=3600 default=0 value=0\n                  tilt_absolute 0x009a0909 (int)    : min=-36000 max=36000 step=3600 default=0 value=0\n                 focus_absolute 0x009a090a (int)    : min=0 max=255 step=5 default=0 value=10 flags=inactive\n     focus_automatic_continuous 0x009a090c (bool)   : default=1 value=1\n                  zoom_absolute 0x009a090d (int)    : min=100 max=500 step=1 default=100 value=100\n</code></pre> <p>raspiCamSrv analyzes this list with respect to a limited set of controls and registers</p> <ul> <li>control name</li> <li>value data type</li> <li>minimum value</li> <li>maximum value</li> <li>default value</li> </ul> <p>For the active camera, this information is appended to the Camera Controls data structure (see Server Configuration Storage), which will also be transferred to the Streaming Configuration in case of multiple cameras.</p> <p>In order to establish this data structure, USB cameras need to be activated once as Active Camera.</p> <p>The controls information is cused to customize the Camera Controls screens when a USB camera is the Active Camera.</p>"},{"location":"Information_NoCam/","title":"raspiCamSrv Information (No Camera)","text":"<p>This is a variant of the general Information screen which shows up when no camera is available.</p>"},{"location":"Information_NoCam/#info","title":"Info","text":""},{"location":"Information_NoCam/#raspberry-pi","title":"Raspberry Pi","text":"<p>This section shows information on the server hardware with Model and Board Revision</p> <p>For the operating system, the kernel version (result of <code>uname -r</code>), the Debian version (result of Description from <code>lsb_release -a</code> and <code>cat /etc/debian_version</code>) and the system architecture (32-/64-bit) (result from <code>dpkg-architecture --query DEB_HOST_ARCH</code>) are shown.</p> <p>Process Info shows current process information for the raspiCamSrv server process (result of Linux <code>ps -eLf</code> command)</p> <ul> <li>PID: Process ID of Flask process (PID)</li> <li>Start: Process start time (STIME): either start time (HH:MM) at current day or day (MonDD) when process was started.</li> <li>#Threads: Number of threads (NLWP)</li> <li>CPU Process: CPU time of process (TIME for LWP == PID) in HH:MM:SS</li> <li>CPU Threads: Sum of CPU time for threads ((TIME for LWP != PID)) in %H:MM:SS</li> </ul> <p>FFmpeg Info shows information on an ffmpeg process if encoding of .mp4 videos is currently active.  Recording of .mp4 videos may have been started manually or as an action within motion capturing</p> <p>raspiCamSrv Start shows the time when the raspiCamSrv server has been started.  At server start, raspiCamSrv checks whether or not the Raspberry Pi system time is synchronized with the time server.  When the device is booted and raspiCamSrv is automatically started, the time syncronization will occasionally be done after the Flask server has already been started.   In this case, in order to avoid timing issues, raspiCamSrv will wait at startup until time syncronization is completed.  The time shown here is the system time at the moment when the check for time synchrinization was successful.  raspiCamSrv analyzes the output of command <code>timedatectl</code> to check the system clock synchronization status.   If this check fails or times out (60 sec), raspiCamSrv will start nevertheless. In this case, the information \"System time not synced at raspiCamSrv start\" will be shown here.</p>"},{"location":"Information_NoCam/#camera-x","title":"Camera x","text":"<p>The tab lists all cameras currently connected to the system.   In the situation where currently no camera is available, the list will only include USB cameras because CSI cameras, if connected, will always be activated.</p> <p>Each camera has an identifying number (0, 1, ...) shown in the title above each parameter list.</p> <p>The information \"(Not in use)\" indicates that the camera has been detected by raspiCamSrv but it is not in use because USB cameras have been deactivated in the Settings.</p> <p>For USB cameras, the device through which the camera is accessible is also shown.</p>"},{"location":"Information_NoCam/#camera-connected-but-not-in-the-list","title":"Camera connected but not in the list?","text":"<p>If you have a USB camera connected which does not show up in the list, you may have plugged in the camera while raspiCamSrv was running.  In this case, you can use function Reload Cameras to identify hot-plugged cameras.</p>"},{"location":"Information_NoCam/#detection-of-cameras","title":"Detection of Cameras","text":"<p>See Detection of Cameras</p>"},{"location":"LiveDirectControl/","title":"raspiCamSrv Live Direct Control","text":"<p>This screen is opened by clicking on the Live Stream area. It allows direct control of selected control parameters.  Control parameters with numeric values are accessible if they have been activated on the Camera Controls screens.   When finished with parameter tuning, return to the Live screen or select any other menu option.</p> <p></p>"},{"location":"LiveDirectControl/#focal-distance","title":"Focal Distance","text":"<p>The slider for Focal Distance is mapped to a range from 0 to 1.</p> <p>If you drag the slider to a value below the minimum focal distance, it will snap back to the minimum.</p> <p>Scaling uses an x**3 behavior so that lower values can be selected with higher precision.</p>"},{"location":"LiveDirectControl/#left-and-right-sliders","title":"Left and Right Sliders","text":"<p>The sliders for all parameters are mapped to a range from -1 to 1 with the default at 0, following an x**3 function:</p> <p></p> <p>Therefore, values closer to the default value can be selected with higher precision.</p> <p>Because of the mapping, you will always see the same sliders, independently from the real value ranges which are significantly different for CSI and USB cameras and which can also vary between different USB camera models.</p> <p>For some parameters, e.g. Analogue Gain, the default value is at the minimum of the parameter range.  In this case, negative slider positions can not be set; the slider will snap back to 0.</p>"},{"location":"LiveDirectControl/#zoom-factor","title":"Zoom Factor","text":"<p>The slider for the Zoom Factor directly shows the Zoom Factor with linear scaling.</p> <p>If you previously have selected a specific image region (Scaler Crop) with the Zoom and Pan dialog, the resulting Zoom Factor will be the maximum which ca be set with the slider. Selecting a larger value will always snap back to this maximum.</p> <p>However, you can zoom into this area until the lowest zoom factor is reached.</p>"},{"location":"LiveScreen/","title":"raspiCamSrv Live Screen","text":"<p>The Live screen is the central part of the application.  After photos or videos have been taken in the current session, its layout is as shown below:</p> <p></p>"},{"location":"LiveScreen/#layout","title":"Layout","text":""},{"location":"LiveScreen/#top-left-quarter","title":"Top Left Quarter","text":"<p>This is the area where a Live stream is shown, except for phases when videos are recorded and when Configuration for Live View and Video are not compatible..</p>"},{"location":"LiveScreen/#top-right-quarter","title":"Top Right Quarter","text":"<p>This area allows selecting and configuration of all Camera Controls supported by Picamera2. These are parameters which affect the characteristics of images and outputs of the camera and which can be modified while the camera is running.  The menu row of this section groups the controls into several categories.</p>"},{"location":"LiveScreen/#bottom-left-quarter","title":"Bottom Left Quarter","text":"<p>The bottom part of the screen is only shown if a Photo or video has been taken within the server's life time and if the user did not decide to hide this area.</p> <p>The bottom left quarter presents function buttons for Photo/Video taking  In addition, there are also buttons controlling the photo buffer to which users can add or remove individual photos and navigate between them.</p> <p>Raw photos or videos are not shown directly. Instead a placeholder in the configured photo format is shown.</p>"},{"location":"LiveScreen/#bottom-right-quarter","title":"Bottom Right Quarter","text":"<p>Here, the metadata of the currently visible photo/video are shown. The metadata are captured within the same Capturing Request together with the photo itself.  In the case of videos, the metadata are captured immediately before recording starts.</p> <p>Alternatively to metadata, the histogram of the photo can be shown.</p>"},{"location":"LiveScreen/#accessing-the-direct-control-panel","title":"Accessing the Direct Control Panel","text":"<p>For fine tuning all numeric control parameters (e.g. Focal Distance, Zoom Factor, Contrast, etc.), you can use the Direct Control Panel.</p> <p>When hovering with the mouse over the Live Stream area, you will get a hint:</p> <p></p> <p>Before clicking on the Live Stream, you will need to activate those control parameters which you want to adjust:</p> <ul> <li>Focal Distance</li> <li>Zoom Factor (does not require activation)</li> <li>Exposure Time</li> <li>Exposure Value</li> <li>Analogue Gain</li> <li>Colour Gain</li> <li>Sharpness</li> <li>Contrast</li> <li>Saturation</li> <li>Brightness</li> </ul> <p>Some of these parameters might not be available if the Active Camera is a USB camera.</p> <p>Furthermore, if you want to restrict to a specific image section, you need specify this on the Zoom window first.  The Direct Control Panel allows only zooming into that window but not changing the window itself.</p>"},{"location":"PhotoSeries/","title":"raspiCamSrv Photo Series","text":"<p>The Photo Series screen allows the management of different kinds of Photo Series and includes means for series configuration, lifecycle management, photo shooting and supervision.  A series is a sequence of photos taken with specific time intervals. Special kinds of series are Timelapse Series, Exposure Series and Focus Stacks.</p> <p></p>"},{"location":"PhotoSeries/#creation-of-a-new-series","title":"Creation of a new Series","text":"<p>When the Photo Series screen is opened for the first time, it offers the option to create a new series:</p> <p></p> <p>You need to enter a unique name for the series. Since the name will be used as folder name and as part of the filename for photos, you need to consider any restrictions for systems where you want to store and process these files.</p> <p>Linux is quite tolerant in this aspect but it is recommended using only letters, numbers and underscore characters.</p>"},{"location":"PhotoSeries/#series-configuration","title":"Series Configuration","text":"<p>When a series is initially created, some parameters are predefined which later need to be configured:</p> <p></p> <ul> <li>The lifecycle of a Photo Series is represented as its Status.  Transitions between different states can be initiated by one or two buttons at the right of the series selection combo box.  For details see the Series State Chart.</li> <li>If multiple series have been created, the active series can be selected with a combo box showing the series names.</li> <li>The Series Type distinguishes \"Normal\" series without special characteristics from specialized series, such as \"Exposure Series\", \"Focus Stacks\" or \"Timelapse Series\".</li> <li>The Path is the path where all resources for the series are located.  For details see Photo Series in the File System</li> <li>The system has also initialized a Series Configuration File a Series Log File and a Camera Settings File.</li> <li>In addition, a \"hist\" subdirectory has been created where histogram images will be stored (currently only for Exposure Series).</li> <li>Under Photo Type, it can be selected whether only <code>jpg</code> or <code>raw+jpg</code> photos shall be taken.</li> <li>The Start time is initiated with the current time.  This needs to be set to the time when the series shall start.</li> <li>The End time can be set explicitly if a specific end time is required.  If this is done, the number of shots will be calculated based on the specified Interval</li> <li>As Interval , the time difference (in seconds) between successive shots can be specified.  From experience, the system will observe the given value within a tolerance of about 30 ms.</li> <li>On Dial Marks specifies whether the shots shall be taken on whole hours, quarters, minutes, ..., depending on the intarval.For example, if the interval is 900 sec, photos will be taken exactly (within tolerances) at :00, :15, :30, :45, or if the interval is 3600 sec, photos will be taken every full hour.</li> <li>The Number of Shosts specifies the numper of photos intended for the series.  If the End time has not been explicitly specified, it will be calculated from Interval and Number of Shots considering the specified Start time.</li> <li>The checkbox Cont. on Server Start allows to automatically continue an active series in case of a server restart.   Such a situation may happen if the server is stopped (explicitly or implicitly with a device shutdown) while a series is active.   For example, if you have a long running timelapse series, there might be power outages forcing a system reboot. If you have set the series to automatic continuation it will be continued as soon as the server is restarted. Otherwise, it will be in status PAUSED.  Automatic continuation is not used for Exposure Series or Focus Stack series because these series are typically not running for a longer time.</li> </ul> <p>After the values have been entered, pressing the Submit button will calculate dependent parameters an change the status of the series to \"READY\".</p> <p>For Photo Series of type Exposure Series, Focus Stack and Timelapse Series, additional configurations are required.</p>"},{"location":"PhotoSeries/#series-start","title":"Series Start","text":"<p>A series in state \"READY\" can be started with the Start button.  This will execute the following steps:</p> <ol> <li>Set the status to \"ACTIVE\"</li> <li>Configure the camera with the active Configuratien for \"Photo\" or \"Raw Photo\", depending on the selected Photo Type</li> <li>Apply the active Camera ControlsFor Exposure Series and Focus Stack, specific controls will be adjusted or varied for each photo.</li> <li>Start the camera</li> <li>Wait until the start time</li> <li>Execute the necessary capture request (jpg, dng, metadata)</li> <li>Store the metadata in the Series Log File</li> <li>Store the camera configuration as well as the controls parameters, which have been applied before request execution, in the Camera Settings File</li> <li>Wait until the next interval and repeat steps from 6. until either the configured Number of Shots or the configured End time has been reached.</li> <li>Finally, the series status will be \"FINISHED\".</li> </ol> <p>While the series is \"ACTIVE\", this is shown by the Series status indicator and the screen will show the progress:</p> <p></p> <p>In the Preview area, the time for the next photo to be taken is shown and the progress bar shows the time remaining.</p> <p>When the photo time is reached, the page will be reloaded and the latest photo will be shown on top. The last 20 photos are available in the scroll area.</p>"},{"location":"PhotoSeries/#downloading-a-series","title":"Downloading a Series","text":"<p>A series can be downloaded at any time after it has been created.</p> <p>Whether or not a series has been downloaded is shown under Downloaded which is either \"Never\" or the time of the last download.   </p> <p>Pushing the Download button will require a confirmation before download will be executed.</p> <p>The download will be named <code>raspiCamSrvSeries_&lt;name&gt;_&lt;YYYYMMDDHHMMSS&gt;</code> with the timestamp of the download.</p> <p>The download is a zip archive including the entire folder structure of the series (see Photo Series in the File System):</p> <ul> <li>All photos taken until the time of download</li> <li>The Series Cofiguration file</li> <li>The Series Camera File (which will be empty if no camera configuration has been attached to the series)</li> <li>The Series Log File (which will be empty if the series has not yet been started)</li> <li>A subfolder <code>hist</code> containing histograms, in case the series has been an Exposure Series</li> </ul>"},{"location":"PhotoSeries/#finished-series","title":"Finished Series","text":"<p>When a series has ended or after it has been actively finished with the Finish button, its status is shown as \"FINISHED\":</p> <p></p> <p>If the series has been downloaded after it had ended, can be seen by comparing the respective timestamps.</p>"},{"location":"PhotoSeries/#live-stream","title":"Live Stream","text":""},{"location":"PhotoSeries/#active-live-stream","title":"Active Live Stream","text":"<p>If the Configuration for the Photo and Raw Photo use cases are compliant with the configuration for Live View, the Live Stream will not be interrupted while the series is ACTIVE.   For more details, see raspiCamSrv Tasks and Background Processes</p> <p>Simultaneous activity of Live Stream and Photo Series is indicated by the process status indicators:</p> <p></p> <p>If the series is an Exposure Series or a Focus Stack Series, Camera Controls will be modified while the series is active.   Auto Exposure and Auto White Balance will be deactivated and other parameters, such as Exposure Time, Analogue Gain or Focal Distance/Lens Position will vary from photo to photo.  These variations will be visible in the Live Stream.</p> <p>After the series is FINISHED, the original control parameters will be restored.</p>"},{"location":"PhotoSeries/#paused-live-stream","title":"Paused Live Stream","text":"<p>If the Live Stream is paused because photo taking requires exclusive camera access because of specific Configuration (see raspiCamSrv Tasks and Background Processes), this is indicated by the process status indicators:</p> <p>  and a placeholder image will be schown instead of the Live Stream:</p> <p></p>"},{"location":"PhotoSeries/#interrupting-an-active-series","title":"Interrupting an ACTIVE Series","text":"<p>While a Photo Series is ACTIVE, photo- and video taking is disabled:</p> <p></p> <p>The thread in which the Photo Series is executed, checks every 2 seconds whether a request to pause or stop has been issued.</p> <p>If the series shall be paused and (possibly) continued later, the Pause button in the Series screen can be used.</p> <p>If the series shall be interrupted and terminated, the Finish button can be used.</p>"},{"location":"PhotoSeries/#attaching-camara-configuration-to-a-photo-series","title":"Attaching Camara Configuration to a Photo Series","text":"<p>Before a Photo Series is started, normally the camera configuration and controls will manually be adjusted for optimal photo quality.</p> <p>These settings (configuration and controls) can be attached to a Photo Series with the Attach Camera Config button.</p> <p>These will be persisted in the series configuration file</p> <p>If this has been done, the system offers to activate these settings at a later time:</p> <p></p> <p>So, if another series shall be run with the same or a similar setup, the camera configuration and control settings can be reused after they have been activated.</p> <p>This feature can also be used to persist specific settings under an indicative name (the series name), also if it is not intended to really run such a series.</p>"},{"location":"PhotoSeries/#photo-series-state-chart","title":"Photo Series State Chart","text":""},{"location":"PhotoSeries/#photo-series-in-the-file-system","title":"Photo Series in the File System","text":"<p>All resources related to a Photo Series are stored in the file system under   <code>/home/&lt;user&gt;/prg/raspi-cam-srv/RaspiCamSrv/static/photoseries/&lt;name&gt;</code>  where <code>&lt;user&gt;</code> is the user ID specified during system setup and <code>&lt;name&gt;</code> is the name of the series.</p> <p>After Creation of a new Series, the folder has been created and a Series Configuration File, a Series Log File and a Series Camera File have been initiated:</p> <p>.</p> <p>After the series has been started, also all photos (.jpg) and, if selected, also the raw photos (.dng) can be found in this folder:</p> <p>.</p> <p>Typically, photo series will be processed on another system, especially if they have been taken with a Raspberry Pi Zero system.  RaspiCamSrv does not provide any means to download or transfer these data. There are numerous tools to achieve this (e.g. scp, Samba)</p>"},{"location":"PhotoSeries/#series-configuration-file","title":"Series Configuration File","text":"<p>The file <code>&lt;name&gt;_cfg.json</code> contains the entire configuration of a series, including, if attached, the camera configuration and camera controls.</p> <p></p> <p>When the server starts up, all folders under <code>.../photoseries</code> are searched for a configuration file and series configurations are created from their contents. These will then be available in the raspiCamSrv Photo Series dialog.</p>"},{"location":"PhotoSeries/#series-log-file","title":"Series Log File","text":"<p>The file <code>&lt;name&gt;_log.csv</code> contains log entries for each photo of the series:</p> <p></p> <p>Bisides the name of the photo and the time of creation, the most important metadata are included which have been captured in the same request as the Raw Photo and / or jpg Photo.</p>"},{"location":"PhotoSeries/#series-camera-file","title":"Series Camera File","text":"<p>The file <code>&lt;name&gt;_cam.json</code> contains a JSON structure with the camara configuration and the camera controls applied for each photo of the series. This is available only for Exposure Series and Focus Stack Series.</p> <p></p>"},{"location":"PhotoSeriesExp/","title":"Photo Series of type \"Exposure Series\"","text":"<p>Exposure series iterate through a specified range of an exposure parameter, keeping all other exposure parameters constant.  In general, exposure is controlled by three parameters: aperture, exposure time and ISO value.   </p> <p>Raspberry Pi cameras have a fixed or manually controlled aperture and ISO values are not standardized.  Instead of ISO values, the Analogue gaing can be set. Roughly, the relation is ISO = 100 * AnalogueGain.</p> <p>The Exposure Series subdialog allows specifying necessary parameters for series where either Exposure Time or Analogue Gain is varied.</p> <p>NOTE: This function is not available for USB cameras.</p> <p></p> <p>The dialog references the active Photo Series which is managed in the Series subdialog of the Photo Series dialog.</p> <p>The Number of Shots is shown here, because it will be affected by the chosen Start, Stop and Interval values.</p> <p>To configure the active Photo Series as Exposure Series, proceed as follows</p> <ol> <li>Activate the Exposure Series checkbox</li> <li>Select the exposure parameter which shall be kept at a fixed value by checking one of the check boxes under Exposure Time or Analogue Gain</li> <li>For the selected parameter, enter the intended value in the Start field.</li> <li>Now, specify Start and Stop values for the variable parameter</li> <li>The interval is specified in terms of photographic Exposure Values (EV)With a value of 1/3 EV the series is obtained by multiplying the last value of Exposure Time or Analogue Gain by 2(1/3) to get the next value.With a value of 1 EV, the factor is 2(1)=2and with 2 EV, the factor is 2**(2)=4.1/3 EV is the typical raster value for commercial cameras when modifying either aperture, exposure time or ISO.</li> </ol> <p>Finally push the Submit button to store the specified value.  This will recalculate the Number of Shots required for the series.</p> <p>To start photoshooting, go to the Series subdialog </p>"},{"location":"PhotoSeriesExp/#result","title":"Result","text":"<p>After the series has finished, the results can be inspected on the Exposure Series subscreen:</p> <p></p> <p>Together with each photo, the screen shows a histogram and characteristic metadata: - Exp: Exposure Time in seconds - Gain: Analogue Gain - Lux: An estimation of the brightness</p> <p>More information can be gained from  - the Series Camera File which lists the configuration and control parameters applied before shooting a photo - the Series Log File which lists the metadata captured together with each photo.</p>"},{"location":"PhotoSeriesExp/#parameter-table-13-ev","title":"Parameter Table (1/3 EV)","text":"<p>The following table contains  systematic values for Exposure Time and Analogue Gain with 1/3 EV, corresponding roughly to commercial camera settings</p> <p></p>"},{"location":"PhotoSeriesExp/#parameter-table-1-ev","title":"Parameter Table (1 EV)","text":"<p>The following table contains  systematic values for Exposure Time and Analogue Gain with 1 EV, corresponding roughly to commercial camera settings</p> <p></p>"},{"location":"PhotoSeriesFocus/","title":"Photo Series of Type \"Focus Stack\"","text":"<p>A Focus Stack series iterates the Lens Position (or Focal Distance).  With suitable software, such a stack can be combined to achieve a large Depth of Field (DoF).   NOTE: This function is not available for USB cameras.</p> <p></p> <p>To create a focus stack, you can proceed as follows:</p> <ol> <li>In the Live Screen use Focus Handling to determine the Focal Distance for the nearest and the furthest point of the scene.</li> <li>After initializing a Photo Series in the Series subscreen, open the Photo Stack subscreen and check Focus Stacking Series</li> <li>Then enter the nearest and furthest Focal Distance as Start and Stop values and choose a suitable Interval</li> <li>Push Submit to configure the series</li> <li>In the Series subscreen, start the Photo Series</li> </ol> <p>The result will be shown in the Focus Stack subdialog:</p> <p></p> <p>Together with each photo, characteristic metadata are shown:</p> <ul> <li>The Lens Position with which the photo was taken(reciprocal of Focal Distance)</li> <li>The Focal Distance which was varied within the series</li> <li>The Focus FoM, a Figure of Merit (FoM) to indicate how in-focus the frame is. A larger FocusFoM value indicates a more in-focus frame.</li> </ul> <p>More information can be gained from </p> <ul> <li>the Series Camera File which lists the configuration and control parameters applied before shooting a photo</li> <li>the Series Log File which lists the metadata captured together with each photo.</li> </ul>"},{"location":"PhotoSeriesTimelapse/","title":"Photo Series of Type \"Timelapse\"","text":"<p>This screen allows special configurations for Photo Series in the Timelapse domain.   Of course, every normal Photo Series can be used for Timelapse purposes. However, users often require specific features like specific time slots for multi-day series or automatic exposure adjustment during sunset/sunrise phases (Autoramping / \"Timelapse Holy Grail\").</p> <p>This page is dedicated to this kind of configuration settings.  Currently, raspiCamSrv supports limiting photo shooting to configurable periods depending on sunrise and sunset.</p> <p>Usage of this feature requires calculation of sunrise and sunset, depending on date.   The algorithm (see Sunrise Equation) requires information about the geografic coordinates of the camera position.  These need to be specified on the Settings screen before a Series can be classified as \"Sun-controlled\".  It is recommended to store the configuration in order to have these settings available after a server restart.</p> <p>When this screen is activated after a new Series has been created, it will show up as</p> <p></p> <ul> <li>The fields SeriesName, Interval and Number of Shots refer to the same parameters as screen Series.</li> <li>Activating the checkbox Sun-controlled Series will activate selective photo shooting in periods depending on sunrise and/or sunset.</li> <li>You can specify the Number of Days for which the series shall be active</li> <li>The fields Sunrise and Sunset will show values for the current day.If the series will be running for several days, sunrise and sunset will be calculated individually for every day.</li> <li>The system allows the definition of two periods per day during which photos will be shot with the given Interval:These are named Period 1 and Period 2</li> <li>At least for Period 1, you need to specify Start and EndIf only one is specified, the system reports an error and does not persist the specified data.Start and End are specified if the Reference is not \"Unused\".</li> <li>The Reference specifies whether \"Sunrise\" or \"Sunset\" will be used to limit the intended period.</li> <li>For each Periods Start and End, you can specify a time Shift in Minutes by which the start or the end of the period will be shifted with respect to the selected Reference.The Shift can be positive or negative.</li> <li>After Submit, the system will calculate Todays Values for Start and End.</li> <li>Also the time for the Next Shot will be shown.</li> </ul> <p>When submitting entries with a reasonable interval and Number of Days, the system will recalculate the required Number of Shots as well as the expected End of the Series, shown on the Series screen.</p> <p></p>"},{"location":"PhotoSeriesTimelapse/#example-single-period-for-daylight-photos","title":"Example: Single Period for Daylight Photos","text":""},{"location":"PhotoSeriesTimelapse/#example-two-periods-around-sunrise-and-sunset","title":"Example: Two Periods around Sunrise and Sunset","text":""},{"location":"PhotoSeriesTimelapse/#sunrise-equation","title":"Sunrise Equation","text":"<p>The algorithm for the sunrise/sunset equation has been taken from Wikipedia:  https://en.wikipedia.org/wiki/Sunrise_equation</p> <p>This article also publishes Python code which has been taken as is (version from August 11, 2024, 14:18) and integrated with minor technical adjustments into the RaspiCamSrv Flask server code.</p> <p>Comparison of the results from this algorithm with those from the \"NOAA Solar Calculator\" (https://gml.noaa.gov/grad/solcalc/) for the time of writing at the author's location showed a deviation of -2 Minutes for sunrise and +3 Minutes for sunset.  However, the NOAA Calculator does not seem to take elevation into account.</p>"},{"location":"PhotoViewer/","title":"raspiCamSrv Photo Viewer","text":"<p>All photos, raw photos or videos taken wit raspiCamSrv are stored in a camera-specific folder on the server.</p> <p>Currently, the folder is located within the folder where Flask expects static content   (<code>~/home/prgraspi-cam-srv/raspiCamSrv/static/photos/camera_n</code> (n=0, 1)).  The full path of the folder for the active camera is shown in the Settings screen.</p> <p>The current implementation of raspiCamSrv includes a very simple viewer which allows inspecting the available photos and videos as well as downloading and deleting selected files:</p> <p></p> <p>On the left side, a selection of photos (.jpg placeholders for raw and video) are shown in a scroll area in reverse order with the newest one on top.</p> <p>The file name in the photo (or placeholder) shows the correct filename of the resource represented by the picture.</p> <p>A large view of the photo or a video player is presented when a specific picture has been clicked on.</p> <ul> <li>You need to select the Camera for which photos shall be shown.In systems with multiple cameras, photos taken with a camera are stored in a camera-specific folder.</li> <li>From and To date selectors allow restricting photos to a specific range of datesWhen initially starting the dialog, the current day is selected.Internally, From has time 00:00:00 and To 23:59:59.</li> <li>Button Today restricts the time range to the current date</li> <li>Button All sets From to January 1st, 1970 and To to today.</li> <li>On the left of each thumbnail picture, there is a checkbox where you can select photos or videos for download or for deletion.</li> <li>Buttons Select all and Deselect all apply to all photos currently shown in the scrolling area.</li> <li>With button Delete you can delete all selected photosBefore deletion is executed, a confirmation is required.If a specific media (e.g. video or raw photo) incudes the media file itself, a jpg placeholder and an optional histogram file, all are deleted.Deletion of photos also clears the Photo Display Buffer.</li> <li>With the Download button, you can download the selected files.Also here, a confirmation is required.If more than one file has been selected, the selected files will be zipped into a file named raspiCamSrvMedia_YYYYMMDD_HHMMSS.zipIf a single file is selected, it will be downloades as is.Placeholders for raw and videos as well as histogram are not included in the download.</li> </ul>"},{"location":"Phototaking/","title":"raspiCamSrv Photo Taking and Video Recording","text":"<p>The Live tab of raspiCamSrv provides functionality to take photos, raw photos and videos.</p> <p>In all cases, the predefined Camara Configuration for the specific use case is applied together with the currently activated Camera Controls.</p> <p>As long as no photo has been taken, the Live screen will show like below:</p> <p></p> <p>Now, you can use</p> <ul> <li>the Photo button to take a photo,  where the file type can be selected in the Settings screen. (\"jpg\" is recommended)</li> <li>the Raw button to take a raw photo.  Currently only the .dng format is supported.</li> <li>the Video button to record a video,  where for the video format you may choose between .mp4 and .h264 in the Settings. Recommended is .mp4</li> </ul>"},{"location":"Phototaking/#photo-raw-photo","title":"Photo / Raw Photo","text":"<p>If the Photo/Raw Photo Configuration is not compliant with the Live View configuration, the live stream will be shortly interrupted in order to allow the system to apply the Camera Configuration for these use cases.  For more details, see raspiCamSrv Tasks and Background Processes</p> <p>The photo (in the case of raw photos a placeholder photo) will be shown in the bottom area of the screen together with the Metadata.</p>"},{"location":"Phototaking/#video","title":"Video","text":""},{"location":"Phototaking/#with-active-live-stream","title":"With active Live Stream","text":"<p>When video recording is started, the system will first check whether the required Camera Configuration is compliant with the configuration of the active Live Stream.</p> <p>If this is the case, first a normal photo of the scene will be taken, which will be used as placeholder. This will be shown in the bottom area.</p> <p></p> <p>The Video button has changed to Stop which must be used to stop video recording.</p> <p>If audio is recorded along with video (see Settings), this will be indicated by the process indicator:</p> <p></p>"},{"location":"Phototaking/#with-paused-live-stream","title":"With paused Live Stream","text":"<p>If video recording requires exclusive camera access because of specific configuration (see raspiCamSrv Tasks and Background Processes), the live stream will be paused and a placeholder is shown instead:</p> <p></p>"},{"location":"Phototaking/#photo-display","title":"Photo Display","text":"<p>When a photo, raw photo or video has been taken, the bottom area will show the photo together with its Metadata or its histogram:</p> <p></p> <p>The file name for the photo, raw photo or video has been generated automatically based on system date/time when the request is issued to the camera.</p> <p>Above the photo, some buttons are shown which allow manipulation of a display buffer:</p> <p></p> <ul> <li> <p>Pressing the - button will remove the photo from display.  It will not be removed from the file system.</p> </li> <li> <p>The active + button shows that the photo is not yet a member of the display buffer.  Pressing this button will add it to the buffer.</p> </li> </ul> <p>This is shown as:</p> <p></p> <p>The indicator (x/y) above the + button shows the position of the Photo within the buffer as the left number and the total number of photos in the buffer as the right number.</p> <p>With the larger number of photos within the buffer, navigation buttons &lt; and &gt; allow navigation within the buffer:</p> <p></p> <p>Additional buttons are available:</p> <ul> <li>Hide / Show can be used to hide or show the bottom area with the display buffer</li> <li>Clr(x) will clear the entire buffer.  The number in brackets is the total number of elements in the buffer.</li> <li>&lt; will display the previous photo in the buffer</li> <li>&gt; will display the next photo within the buffer</li> <li>- when applied to a member of the buffer, will remove it from the buffer</li> </ul>"},{"location":"Phototaking/#metadata","title":"Metadata","text":"<p>Along with a photo, also its metadata will be shown.</p> <p>Metadata and photo have been captured within the same capturing request.</p> <p>For the metadata, tooltips on the metadata properties explain the respective parameter.</p> <p>Previous and Next buttons allow scrolling the list of metadata if it does not fit on the screen.</p> <p></p> <p></p>"},{"location":"Phototaking/#histogram","title":"Histogram","text":"<p>Alternatively to the metadata, you may also switch to Histogram if usage of histograms has been activated in the Settings.</p> <p></p> <p>The setting whether metadata or histogram are shown, is kept and remains active also when the next photo is taken or when scrolling through the Photo Buffer.</p> <p>Histogram graphics are calculated on the fly when they are requested for the first time.   They are stored in a \"hist\" subfolder under the Path for Photos/Videos (see Settings)</p>"},{"location":"ReleaseNotes/","title":"Release Notes","text":""},{"location":"ReleaseNotes/#v450","title":"V4.5.0","text":""},{"location":"ReleaseNotes/#new-features","title":"New Features","text":"<ul> <li>Direct Control Panel added to Live View for fine tuning of numeric Camera Control parameters.</li> <li>Added additional endpoints for photo snapshots with high resolution. Previews are available in the Cam/WebCam dialog. Please note the special restrictions.   Covers raspi-cam-srv Issue #79</li> </ul>"},{"location":"ReleaseNotes/#changes","title":"Changes","text":"<ul> <li>Style sheet switched to W3.CSS 5.02</li> </ul>"},{"location":"ReleaseNotes/#bugfixes","title":"Bugfixes","text":"<ul> <li>Fixed <code>TypeError: stat: path should be string, bytes, os.PathLike or integer, not NoneType</code> which could occur after a Reset Server</li> </ul>"},{"location":"ReleaseNotes/#v441","title":"V4.4.1","text":""},{"location":"ReleaseNotes/#bugfix","title":"Bugfix","text":"<ul> <li>Fixed the update procedure with dialog Settings/Update.   The procedure implemented in V4.3.2 did not work correctly.   Although it confirmed that the update was successful, the version remained at the old version after restart.  If you were running into that issue, you should -- <code>ssh</code> to the server   -- <code>cd prg/raspi-cam-srv</code>  -- <code>git reset --hard origin/main</code>  The Update Procedure has been modified, accordingly.  For versions 4.4.1 and later, the Settings/Update procedure should work correctly.</li> </ul>"},{"location":"ReleaseNotes/#v440","title":"V4.4.0","text":""},{"location":"ReleaseNotes/#new-feature","title":"New Feature","text":"<ul> <li>Media Viewer added to all images and videos in the UI.</li> </ul>"},{"location":"ReleaseNotes/#v432","title":"V4.3.2","text":""},{"location":"ReleaseNotes/#new-feature_1","title":"New Feature","text":"<ul> <li>raspiCamSrv Version Updates supports periodical search for updates on GitHub with indication of new versions and version update as well as server restart from the UI.</li> </ul>"},{"location":"ReleaseNotes/#v431","title":"V4.3.1","text":""},{"location":"ReleaseNotes/#bugfix_1","title":"Bugfix","text":"<ul> <li>Fixed the issue with bad Live Stream quality for Raspberry Pi models <code>&lt;</code> 5.   When starting the live stream, raspiCamSrv usually configurs the camera with all 3 streams (lowres, main, raw), so that the live stream (lowres) can remain active while photos (main), raw photos (raw) or videos (main) are taken.   For Raspberry Pi Zero and other models <code>&lt;</code> 5, it turned out that the stream quality is bad when the raw stream is included in the configuration.   Now, for models <code>&lt;</code> 5, the raw stream is excluded from the configuration for the live stream, resulting in better quality.  For these models, when a raw photo is taken, the live stream will be temporarily stopped and reactivated without raw stream configuration after the raw photo has been stored.</li> </ul>"},{"location":"ReleaseNotes/#v430","title":"V4.3.0","text":""},{"location":"ReleaseNotes/#changes_1","title":"Changes","text":"<ul> <li>Documentation has been moved to Material for MkDocs.    The entire documentation will be versioned with the software and Online Help links will point to documentation with the version of the software, rather than to the latest version.</li> </ul>"},{"location":"ReleaseNotes/#v420","title":"V4.2.0","text":""},{"location":"ReleaseNotes/#new-features_1","title":"New Features","text":"<ul> <li>For Motion Detection, Regions of Interest as well as Regions of NO Interest can be specified.   These are respected during Motion Detection for CSI as well as USB cameras and for all Motion Detection Algorithms</li> <li>In case of multiple cameras, the camera-related Ttigger settings (Trigger/Motion and Trigger/Camera) are now camera-specific.    When the active camera is switched, these settings are replaced by those which had been defined and saved for camera switch for the new camera, before.   This is especially important when regions of interest are used for motion detection. These settings will not be lost when cameras are switched.</li> <li>Backup and Restorage of configuration and other stored data.</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_1","title":"Bugfixes","text":"<ul> <li>For USB cameras an error occurred when Focus was set to 0.0 with Autofocus Mode \"Manual\". This is now fixed.</li> <li>For Motion Capturing with USB cameras, the frame rate for video recording was increased from 14.5 to 30. With this frame rate, the video length is in better accord with the configured duration.</li> </ul>"},{"location":"ReleaseNotes/#v410","title":"V4.1.0","text":""},{"location":"ReleaseNotes/#new-features_2","title":"New Features","text":"<ul> <li>Zoom and Pan are now also available for USB Cameras.</li> <li>Focus handling and Image Controls are now available for USB Cameras.   NOTE These features have currently been tested with different Logitech cameras. Please notify if other cameras show unexpected behavior.</li> </ul>"},{"location":"ReleaseNotes/#changes_2","title":"Changes","text":"<ul> <li>For USB cameras, it is no longer possible to choose Sensor Mode \"Custom\" for the different Configuration scenarios. Practical experience with web cams has shown that these do not support other image sizes as those defined in the discrete formats (sensor modes). The camera would always use the smallest standard format which entirely contains the specified area. Therefore, it does not make sense allowing the specification of a custom format, if the camera will not use it.</li> <li>For USB cameras, the aspect ratio for Stream Size of different Configuration use cases is not synchronized. For these cameras, the checkbox Sync Aspect Ratio is unchecked and disabled.</li> </ul>"},{"location":"ReleaseNotes/#v403","title":"V4.0.3","text":""},{"location":"ReleaseNotes/#extension","title":"Extension","text":"<ul> <li>In the Info dialog, the section Raspberry Pi was extended with information on the software stack, which can be helpful analyzing errors which could occur with specific versions or installation details.</li> </ul>"},{"location":"ReleaseNotes/#v402","title":"V4.0.2","text":""},{"location":"ReleaseNotes/#bugfixes_2","title":"Bugfixes","text":"<ul> <li>Fixed error which occurred when changing the Active Camera in Settings to a USB camera</li> </ul>"},{"location":"ReleaseNotes/#v401","title":"V4.0.1","text":""},{"location":"ReleaseNotes/#bugfixes_3","title":"Bugfixes","text":"<ul> <li>Fixed error \"Error <code>&lt;class 'ValueError'&gt;</code> : Class Camera has no element when_motion_detected\"  Cause of the error was a wrong configuration for Triggers with Source 'Camera', which had included an event 'when_motion_detected'. This event is only available for Source 'MotionDetector'.   The wrong configuration is now corrected.   If you have configured a Trigger for event 'when_motion_detected' with Source 'Camera', you need to delete it and replace it with a trigger with Source 'MotionDetector'   This covers part of raspi-cam-srv Discussion #77.</li> </ul>"},{"location":"ReleaseNotes/#v400","title":"V4.0.0","text":""},{"location":"ReleaseNotes/#new-features_3","title":"New Features","text":"<ul> <li>Seamless integration of USB cameras with CSI cameras (see Info and Multi Cam)USB cameras are accessed through OpenCV which must have been installed (see Installation Step 11.).The use of USB cameras can be activated or deactivated in the Settings.USB cameras are handled in exactly the same way as CSI cameras and they can be used in all operational functions, except Focus Stacks and Exposure Series.NOTE: Currently Controls (Focus, Zooming, Ecposure and Image control) cannot be used with USB cameras. However, images can be flipped and resolution can be adjusted with Configuration.</li> <li>Hot-Plug of USB cameras is supported. See button Reload Cameras in Settings / Configuration.</li> <li>No-Camera Mode is supported.Before, when no cameras were installed, raspiCamSrv could not be started.Now, it is possible to use raspiCamSrv also without cameras, for example in order to control GPIO Devices through the Action Buttons or through the Event Handling Infrastructure or in order to use the Versatile Buttons Console to issue freely configurable OS commands and see their output.</li> <li>Switching Cameras in the Multi Cam dialog now requires confirmation when Camera Confoguration and/or Controls were changed and not yet saved for camera switch. This shall avoid unintended loss of configuration work when switching the cameras.</li> <li>Installation Procedure has been updated for use with Debian-Trixie, the successor of Bullseye.Tests have so far only be made with a Raspberry Pi Zero 2 system with connected CSI and USB camera.Please report any issues, you may run into, in other configurations.</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_4","title":"Bugfixes","text":"<ul> <li>Made Photo Display robust against deletion of photos.  Before, when a photo was deleted, the entire display buffer was cleared.  Now, only the deleted photos are removed from the display buffer.  Also, when the server is started with stored configuration, it is checked whether to stored buffer information is still consistent with the existing photos or videos.</li> </ul>"},{"location":"ReleaseNotes/#v371","title":"V3.7.1","text":""},{"location":"ReleaseNotes/#bugfixes_5","title":"Bugfixes","text":"<ul> <li>Fixed Notification for Motion Capturing.   In special cases of parameters for Trigger Control, Camera Actions or Video/Photos to be included in the message (see Notification Settings), notification mails were not sent or images were not included in the mails.  This fix resolves raspiCamSrv Issue #76 (Notification email)</li> </ul>"},{"location":"ReleaseNotes/#v370","title":"V3.7.0","text":""},{"location":"ReleaseNotes/#new-features_4","title":"New Features","text":"<ul> <li>Camera Calibration uses an image series of a calibration pattern for calibration of a stereo camera pair.</li> <li>Stereo Vision uses a stereo camera setup for creation of 3D videos or depth maps.</li> <li>The Multi-Cam dialog has a new function to Synchronize Configurations.</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_6","title":"Bugfixes","text":"<ul> <li>Fixed behavior when starting server with stored configuration after the camera or one of the cameras has been replaced by a different model.   In the previous version, the settings for the second camera have been taken from the stored configuration.  Now, if a camera has been changed, the corresponding configuration is reset to default.   This will also be indicated with the yellow indicator for unsaved configuration changes</li> <li>Layout of Multi-Cam dialog has been corrected. In the previous version the two columns had a different width.</li> <li>Fixed wrong status of Start server with stored Configuration after a Reset Server</li> <li>Fixed image distortion when the stream size of a Configuration has been changed to an aspect ratio which is not that of the default ScalerCrop.    In this case, scalerCrop is now activated in the controls, so that it will also be included in the streaming configuration and will also be synchronized with the second camera, if this is the same model as the active one.</li> <li>Fixed inappropriate status indicators and Multi-Cam menu for systems having just one camera.</li> </ul>"},{"location":"ReleaseNotes/#note","title":"Note","text":"<ul> <li>For Raspberry Pi Zero running the latest builds of Bookworm, there seems to be an issue with MJPEG streaming. It has been observed that, after some time of streaming (a few minutes), the entire system gets stalled and does no longer react without rebooting. The reasons are not yet understood and need to be analyzed.   This problem does not occur on Bullseye systems! The issue is no longer observed in Bookworm systems when updated after about mid September 2025!</li> </ul>"},{"location":"ReleaseNotes/#v362","title":"V3.6.2","text":""},{"location":"ReleaseNotes/#bugfixes_7","title":"Bugfixes","text":"<ul> <li>Fixed \"UnboundLocalError\" which occurred when creating a new Trigger or a new Action.</li> </ul>"},{"location":"ReleaseNotes/#v361","title":"V3.6.1","text":""},{"location":"ReleaseNotes/#bugfixes_8","title":"Bugfixes","text":"<ul> <li>Fixed \"NameError: name 'photoViewConfig' is not defined\"</li> </ul>"},{"location":"ReleaseNotes/#v360","title":"V3.6.0","text":""},{"location":"ReleaseNotes/#new-features_5","title":"New Features","text":"<ul> <li>Now supporting alternate or simultaneous photo taking and video recording with both cameras for systems which allow connecting two (non-USB) cameras (currently Raspberry Pi 5).</li> <li>API extended with new web services supporting photo taking and video recording with both cameras.</li> <li>The new Multi-Cam dialog gives access to photo taking and video recording functions for both cameras, if available.</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_9","title":"Bugfixes","text":"<ul> <li>Fixes \"KeyError: 'GPIO'\" which could occur when the event handling system was stopped without having fired a GPIO trigger during its life time.</li> <li>Fixed an issue where Test Motion Detection did not work if it was started within a period where Trigger Operation was not active.</li> </ul>"},{"location":"ReleaseNotes/#v356","title":"V3.5.6","text":""},{"location":"ReleaseNotes/#bugfixes_10","title":"Bugfixes","text":"<ul> <li>Fixed an issue, where a request did not return when trying to take a photo in cases, where the configuration for Live View and Photo both use the same stream but with different stream size.</li> <li>Fixed missing Live view after an error has occurred during photo taking or video recording.   In some cases, the Live view needs to be deactivated while taking a photo or recording a video because of incompatible configuration.   The deactivation flag is now cleared so that the Live view will show up after an error has occurred.   NOTE: that you need to push the Live menu button for refreshing the screen.</li> <li>Fixed wrong Status Indicator for Trigger thread after starting server with stored configuration</li> <li>Improved exception handling for camera access:   Exception occurring during camera configuration are now not only logged but also shown within the UI.   Low level error messages, indicating the error source as reported by Picamera2, are no longer overwritten by higher level more general messages.</li> </ul>"},{"location":"ReleaseNotes/#new-features_6","title":"New Features","text":"<ul> <li>The Settings/Configuration screen now shows all unsaved configuration changes which have been made during a session. This can help to decide whether or not the current configuration needs to be saved.   Thus, whenever the Configuration Status Indicator is switched on, a new entry for unsaved configuration changes is made.</li> <li>StepperMotor has got new functionality.  wipe will rotate back and forth between given angles for a certain nomber of cycles or until stop is called.</li> </ul>"},{"location":"ReleaseNotes/#changes_3","title":"Changes","text":"<ul> <li>Adapted Installation procedure step 11 for version of matplotlib.   As discussed in picamera2 issue #1211, Picamera2 relies on the numpy version coming with Debian installation, which is numpy 1.x. On the other hand, matplotlib version 3.8 and later seem to require numpy 2.x, which is binary incompatible to version 1.x.</li> <li>For StepperMotor, the minimum speed (which is achieved by setting speed=0) has been reduced by a factor of 10.   The angular velocity is now: For speed=0: 164.20 seconds for 360\u00b0   For speed=1: 4.42 seconds for 360\u00b0</li> <li>Extended capabilities of <code>GET api probe</code> API WebService endpoint:   Now <code>Camera.streamOutput</code> and <code>Camera.stream2Output</code> are accessible which represent the streaming output of the primary and secondary camera.</li> </ul>"},{"location":"ReleaseNotes/#v355","title":"V3.5.5","text":""},{"location":"ReleaseNotes/#bugfixes_11","title":"Bugfixes","text":"<ul> <li> <p>Thread-safe handling of last live stream access. The last access of a client to a camera stream controls automatic shutdown of the streaming server after 10 sec of inactivity (see Streaming).   Since streaming clients and servers are executed in different threads, it could happen in rare cases that a client has tried to access a stream in a phase where the server has started but not yet completed to shut down because of inactivity.   Since the camera is closed when streaming is shut down, different camera errors could occur, depending on camera shutdown status.  This could occur in particular when taking photos or taking Photo Snapshots through the Web URL.  Now, access to the time of last stream access has been made thread-safe by holding locks while a process is evaluating or changing this value and, in cases where inactivity is detected by the server, the lock is only released after the server has completely shut down.   (Fixes raspi-cam-srv issue #61)</p> </li> <li> <p>After an OS upgrade, Kernel Version and Debian Version in the Info/Installed Cameras screen did not show the correct values if the server was configured to start with the stored configuration. Instead, the values from the stored configuration were shown.  This has been fixed.  The entry in the server configuration storage file will have the old value until the configuration has been stored.</p> </li> </ul>"},{"location":"ReleaseNotes/#changes_4","title":"Changes","text":"<ul> <li>Information on the Debian Version in the Info/Installed Cameras screen now includes information on the system architecture (32-/64-bit) of the installed OS.</li> </ul>"},{"location":"ReleaseNotes/#new-features_7","title":"New Features","text":"<ul> <li>A new API WebService endpoint is provided:  <code>GET api probe</code> allows probing oject properties of live objects of an active raspiCamSrv server.  NOTE: This service is mainly intended for error analysis within a live system and requires detailed knowledge of the raspiCamSrv object model.  You can specify a set of object attributes for which attribute values shall be queried.  As objects, you select from the base singleton objects {Camera(), CameraCfg(), MotionDetector(), PhotoSeriesCfg() or TriggerHandler()} and then specify valid properties with dot-notation.   The result is returned in JSON format. Error messages are shown if an attribute is not JSON serializable.</li> </ul>"},{"location":"ReleaseNotes/#v354","title":"V3.5.4","text":""},{"location":"ReleaseNotes/#bugfixes_12","title":"Bugfixes","text":"<ul> <li>Corrected deprecated log level for Picamera2 logging from <code>Picamera2.ERROR</code> to <code>logging.ERROR</code>  (See raspi-cam-srv Issue #62)</li> </ul>"},{"location":"ReleaseNotes/#v353","title":"V3.5.3","text":""},{"location":"ReleaseNotes/#changes_5","title":"Changes","text":"<p>In dialog Web Cam, the button Memorize Configuration and Controls for Camera Change was renamed to Save Active Camera Settings for Camera Switch in order to more clearly express its functionality.  See raspi-cam-srv Issue #60</p>"},{"location":"ReleaseNotes/#v352","title":"V3.5.2","text":""},{"location":"ReleaseNotes/#bugfixes_13","title":"Bugfixes","text":"<ul> <li> <p>Fixed a bug which caused motion detection to be stalled after booting the Raspberry Pi.The error was caused by a race condition between start of the raspiCamSrv server and syncronization of system time with a time server.When time synchronization resets the system time while the live view is already active, this will signal inactivity for more than 10 sec and, therefore, immediately stop the live stream and subsequently close the camera.Since motion detection relies on an active live stream, this could cause blocking of the motion detection thread which then cannot be stopped except by restarting the server.Now, the system checks the system time synchronization status at startup and, if necessary, waits until time is syncronized with the time server.This resolves raspiCamSrv Issue #28: raspi-cam-srv seems to be frozen sometimesNOTE: This fix does not currently work when running raspiCamSrv as Docker Container</p> </li> <li> <p>Fixed missing Config screen for Docker installations</p> </li> </ul>"},{"location":"ReleaseNotes/#new-feature_2","title":"New Feature","text":"<ul> <li>The Info screen now shows the time when raspiCamSrv has recognized time synchronization, which can be considered as the server start time.</li> </ul>"},{"location":"ReleaseNotes/#v351","title":"V3.5.1","text":""},{"location":"ReleaseNotes/#bugfixes_14","title":"Bugfixes","text":"<ul> <li>Fixed video recording during motion tracking for Raspberry Pi models 1, 2, 3:For models Pi 4 and lower, video recording during motion tracking should use the Live View Configuration because this is usually set to lower resolution and should, therefore, not cause memory issues with these devices.Only for Pi 5, the Video Configuration should be used.Unfortunately, in versions up to V3.5.0, this was only applied to Pi 4 and Pi Zero, whereas for Pi 1, Pi 2 and Pi 3 the Video configuration was used.This is now corrected and for all models &lt;= Pi 4 the Live View configuration is used.</li> </ul>"},{"location":"ReleaseNotes/#v350","title":"V3.5.0","text":""},{"location":"ReleaseNotes/#new-features_8","title":"New Features","text":"<ul> <li>StepperMotor has got new functionality. In addition to the new methods <code>swing()</code> and <code>rotate_to(angle)</code>, the <code>current_angle</code> of rotation is tracked and can be set and queried.<code>swing()</code> allows stepwise rotations within given boundaries whereas <code>rotate_to(angle)</code> rotates to a specified angle.This functionality relies on Calibration and device status tracking.NOTE: If you have already a StepperMotor configured, it will not inherit the new functions. You will need to recreate it.</li> <li>Device Configuration for StepperMotor allows Calibration to set a specific orientation as zero reference.</li> <li>For devices requiring Calibration (currently only StepperMotor), the status is continuously tracked and memorized so that it can be restored after a restart or a renewed device access.NOTE: This may not work if the raspiCamSrv server is stopped while the StepperMotor is active.</li> <li>A new Camera [Trigger] is available: <code>when_series_photo_taken</code> allows assigning Actions when a photo has been taken within a Photo Series.The trigger does not fire in case of an Exposure Series or a Focus Stack</li> </ul>"},{"location":"ReleaseNotes/#changes_6","title":"Changes","text":"<ul> <li>Camera Actions do no longer trigger events. This means: if, for example, a Trigger has been specified when a Photo is taken, this trigger will no longer fire if the photo is taken as an action of another trigger.</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_15","title":"Bugfixes","text":"<ul> <li>API endpoint <code>api/start_triggered_capture</code> now also starts event handling and not only motion detection</li> <li>API endpoint <code>api/stop_triggered_capture</code> now also stops event handling and not only motion detection</li> <li>Fixed error <code>Camera.frames - Exception: argument of type 'NoneType' is not iterable</code> which could occur if button Load Stored Configuration has been pressed.</li> <li>Fixed Load Stored Configuration: Now, all background processes are stopped before the stored configuration is loaded, and they are restarted afterwards, if they had been active before.</li> <li>Fixed Reset Server: Now, all background processes are stopped before the configuration is set to default, and they are restarted afterwards, if they had been active before. Some missing configurations which may have led to errors have also been fixed.</li> <li>Made <code>table-layout:fixed</code> for Versatile Buttons and Action Buttons so that all columns have equal width and empty rows are shown.</li> <li>Multiple SMTP mails for the same Trigger are avoided.</li> <li>Fixed event notification. Due to a timing issue, sent mails could be incomplete and attachments may have been missing.</li> </ul>"},{"location":"ReleaseNotes/#v340","title":"V3.4.0","text":""},{"location":"ReleaseNotes/#new-features_9","title":"New Features","text":"<ul> <li>Under Actions, it is now possible to configure camera actions:take_photostart_videostop_videorecord_video with a configurable duration.</li> <li>Actions now support SMTP action for sending a mail in case of an event.</li> <li>Trigger allow configuring MotionDetector trigger for CAM-1: when_motion_detected.This trigger fires when a motion is detected by the cameras motion detection algorithms.</li> <li>Device Types for GPIO devices include now additional GPIO base classes which allows integrating more general devices:- DigitalInputDevice- DigitalOutputDevice- OutputDevice</li> <li>An indicator has been added which indicates unsaved configuration changes.</li> <li>The event log can now be downloaded from the Calendar view</li> </ul>"},{"location":"ReleaseNotes/#changes_7","title":"Changes","text":"<ul> <li>For Triggers with Source \"Camera\" the device names were changed:\"Active Camera\" -&gt; \"CAM-1\"\"Second Camera\" -&gt; \"CAM-2\"If triggers have been created with the old Device names, they will be renamed automatically when data are loaded from the stored configuration.</li> <li>For Versatile Buttons and Action Buttons the maximum number of rows and columns was changed from 9 to 99.</li> <li>Added favicon for browser tab</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_16","title":"Bugfixes","text":"<ul> <li>Fixed error<code>ERROR in camCfg: Error loading from /home/pi/server/raspi-cam-srv/raspiCamSrv/static/config/serverConfig.json: 'NoneType' object is not subscriptable</code>reported in raspi-cam-srv Issue #55</li> <li>Bugfixes and improvements for Class StepperMotor:For full-step mode, the waiting time is now doubled while speed range is unchanged. (1ms does not work)New methods step(steps) and rotate(angle) have been added, which allow positive and negative arguments.Rotations are now with higher precision. They are now in integers of motor steps rather than geared steps.For full-step mode, now two coils are activated in each step, instead of only one, which increases torque.</li> <li>Several tables which can become large, can now be scrolled with fixed headers.</li> </ul>"},{"location":"ReleaseNotes/#v330","title":"V3.3.0","text":""},{"location":"ReleaseNotes/#new-features_10","title":"New Features","text":"<ul> <li>Configuration of access to GPIO-connected devices through the gpiozero library.</li> <li>Extension of <code>gpiozero.OutputDevice</code> for support of Stepper Motors</li> <li>Configuration of Triggers for events from GPIO-connected input devices, such as sensors and buttons.</li> <li>Implementation of callback hooks for photo-related events ('when_photo_taken', 'when_recording_starts', 'when_recording_stops', 'when_streaming_starts', 'when_streaming_stops') for integration with the new event handling infrastructure.</li> <li>Configuring of Actions for GPIO-connected output devices.</li> <li>Configuration of Action Buttons and Console / Action Buttons for the direct manual execution of Actions with GPIO-connected output devices such as LEDs, motors and servos. This includes also the control of Stepper Motors.</li> <li>An option On Dial Marks has been added to Photo Series which assures that photos will be taken exactly (within tolerances) at every full hour, half hour, quarter, minute, ..., depending on the chosen interval.</li> </ul>"},{"location":"ReleaseNotes/#v320","title":"V3.2.0","text":""},{"location":"ReleaseNotes/#new-features_11","title":"New Features","text":"<ul> <li> <p>The Settings for Versatile Buttons now allows setting the commandline in Versatile Buttons to be interactive, which allows entering commands directly.</p> </li> <li> <p>Access to Online Help added to the different application screens.The Online Help button opens the document page on GitHub related to the active dialog.</p> </li> </ul>"},{"location":"ReleaseNotes/#v310","title":"V3.1.0","text":""},{"location":"ReleaseNotes/#new-features_12","title":"New Features","text":"<ul> <li>Functionality has bee added for configuration of Versatile Buttons for execution of commands on the level of the Raspberry Pi's Linux OS.This covers part of the request in Discussion #47.</li> </ul>"},{"location":"ReleaseNotes/#v300","title":"V3.0.0","text":""},{"location":"ReleaseNotes/#package-version-upgrade","title":"Package version upgrade","text":"<ul> <li>Released for Flask 3.1.0raspiCamSrv can use the current Flask version 3.xUpgrading Flask in an existing installation is not mandatory.In order to upgrade from Flask 3.0.0 to the latest version 3.x, proceed as follows:<code>cd prg/raspi-cam-srv/</code><code>source .venv/bin/activate</code><code>pip install --upgrade \"Flask&gt;=3,&lt;4\"</code></li> </ul>"},{"location":"ReleaseNotes/#v2130","title":"V2.13.0","text":""},{"location":"ReleaseNotes/#new-feature_3","title":"New Feature","text":"<ul> <li>RaspiCamSrv can now also be deployed in Docker.See Running raspiCamSrv as Docker Container</li> </ul>"},{"location":"ReleaseNotes/#v2120","title":"V2.12.0","text":""},{"location":"ReleaseNotes/#new-features_13","title":"New Features","text":"<ul> <li>The Info Screen has been extended by a section Streaming Clients which shows a list of clients which are currently using any of the camera streams. </li> </ul>"},{"location":"ReleaseNotes/#bugfixes_17","title":"Bugfixes","text":"<ul> <li> <p>Fixed TypeError which could occur if a paused Photo Series, for which no photos had been taken, was continued. </p> </li> <li> <p>Fixed an error where for a Photo Series with Interval &gt; 60 sec. an additional photo could have been taken about 1.5 sec. before the expected time when the regular photo is taken. If the waiting time between successive photos is &gt; 60 sec. and if no other process requires the camera, the camera is closed to minimize resource consumption. The waiting time is then shortened by 1.5 sec., to account for the time required for camera wakeup. If, however, the live stream is activated within 60 sec. before the time for the next photo, the camera is already active and this additional time is not required. </p> </li> <li> <p>Fixed an error for Photo Series with Interval &gt;&gt; 60 sec. for the case when the series was started while the live stream was still active. In this case, the photo series did not stop the camera during the waiting period because it was required by the live stream. If the photo series continued taking the next photo, it did not recognize that the camera was closed in the meantime. An attempt to take a photo caused the thread to stop without error notification.As a result, the series seemed to be active while it was actually dead.</p> </li> <li> <p>Fixed an error for Photo Series with Interval &gt; 60 sec. where controls (e.g. zoom/ScalerCrop) were not applied to the photos of the series, except probably for the first one.The reason was that the camera is closed if the waiting time for the next photo is &gt; 60 sec. and after restart the camara wasn't given time to pick up the controls settings. Now, an additional waiting time of 1 sec. has been added which resolves the issue.</p> </li> </ul>"},{"location":"ReleaseNotes/#v2114","title":"V2.11.4","text":""},{"location":"ReleaseNotes/#bugfix_2","title":"Bugfix","text":"<ul> <li>Fixed initialization of the raspiCamSrv API which did not work when a secrets file did not yet exist.</li> </ul>"},{"location":"ReleaseNotes/#v2113","title":"V2.11.3","text":""},{"location":"ReleaseNotes/#bugfix_3","title":"Bugfix","text":"<ul> <li> <p>Fixed \"TypeError: can only concatenate str\", which might occur in special cases for a Sun-controlled timelapse series.</p> </li> <li> <p>Fixed wrong display of Sunset in Timelapse series.</p> </li> <li> <p>Fixed \"KeyError: 'UnitCellSize'\" for cases where camera_properties do not include information on the physical size of the sensor\u2019s pixels</p> </li> </ul>"},{"location":"ReleaseNotes/#doc","title":"Doc","text":"<ul> <li>Added description for setup of stanalone systems</li> </ul>"},{"location":"ReleaseNotes/#v2112","title":"V2.11.2","text":""},{"location":"ReleaseNotes/#bugfix_4","title":"Bugfix","text":"<ul> <li>Fixed an issue where photos and videos could not be taken if the Transform settings for the different configuration were different.Now, when modifying the Transform (flip &lt;&gt; or flip v) are changed in one configuration this change is also applied to all other configurations.This covers raspiCamSrv Issue #33 Errors after changing Transform settings</li> </ul>"},{"location":"ReleaseNotes/#v2111","title":"V2.11.1","text":""},{"location":"ReleaseNotes/#bugfix_5","title":"Bugfix","text":"<ul> <li>Fixed an import error which occurred after having upgraded to V2.11 when package <code>flask-jwt-extended</code> has not yet been installed.</li> </ul>"},{"location":"ReleaseNotes/#v2110","title":"V2.11.0","text":""},{"location":"ReleaseNotes/#new-features_14","title":"New Features","text":"<ul> <li> <p>V2.11.0 introduces the new raspiCamSrv API for interoperability of raspiCamSrv with other software packages.This resolves the feature request raspi-cam-srv issue #34 API?</p> </li> <li> <p>Required installation actions:In order to allow API support, it is necessary to install an additional package.This can be done before or after the Update Procedure:<code>cd ~/prg/raspi-cam-srv</code><code>source .venv/bin/activate</code><code>pip install flask-jwt-extended</code></p> </li> </ul>"},{"location":"ReleaseNotes/#changes_8","title":"Changes","text":"<ul> <li>The Settings screen has been restructured to incorporate the additional settings required for the API</li> </ul>"},{"location":"ReleaseNotes/#v2105","title":"V2.10.5","text":""},{"location":"ReleaseNotes/#bugfixes_18","title":"Bugfixes","text":"<ul> <li> <p>Allowed port range in Trigger - Notification extended to [1 ... 65535]Partly resolves raspi-cam-srv issue #42 SMTP port issue</p> </li> <li> <p>Fixed Trigger Notification for SMTP servers which do not require authentication.It can now be specified whether or not the server requires authentication.Within the connection test it is checked whether the SMTP server requires SSL and authentication.If the requirements are not consistent with the settings on the Notification screen, an error message is shown.Resolves raspi-cam-srv issue #42 SMTP port issue</p> </li> </ul>"},{"location":"ReleaseNotes/#v2104","title":"V2.10.4","text":""},{"location":"ReleaseNotes/#bugfix_6","title":"Bugfix","text":"<ul> <li>Fixed function Load Stored Configuration on the Settings screen.After execution of this function, values shown on the Settings screen were only updated to the values loaded from the stored configuration after the page has been refreshed. Resolves raspi-cam-srv issue #39 load_config route assumes LiveStream2 exists (causes crash if non-existent)</li> </ul>"},{"location":"ReleaseNotes/#v2103","title":"V2.10.3","text":""},{"location":"ReleaseNotes/#bugfixes_19","title":"Bugfixes","text":"<ul> <li> <p>Fixed function Load Stored Configuration on the Settings screen.This function failed in cases when only a single camera is connected to a Raspberry Pi.Resolves raspi-cam-srv issue #39 load_config route assumes LiveStream2 exists (causes crash if non-existent)</p> </li> <li> <p>Fixed Switch Cameras on the Web Cam screen.If working with two cameras, this function caused an error when Triggered Capture of Videos and Photos, a Photo Series or Video Recording is currently active.The user is now asked to stop either of these processes before switching cameras.</p> </li> </ul>"},{"location":"ReleaseNotes/#v2102","title":"V2.10.2","text":""},{"location":"ReleaseNotes/#new-features_15","title":"New Features","text":"<ul> <li>Added kernel version and Debian version to Info screen.</li> </ul>"},{"location":"ReleaseNotes/#v2101","title":"V2.10.1","text":""},{"location":"ReleaseNotes/#bugfix_7","title":"Bugfix","text":"<ul> <li>Fixed an issue with platform-specific search of tuning files.</li> </ul>"},{"location":"ReleaseNotes/#v2100","title":"V2.10.0","text":""},{"location":"ReleaseNotes/#new-features_16","title":"New Features","text":"<ul> <li>Support of Camera Tuning by selection of alternate tuning files.Resolves raspi-cam-srv issue #26 NoIR camera settingsNote: There is still an issue when streaming two cameras. (See Picamera2 Issue #1103 Tuning file support not thread-safe?)</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_20","title":"Bugfixes","text":"<ul> <li>Fixed error <code>The browser (or proxy) sent a request that this server could not understand.</code> which ocurred when pressing Submit in the Control tab of the Trigger menu.Resolves raspi-cam-srv issue #27 Trigger Control Submit make server error</li> </ul>"},{"location":"ReleaseNotes/#v292","title":"V2.9.2","text":""},{"location":"ReleaseNotes/#bugdixes","title":"Bugdixes","text":"<ul> <li>Disallow changing parameters of a Photo Series after it had already been started.</li> </ul>"},{"location":"ReleaseNotes/#v291","title":"V2.9.1","text":""},{"location":"ReleaseNotes/#new-feature_4","title":"New Feature","text":"<ul> <li>Photo Series can be downloaded (see Downloading a Series)</li> </ul>"},{"location":"ReleaseNotes/#v290","title":"V2.9.0","text":""},{"location":"ReleaseNotes/#new-features_17","title":"New Features","text":"<ul> <li>The Photo Viewer has been enabled to download photos and to delete photos from the Raspberry Pi.</li> </ul>"},{"location":"ReleaseNotes/#v284","title":"V2.8.4","text":""},{"location":"ReleaseNotes/#bugfixes_21","title":"Bugfixes","text":"<ul> <li>When a Sun-controlled Photo Series was started, it could happen that the series end was recalculated without considering the configured time periods.Typically, this happened when the configured start time was earlier than the time when the series was actually started.Because this end time was in many cases earlier than the start of the next time slot, the series may have immediately stopped when the next period started.This is now fixed.</li> <li>In some cases when a series was finished because the configured end time has been reached, the background process did not stop and continued to produce photos with zero interval until the configured number of shots has been reached.</li> <li>When a Photo Series was paused and continued afterwards, the Current shots was incremented without taking a photo with this number. Therefore current shots did not represent the real number of photos and the series would be stopped before reaching the configured Number of shotsNow, Current shots is only incremented if a photo has been taken.</li> <li>When the waiting time for the next shot in a Photo Series is larger than 60 sec, RaspiCamSrv stops the camera and restarts it when the time is reached.However, the restart requires 1.5 sec waiting time to allow the camera to collect statistics for auto-exposure algos.Therefore, the phototaking is delayed by at least 1.5 sec with respect to the expected times.This is now compensated.The observed delay is now considerable smaller and ranges from ~0.2 sec for the first photo to ~0.04 sec for the next ones.</li> </ul>"},{"location":"ReleaseNotes/#changes_9","title":"Changes","text":"<ul> <li>When a new Photo Series is created, the start time is delayed by 1 minute with respect to the current time to give time for further configurations.</li> </ul>"},{"location":"ReleaseNotes/#v283","title":"V2.8.3","text":""},{"location":"ReleaseNotes/#bugfix_8","title":"Bugfix","text":"<ul> <li>Fixed layout issues in screen Settings for cases where Show Histograms and/or Ext Motion Detection are not supportet.</li> </ul>"},{"location":"ReleaseNotes/#v282","title":"V2.8.2","text":""},{"location":"ReleaseNotes/#bugfix_9","title":"Bugfix","text":"<ul> <li>The Bugfix introduced in V2.8.0 caused an error on systems like Pi Zero where modules cv2, matplotlib or numpy cannot be installed.This error is now fixed.If in your system the Settings screen shows that Ext. Motion Detection supported is checked and in screen Trigger/Motion the Motion Detection Algorithm list only shows \"Mean Square Diff\", you can try the following:Edit file <code>prg/raspi-cam-srv/raspiCamSrv/static/config/triggerConfig.json</code>Remove the part highlighted in the following screenshot, if it exists:</li> </ul>"},{"location":"ReleaseNotes/#v281","title":"V2.8.1","text":""},{"location":"ReleaseNotes/#changes_10","title":"Changes","text":"<ul> <li>Removed alternate type hints in module sun.These were introduced in Python 3.10.However in Raspberry Pi Zero systems Python 3.9 is installed.</li> </ul>"},{"location":"ReleaseNotes/#v280","title":"V2.8.0","text":""},{"location":"ReleaseNotes/#new-features_18","title":"New Features","text":"<ul> <li>For Photo Series, the page Timelapse Series now allows specification of up to two daily periods depending on sunrise and sunset.Refers to Discussion #21.</li> <li>On the Settings screen, new parameters for geographical latitude, longitude and elevation as well as a time zone selector have been added.Non-zero settings for these parameters are required for using Sun-controlled Photo Series</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_22","title":"Bugfixes","text":"<ul> <li>For Motion Detection, the list of supported algorithms had shown only \"Mean Square Diff\", even if Ext. Motion Detection supported was activated in the Settings screen.Now all available algorithms can be selected and used if the modules cv2, matplotlib and numpy are installed on the system (see RaspiCamSrv Installation, 11)</li> </ul>"},{"location":"ReleaseNotes/#v271","title":"V2.7.1","text":""},{"location":"ReleaseNotes/#bugfixes_23","title":"Bugfixes","text":"<ul> <li>Images from a photo snapshot URL (see Web Cam) could not be saved using 'save as' from the context menu.  The reason was that these images still contained the framing and mime type from MJPEG streaming.  This is now fixed.  This solves raspi-cam-srv Issue #22</li> </ul>"},{"location":"ReleaseNotes/#v270","title":"V2.7.0","text":""},{"location":"ReleaseNotes/#new-features_19","title":"New Features","text":"<ul> <li>For streaming access, it can now be configured in the Settings screen whether authentication is required or not.  The default is that authentication is not required, as before.  This modification has been made for Feature Request #20</li> </ul>"},{"location":"ReleaseNotes/#changes_11","title":"Changes","text":"<ul> <li>The default log level for libcamera was set to ERROR instead of WARNING in order to suppress V4L2 pixel format warnings.</li> </ul>"},{"location":"ReleaseNotes/#v263","title":"V2.6.3","text":""},{"location":"ReleaseNotes/#bugfixes_24","title":"Bugfixes","text":"<ul> <li>Fixed <code>Error starting camera: main stream should be a dictionary</code> which accurred at server start, if an active Photoseries with Photo Type \"raw+jpg\" was configured to be Continued on Server Start.</li> <li>When a Photoseries is automatically continued on server start/restart, previous versions did not allow seeing the live stream while the Photoseries was active. Now, if the photo series configuration is compatible with live stream configuration, you will see the live stream also after automatic continuation of the series.</li> </ul>"},{"location":"ReleaseNotes/#v262","title":"V2.6.2","text":""},{"location":"ReleaseNotes/#bugfixes_25","title":"Bugfixes","text":"<ul> <li>Fixed <code>Exception: 'NoneType' object has no attribute 'get'</code> which occurred when taking a video which requres exclusive camera access.    The reason was that, while stopping the live stream, it was not recognized that video recording was intended. As a result, the camera was closed and access to the camera during video recording lead to this error.  Refers to: raspi-cam-srv Issue #18.</li> <li>Fixed <code>AttributeError: 'NoneType' object has no attribute 'requestStop'</code> which could occur after applying Reset Server in the Settings screen.</li> </ul>"},{"location":"ReleaseNotes/#changes_12","title":"Changes","text":"<ul> <li>For Raspberry Pi models lower than model 5 (Zero, 1, 2, 3, 4),   the Configuration for Photo is initialized with the lowest Sensor Mode  and the Buffer Count for Video is set to 2, identical with Live View.   This makes all configurations compatible and allows for the Live Stream parallel to Video Recording, when using the default configuration.   Refers to: raspi-cam-srv Issue #18.</li> </ul>"},{"location":"ReleaseNotes/#v261","title":"V2.6.1","text":""},{"location":"ReleaseNotes/#bugfixes_26","title":"Bugfixes","text":"<ul> <li>With deactivated Sync Aspect Ratio, the aspect ratio of different configurations was nevertheless synced. This is now fixed.</li> <li>When activating Sync Aspect Ratio, after it was previously deactivated, all aspect ratios were set to the one of Live View and not to the currently selected configuration.</li> <li>When activating Sync Aspect Ratio, after it was previously deactivated, ScalerCrop was not automatically updated.</li> </ul>"},{"location":"ReleaseNotes/#v260","title":"V2.6.0","text":""},{"location":"ReleaseNotes/#new-features_20","title":"New Features","text":"<ul> <li>Zoom and Pan has been completely reworked.  It now takes regard of the ScalerCrop specifics of Raspberry Pi cameras.   This allows full control of image areas also for cases with extreme aspect ratios.   Note: For cases where the height of the Stream Size is considerably larger than its width, the live stream in the Live screen may exceed the page height. This cannot currently be avoided without loosing the capability of graphical focus and zoom.</li> <li>The Config screen now has an option to synchronize aspect reatios of Stream Sizes across all configurations.   If this is activated and a non-standard aspect ratio is configured, for example, for the Live View, the Stream Sizes for the other configurations will be adjusted to the same aspect ratio.   Then the Live Stream will no longer be distorted because the camera system will select a ScalerCrop with the same aspect ratio.</li> <li>The Info screen in section Camera x now shows the Sensor Mode in which the camera is currently operating if the camera is currently started.</li> </ul>"},{"location":"ReleaseNotes/#changes_13","title":"Changes","text":"<ul> <li>Camera Configuration for Raw Photo now allows Custom Stream Size.   However, if a Stream Size is specified which does not correspond to the output_size of one of the cameras Sensor Modes, the camera will automatically select a suitable Sensor Mode and produce a .dng file with the corresponding size.   The reason for this change was that the new option to automatically syncronize aspect ratios across configurations can lead to a custom Stream Size also for the Raw Photo configuration.</li> <li>The parameter Stream Size aligned with Sensor Modes in the Configuration now dafaults to False.   The reason for this change is that, when specifying identical Stream Sizes for lores and main streams, the camera could produce an error <code>Error starting camera: lores stream dimensions may not exceed main stream</code> because the automatic alignment might produce effective Stream Sizes which violate tis restriction.</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_27","title":"Bugfixes","text":"<ul> <li>Zooming did not preserv image center</li> </ul>"},{"location":"ReleaseNotes/#v254","title":"V2.5.4","text":""},{"location":"ReleaseNotes/#bugfixes_28","title":"Bugfixes","text":"<ul> <li>Avoid <code>Error starting camera: lores stream dimensions may not exceed main stream</code>  Now, when specifying any Camera Configuration, it is checked whether the specified Stream Size for the different use cases obey the restriction that stream size for 'lores' must be less than stream size for 'main' stream.   If the restriction is violated, an error message is shown and the previous values are restored.</li> <li>In Camera Configuration for Photo, Stream could be changed to 'lores' in the dialog, but this change has not been stored. Now fixed</li> <li>Fixed: --- Logging error --- ... camera_pi.py\", line 793, in clearConfig</li> </ul>"},{"location":"ReleaseNotes/#v253","title":"V2.5.3","text":""},{"location":"ReleaseNotes/#bugfixes_29","title":"Bugfixes","text":"<ul> <li>The previous fix was not robust enough and really worked only with debugging activated..   Now, the camera is given a second more time after different steps of switching.</li> </ul>"},{"location":"ReleaseNotes/#v252","title":"V2.5.2","text":""},{"location":"ReleaseNotes/#bugfixes_30","title":"Bugfixes","text":"<ul> <li>Switching the camera caused <code>RuntimeError: Unable to stop preview.</code> (see raspi-cam-srv Issue #14).   This is now fixed. Switching the camera can be done from the Settings screen as well as from the WebCam screen.</li> </ul>"},{"location":"ReleaseNotes/#v251","title":"V2.5.1","text":""},{"location":"ReleaseNotes/#new-features_21","title":"New Features","text":"<ul> <li>During Motion Capture, framerates are also reported for the Mean Square Diff algorithm.   See Testing Motion Capturing</li> </ul>"},{"location":"ReleaseNotes/#v250","title":"V2.5.0","text":""},{"location":"ReleaseNotes/#new-features_22","title":"New Features","text":"<ul> <li>Extended Motion Capturing Algorithms are available, including Frame Differencing, Optical Flow and Background Subtraction</li> <li>The Extended Motion Capturing Algorithms can be run in a testing mode, showing live views of intermediate image processing results which can help for a better understanding of the algorithms and adjustment of their variable parameters.</li> </ul>"},{"location":"ReleaseNotes/#changes_14","title":"Changes","text":"<ul> <li>For Motion Detection, Trigger Parameters (see Database for Events) have been changed from format \"string\" to Python Dictionary, allowing multiple parameters for the Extended Motion Capturing Algorithms.   Existing database entries with string format are still supported.</li> </ul>"},{"location":"ReleaseNotes/#v243","title":"V2.4.3","text":""},{"location":"ReleaseNotes/#bugfixes_31","title":"Bugfixes","text":"<ul> <li>When data for an ACTIVE Photo Series were changed, the status of the series was set back to \"READY\" but the thread was still active.   Now, for an ACTIVE or PAUSED series, the Photo Type and Start can no longer be changed.   The status will be promoted only for a NEW series.   For a series in status FINISHED, data can no longer be modified.</li> <li>The ERROR <code>Could not import SensorConfiguration from picamera2.configuration</code>, which occured on Bullseye systems was changed to INFO</li> </ul>"},{"location":"ReleaseNotes/#v242","title":"V2.4.2","text":""},{"location":"ReleaseNotes/#bugfixes_32","title":"Bugfixes","text":"<ul> <li>If livestream terminates, camera is closed if a Photo Series is active (no Exposure Series or Focus Stack) and if the time to the next shot is larger than 60 sec.   In the previous version, the camera would not have been closed if a Photo Series was active at the time when the livestream terminated.   If, for example, the interval for the Photo Series would have been 1 hour and if the livestream would have been activated shortly after a shot was taken, the camera would have been open and started for about one hour and only be closed after the next shot of the series.</li> </ul>"},{"location":"ReleaseNotes/#v241","title":"V2.4.1","text":""},{"location":"ReleaseNotes/#new-features_23","title":"New Features","text":"<ul> <li>Process information for the Flask server process and its threads has been added to the Info screen </li> <li>Camera status information has been added to the Info screen</li> </ul>"},{"location":"ReleaseNotes/#improvements","title":"Improvements","text":"<ul> <li>Cameras are now stopped and closed in times when they are not active.  As a consequence, the number of active threads and CPU utilization is reduced in phases when cameras are not streaming and no other background processes (video recording, photo series, motion capturing) are active.   For more details, see Camera Status and Number of Threads</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_33","title":"Bugfixes","text":"<ul> <li>Code Generation did not generate import statements.</li> <li>Error status for Triggered Capture of Videos and Photos which had been stored with Store Configuration are now cleared if server is started with stored configuration</li> </ul>"},{"location":"ReleaseNotes/#v240","title":"V2.4.0","text":""},{"location":"ReleaseNotes/#new-features_24","title":"New Features","text":"<ul> <li>Photo Series can be set to be automatically continued on server start if they had been interrupted by a server stop or system shotdown or reboot.</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_34","title":"Bugfixes","text":"<ul> <li>The active Photo Series had always been set to the alphabetically last series in case of a server start/restart, even if another series had been active at the time when the server was stopped.   Now, if a series with status \"ACTIVE\" is found when the server is started, this series will be set as active series.</li> </ul>"},{"location":"ReleaseNotes/#v236","title":"V2.3.6","text":""},{"location":"ReleaseNotes/#bugfixes_35","title":"Bugfixes","text":"<ul> <li>Fixed error <code>[Errno 12] Cannot allocate memory</code> for Raspberry Pi 3.   (See raspi-cam-srv Issue #9)   Lower values for buffer_count are now also used for Pi 3, Pi 2 and Pi 1. in the same way as for Pi 4 and Pi Zero.</li> </ul>"},{"location":"ReleaseNotes/#v235","title":"V2.3.5","text":""},{"location":"ReleaseNotes/#bugfixes_36","title":"Bugfixes","text":"<ul> <li>Fixed issue with endpoints photo_feed and photo_feed2:   These endpoints use the live streams for the available cameras. However, if the live stream was not active at the time when a client requested this endpoint, no photo was shown. Only when live streams were activated through the raspiCamSrv Web UI, photos were shown.  Now, when these endpoints are requested, the system automatically starts a live stream if it is currently not active and delivers a photo.</li> </ul>"},{"location":"ReleaseNotes/#v234","title":"V2.3.4","text":""},{"location":"ReleaseNotes/#new-features_25","title":"New Features","text":"<ul> <li>e-Mail notification on motion capturing events (see Notification)</li> </ul>"},{"location":"ReleaseNotes/#v233","title":"V2.3.3","text":""},{"location":"ReleaseNotes/#bugfixes_37","title":"Bugfixes","text":"<ul> <li>Starting server with stored Configuration (Settings) did not correctly set a previously configured Zoom (ScalerCrop). Instead, ScalerCrop was set to the active camera's pixel array size (see raspiCamSrv Issue #7). This was done only during initial system start and not after manually applying Load Stored Configuration in Settings.  Now, the stored ScalerCrop is no longer overwritten, if a zoom (&lt;&gt;100%) has been explicitely applied (\"include_scalerCrop\": true in controls.json).</li> </ul>"},{"location":"ReleaseNotes/#v232","title":"V2.3.2","text":""},{"location":"ReleaseNotes/#improvements_1","title":"Improvements","text":"<ul> <li>Error handling has been improved. Server errors, also from background threads, are routed to the web client.  This does not apply to errors occurring in encoders which are running in own threads. Exceptions thrown in these threads are currently not handled by raspiCamSrv.  Error reasons are mostly invalid combinations of Configuration parameters, especially with Stream Format</li> </ul>"},{"location":"ReleaseNotes/#bugfixes_38","title":"Bugfixes","text":"<ul> <li>After applying Swith Cameras in page Web Cam, Title and metadata for the second camera were identical to those of the first camera.</li> <li>Reset Server may have caused errors in streaming or other functions</li> <li>In Config, raw stream can no longer be configured for Live View, Photo, and Video</li> </ul>"},{"location":"ReleaseNotes/#v231","title":"V2.3.1","text":""},{"location":"ReleaseNotes/#bugfixes_39","title":"Bugfixes","text":"<ul> <li>Avoid flooding with console error message \"Motion detection thread did not stop within 5 sec\".   Now assuming that thread does no longer exist.</li> <li>Fixed error <code>TypeError: can only concatenate str (not \"NoneType\") to str</code> which could occur in <code>motionDetector.py</code> if video recording failed after motion detection.  In this case, there has been an error message in events logfile</li> <li>Encoder Bitrate is no longer specified when recording a video (before it was set to 10000000)</li> <li>Changed loglevel from <code>debug</code> to <code>error</code> when an exception occurred during video recording</li> <li>Added error log when encoder could not be started after motion capture.  Previously, the error was only shown in the events logfile</li> <li>For Raspberry Pi 4, the default sensor mode is set to 0 (lowest resolution) in order to avoid encoder errors.</li> <li>For Raspberry Pi 4, motion capture videos are recorded from the lowres stream with Live View configuration</li> <li>For Raspberry Pi 4, default buffer count was reduced to 2 for live view and 4 for video</li> </ul>"},{"location":"ReleaseNotes/#v230","title":"V2.3.0","text":""},{"location":"ReleaseNotes/#new-features_26","title":"New Features","text":"<ul> <li>Streaming of second camera added (see Webcam page). A single raspiCamSrv server can now simultaneously stream both cameras connected to a Raspberry Pi 5.</li> <li>The camera configuration and controls for the active camera can be preserved also for a situation when this camera acts as \"other\" camera.</li> <li>Streaming configurations for both cameras are stored together with the entire configuration (see Settings) and can be loaded on server restart.</li> </ul>"},{"location":"ReleaseNotes/#v223","title":"V2.2.3","text":""},{"location":"ReleaseNotes/#bugfixes_40","title":"Bugfixes","text":"<ul> <li>For Raspberry Pi Zero, use the lowres stream (Live View Configuration) for recording videos during motion capture.  During motion capture, the Live View camera configuration is used because the live stream is required for detecting motion. However, the Buffer Count of 2, used for this configuration for Pi Zero (see V2.1.2), is too small for video recording with the resolution of the Video configuration.</li> <li>Fixed an error which could occur when viewing events when placeholder photos for videos were not yet read from the database.</li> </ul>"},{"location":"ReleaseNotes/#v222","title":"V2.2.2","text":""},{"location":"ReleaseNotes/#new-feature_5","title":"New Feature","text":"<ul> <li>Added an option to automatically start motion capture with the Flask server.  Thus, if server start is done in a service, motion capturing will automatically be active if the device is booted.  (See Triggered Capture of Videos and Photos)</li> </ul>"},{"location":"ReleaseNotes/#v221","title":"V2.2.1","text":""},{"location":"ReleaseNotes/#bugfixes_41","title":"Bugfixes","text":"<ul> <li>Prevent changing settings while the trigger-capture process is active</li> <li>Prevent changing camera configuration while the trigger-capture process is active</li> <li>Prevent starting an Exposure Series or a Focus Stack Series while the trigger-capture process is active</li> <li>Fixed \"ValueError: could not convert string to float: ''\" which may have ocurred for Exposure Series or Focus Stack Series with a camera having no focus support</li> </ul>"},{"location":"ReleaseNotes/#v220","title":"V2.2.0","text":""},{"location":"ReleaseNotes/#installation-hints","title":"Installation Hints","text":"<p>This version has a new database schema with tables used for captured events.</p> <p>After an update with <code>git pull</code>, you need to initialize the database with  <code>flask --app raspiCamSrv init-db</code>  before starting the server.  This will also recreate the user database and requires new registration.</p> <p>Services should be stopped during upgrade</p>"},{"location":"ReleaseNotes/#new-feature_6","title":"New Feature","text":"<ul> <li>Introduced basic motion capturing (see Triggered Capture of Videos and Photo)</li> </ul>"},{"location":"ReleaseNotes/#v212","title":"V2.1.2","text":""},{"location":"ReleaseNotes/#bugfix_10","title":"Bugfix","text":"<ul> <li>For Raspberry Pi Zero, the \"Buffer Count in the Configuration for Live View and Video has been reduced to 2 and 4, respectively because of memory issues.  Also, the default Sensor Mode for Video* has been set to the lowest (0) mode, rather than to the highest.</li> </ul>"},{"location":"ReleaseNotes/#v211","title":"V2.1.1","text":""},{"location":"ReleaseNotes/#known-issues","title":"Known issues","text":"<ul> <li>On Pi Zero, there seems to be issues with parallel live stream on lores and video recording or phototaking on main.  Got <code>Camera frontend has timed out!</code> exception.  Probably, this feature needs to be deactivated on these platforms. Need to study in more details.</li> </ul>"},{"location":"ReleaseNotes/#new-features_27","title":"New Features","text":"<ul> <li>The Camera Information screen now shows also information on the Raspberry Pi version and board version.</li> </ul>"},{"location":"ReleaseNotes/#bugfix_11","title":"Bugfix","text":"<ul> <li>For Raspberry Py systems Pi 4 and earlier, the Stream Format for Live view is initialized with \"YUV420\".   According to the Picamera2 Manual ch. 4.2, p. 16, this format must be used for these systems for the lowres stream which is now the default for Live View.  The list of values for the lowres stream in the Config dialog is not restricted to YUV format, however, if an other format is selected, an error message is shown and the parameter remains at \"YUV420\".</li> <li>On Bullseye systems (Pi Zero), the package picamera2.configuration does not currently include the class SensorConfiguration. Also the CameraConfiguration class does not contain the element sensor.  This caused an \"Import Error\" when starting the server.  This error is now captured and, if it occurs, the sensor element in the configuration is ignored.</li> </ul>"},{"location":"ReleaseNotes/#v210","title":"V2.1.0","text":""},{"location":"ReleaseNotes/#new-features_28","title":"New Features","text":"<ul> <li>Added endpoint for photo snapshots (raspi-cam-srv Issue #5) (see Web Cam)</li> </ul>"},{"location":"ReleaseNotes/#v200","title":"V2.0.0","text":""},{"location":"ReleaseNotes/#new-features_29","title":"New Features","text":"<ul> <li>Major modification of camera control to allow non-exclusive access to the camera from parallel tasks.  Phototaking, video recording and photoseries do no longer interrupt the live stream if the required camera configurations are compatible.   (See raspiCamSrv Tasks and Background Processes)</li> <li>Added code generation to the camera module.  The code used for interaction of raspiCamSrv with Picamera2 is logged into a file specific for each server run. This generates executable Python code, suitable to 'replay' the entire camera interaction of a raspiCam Server run.   This can be used for testing and error analysis.  (See Generation of Python Code for Camera)</li> </ul>"},{"location":"ReleaseNotes/#changes_15","title":"Changes","text":"<ul> <li>The camera configuration for VIDEO is now initialized with the sensor mode with the largest stream size in order to allow simultaneous use of main stream for Photo and Video.</li> </ul>"},{"location":"ReleaseNotes/#refactoring","title":"Refactoring","text":"<ul> <li>General refactoring of \"Timelapse series\" to \"Photo Series\".  Timelapse series are now just a special kind of photo series.</li> <li>The folder <code>raspi-cam-srv/raspiCamSrv/static/timelapse</code> is no longer used.  Instead, photo series are now stored in folder <code>raspi-cam-srv/raspiCamSrv/static/photoseries</code>  This folder will be automatically created at the first server start.  If you have stored photoseries under the <code>timelapse</code> folder, you can move them to the <code>photoseries</code> folder and then delete the <code>timelapse</code> folder.  For each series, you need to exchange <code>/timelapse/</code> with <code>/photoseries/</code> in the <code>*_cfg.json</code> files</li> </ul>"},{"location":"ScalerCrop/","title":"Image Cropping and Sensor Modes","text":""},{"location":"ScalerCrop/#pixel-array-size-and-sensor-modes","title":"Pixel Array Size and Sensor Modes","text":"<p>Raspberry Pi cameras have sensors with various Pixel Array Sizes which are shown in the Camera Properies section of the Info screen.</p> <p>For example, the V3 camera (Imx708) has a PixelArraySize of 4608 x 2592 pixels.</p> <p></p> <p>A camera can operate in a limited number of Sensor Modes (e.g. Sensor Modes 0, 1, 2 for the Imx708).</p> <p>Information on Sensor Modes is shown in the Sensor Mode x section of the Info screen.</p> <p>Each Sensor Mode is characterized by (among others) </p> <ul> <li>a Bit Depth</li> <li>a Frame Rate</li> <li>a specific field of view (Crop Limits) which either spans the entire PixelArraySize or a subarea of it.</li> <li>an output size which specifies the resolution of the image obtained with this Sensor Mode.  Here, an image pixel corresponds to a single sensor pixel or a group of 2x2 pixels.  The output sizes for Imx708 are   Sensor Mode 0: 1536 x 864   Sensor Mode 1: 2304 x 1296   Sensor Mode 2: 4608 x 2592</li> </ul>"},{"location":"ScalerCrop/#cropping","title":"Cropping","text":"<p>Raspberry Pi cameras can deliver images from a subarea of the sensor.   This area is specified by the Camera Controls parameter ScalerCrop which can be specified in the Zoom and Pan section of the Live screen of raspiCamSrv.</p> <p>The effective ScalerCrop rectangle (ScalerCrop Zoop/Pan) is restricted by parameters which can be obtained from the <code>camera_controls</code> (see Picamera2 Manual, Appendix B)</p> <p>NOTE: All rectangles are specified by a tuple (xOffset, yOffset, width, height)</p> <ul> <li>ScalerCrop Maximum   This is the largest rectangle in which the effective ScalerCrop rectangle must be completely enclosed.   This rectangle is limited by the Crop Limits of the Sensor Mode.</li> <li>Scaler Crop Minimum  This is the smallest area which can be delivered by the camera.   Only width and height are relevant and width and height of the effective ScalerCrop rectangle must not be smaller.</li> <li>Scaler Crop Default    This is the default ScalerCrop rectangle which will always be chosen by the camera if an effective ScalerCrop rectangle is not requested within the Camera Properties.    </li> </ul> <p>Whereas in a standard case, ScalerCrop Maximum and ScalerCrop Default cover the entire PixelArraySize, the pictures below show the situation for two extreme cases:</p> <p> </p>"},{"location":"ScalerCrop/#strategy","title":"Strategy","text":"<p>The strategies, by which the camera operates, are not fully documented in detail.  However, systematic experiments with the relevant parameters show the following bahavior:</p> <ul> <li>Use the Camera Configuration to specify the Stream Sizes for different use cases.   The most 'relevant' configuration seems to be the raw stream.   A special option (Sync Aspect Ratio) assures consistent aspect ratios for all configurations.</li> <li>Depending on the 'relevant' Stream Size, the camera will automatically choose a suitable Sensor Mode.   The active Sensor Mode can be seen in the Installed Cameras section of the Info screen for the active camera if it is currently open and started.   NOTE: raspiCamSrv will normally use configurations where all 3 streams (raw, main, lores) are configured in order to allow simultaneous camera access with different intents.</li> <li>From the Crop Limits of the Sensor Mode the ScalerCrop Maximum rectangle is determined. </li> <li>The ScalerCrop Default is the largest rectangle,   which has the aspect ratio of the 'relevant' Stream Size,   and which is fully inside the Crop Limits of the active Sensor Mode,  and which is horizontally and vertically centered.</li> <li>Zooming and Panning allows scaling the rectangle and panning it within the area of the ScalerCrop Maximum rectangle.   Zooming and Panning with raspiCamSrv always preserves the aspect ratio.</li> <li>Finally, the effective ScalerCrop area is scaled to the Stream Size of the different streams</li> </ul> <p>Because the aspect ratio of the ScalerCrop Zoom/Pan rectangle is determined from the aspect ratio of the 'relevant' stream, the Live Stream will be distorted if the aspect ratio for the Live View configuration is different from that of the configuration for the 'relevant' stream.</p>"},{"location":"Settings/","title":"raspiCamSrv Settings","text":"<p>The Parameters section of the Settings screen is used for specification of general parameters.</p> <p>Other sections focus on</p> <ul> <li>Server Configuration</li> <li>User Management</li> <li>API Management</li> <li>Versatile Buttons</li> <li>Action Buttons</li> <li>Devices</li> <li>Update</li> </ul> <p>Users and/or API may be invisible, depending on context.   For the case that no camera is connected, see Settings (No Camera).</p> <p></p> <p>The General Paramenters include</p> <ul> <li>Active Camera allows explicitely setting the active camera for systems with multiple cameras.</li> <li>Use USB Cameras, when activated will allow connected USB cameras to be used as Active or Second Camera (see also Multi Cam)NOTE: When deactivating Use USB Cameras, make sure that none of the USB cameras is currently streaming.</li> <li>Audio settings for systems with microphones if sound is to be recorded along with videos</li> <li>Path for Photos/Videos shows the path where media will be stored.</li> <li>File types for Photo, Raw Photo and Video</li> <li>Use Stereo Vision allows activating Stereo capabilities for systems having 2 non-USB cameras of the same type connected.</li> <li>Show Histograms allows activatig/deactivating Histograms display of histograms</li> <li>Ext. Motion Detection supported shows whether the actually installed libraries allow support of Extended Motion Tracking Algoritms</li> <li>Req. Auth for Streaming controls whether streaming requires authentication</li> <li>Allow access through API shows whether the installed libraries allow secure API access.Also if it is supported, it can be deactivated.</li> <li>The geo-coordinates Latitude, Longitute, Elevation as well as the Time Zone are required for sun-calculations in Sun-controlled Timelapse Photo Series.</li> </ul>"},{"location":"Settings/#switching-the-active-camera","title":"Switching the active Camera","text":"<p>On systems which allow connection of multiple cameras (e.g. Pi 5), it is possible to switch the active camera.  Only non-USB cameras are offered for selection (see also Information)</p> <p></p>"},{"location":"Settings/#disabling-use-of-usb-cameras","title":"Disabling Use of USB Cameras","text":"<p>If you have connected one or more USB cameras to a Raspberry Pi, you can exclude them from being available in raspiCamSrv.  They will still be shown in the Info screen but they are no longer offered as choice for camera selection in the Settings or Multi Cam screen.</p> <p>If a USB camera was set as Active Camera or as Second Camera, this will be replaced by a CSI camera.</p> <p>If no CSI cameras are present, the UI will switch to the \"No-Camera\" mode (Settings (No Camera)).</p>"},{"location":"Settings/#configuring-authentication-for-streaming","title":"Configuring Authentication for Streaming","text":"<p>It can be configured whether streaming of videos or photos requires authentication:</p> <p></p> <ul> <li>If the checkbox is not checked, the system allows access to video streams or photos for everybody without authentication.</li> <li>If the checkbox is checked, video streams or photos can only be accessed if a valid session is active.  If a streaming URL is entered in a browser and there is no valid Flask session, the login screen is shown and, after having entered valid credentials, the Live screen is shown. Now, the desired streaming URL can be directly entered or selected from the Web Cam screen.  A valid Flask session exists, if login has been passed once within an active browser instance, either in another tab of the browser window intended for streaming or within another window of the same browser.  Closing all windows of a browser kills the session. </li> </ul>"},{"location":"Settings/#activating-and-deactivating-stereo-vision","title":"Activating and Deactivating Stereo Vision","text":"<p>If your system has 2 non-USB cameras of the seme model connected, you can use these as stereo camera system.</p> <p>raspiCamSrv supports basic stereo features such as 3D Videos and Depth Maps as well as Calibration and Rectification.</p> <p>These features can only be activated if it has been recognized at system startup that 2 non-USB cameras of the same model are connected to the system.   In addition, it is required that OpenCV, and numpy are installed (see RaspiCamSrv Installation Step 11).    </p> <p>If any of these conditions is not met, the reason will be indicated:</p> <p></p> <p>NOTE: Stereo Vision should only be activated if both cameras are mounted (or at least arranged) in a typical stereo camera setup. I am using a 3D-printed Raspberry Pi Camera 3 Stereo Case</p> <p></p>"},{"location":"Settings/#activating-and-deactivating-histograms","title":"Activating and Deactivating Histograms","text":"<p>raspiCamSrv can show histograms for photos.  Histograms are generated with OpenCV. This requires that the packages OpenCV, numpy and matplotlib are installed (see RaspiCamSrv Installation Step 9)   </p> <p>If these packages are installed, you can select whether or not to Show Histograms.  The default on first server start is to show histograms.</p> <p>It may be necessary on smaller systems (Raspberry Pi Zero W, Raspberry Pi Zero 2 W) to deactivate this option because of memory restrictions.  If the option is deactivated, the modules are not loaded and histograms will not be displayed, even if all packages are installed.</p> <p>The system will automatically detect whether or not the required packages are installed and accessible. If this is not the case, this will be indicated:</p> <p></p>"},{"location":"Settings/#extended-motion-detection-support","title":"Extended Motion Detection Support","text":"<p>In all installations, Motion Capturing with the Mean Square Difference algorithm are supported.</p> <p>In order to also be able to use the extended algorithms, the following modules must be installed (see Installation procedure, Step 11):</p> <ul> <li>OpenCV</li> <li>numpy</li> <li>matplotlib</li> </ul> <p>When the server starts up, it will be checked whether these modules can be imported.  If the import had failed, this will be indicated on the Settings screen in the same way as for Histograms, above.  Then, only the Mean Square Difference algorithm will be offered  for choice on the Trigger/Motion tab.</p>"},{"location":"Settings/#recording-audio-along-with-video","title":"Recording Audio along with Video","text":""},{"location":"Settings/#preconditions","title":"Preconditions","text":"<p>If a microphone, such as a USB microphone is connected to the Raspberry Pi, it is possible to record audio along with videos.</p> <p>Picamera2 accesses the microphone through PulseAudio. PulseAudio daemons (<code>pulseaudio.socket</code> and <code>pulseaudio.service</code>) are running as user units and not as system units.</p> <p>In order to access the microphone, raspiCamSrv needs to run in the user environment, too.  This is automatically the case when the Flask service is directly started from the command line in the raspiCamSrv virtual environment with  <code>flask --app raspiCamSrv run --debug --host=0.0.0.0</code></p> <p>Alternatively, raspiCamSrv can be configured as user service as described in README / Service Configuration for Audio Support</p>"},{"location":"Settings/#configuration","title":"Configuration","text":"<p>raspiCamSrv will automatically detect whether a microphone is connected and accessible through PulseAudio.</p> <p>If this is the case, the default microphone will be shown in the Settings screen:   Also the checkbox Record Audio along with Video is enabled for change.</p> <p>If the checkbox is checked, audio will be recorded when a video will be recorded.</p> <p>If no microphone is connected or the microphone is not accessible through PulseAudio (because raspiCamSrv runs as system service), this will be indicated as   and the Record Audio along with Video checkbox is disabled.</p> <p>Microphones can be plugged in/out without stopping the system. After a refresh of the Settings screen, the system will detect the changed setup.</p> <p>If multiple microphones are plugged in, PulseAudio will automatically select a default microphone.  If the selected microphone is not the intended one, plug it out temporarily. Pulse Audio will automatically select another default and keep it.</p>"},{"location":"Settings/#audiovideo-synchronization","title":"Audio/Video Synchronization","text":"<p>Due to timing issues of audio and video subsystems, there may be a delay between video and audio.  The discrepancy is typically in subsecond range.</p> <p>Test videos should be made with something like a clapperboard. In case of delays, the Audio Timeshift value should be adjusted (it can be positive or negative) until video and audio are in sync.</p>"},{"location":"Settings/#api-access","title":"API Access","text":"<p>API access to raspiCamSrv is protected through JSON Web Tokens (JWT).This requires the module <code>flask_jwt_extended</code>, which is first used in raspiCamSrv V2.11.</p> <p>If the upgrade to this version has been done without installing this module (see Release Notes V2.11), the system will show a hint  and also hide the API section</p> <p>In this case, the module can be installed (see Release Notes V2.11) and after the server has been restarted, it shows as   which now allows activating or deactivating API support.</p> <p>If the setting is changed, it is necessary to</p> <ol> <li>Store the configuration</li> <li>Make sure that the server is configured to Start with stored Configuration</li> <li>Restart the server (Button Restart Server in Settings/Configuration)</li> </ol> <p>This will be indicated through the hint</p> <p></p>"},{"location":"SettingsAButtons/","title":"Settings - Action Buttons","text":"<p>On this screen, you can 'design' the Console Action Buttons by assigning visual attributes and Actions to Buttons arranged on a grid.</p> <p></p> <p>The general usage of this screen is similar to that for configuring Versatile Buttons, except that an Actions needs to be assigned to a button.</p>"},{"location":"SettingsAPI/","title":"Settings API","text":"<p>In this section of the Settings screen, parameters for protection of the API through JSON Web Tokens (JWT) can be configured.</p> <p>raspiCamSrv uses the Flask implementation of JWT, requiring installation of the <code>flask_jwt_extended</code> package (see Release Notes for 2.11)</p> <p>This section will only be visible if this package is installed and if the Geleral Parameter Allow access through API is checked.</p> <p></p> <p>JWT requires a secret private key to sign tokens.</p> <p>raspiCamSrv will store this key in a secrets file and will not publish it in configuration exports.Therefore, in order to activate API support, the location of the secrets file needs to be specified. It is recommended using the folowing path:<code>/home/&lt;user&gt;/.secrets/raspiCamSrv.secrets</code>This file will usually also be used to store credentials of the mail server for notification on motion detection.</p> <p>The following parameters need to be configured:</p> <ul> <li>JWT Secret Key File Path: The full path to the secrets fileThe path as well as the file will be automatically created if they do not exist.</li> <li>Access Token Expiration in MinutesThe Access Token is used for normal access to API endpoints.For higher security, it is recommended to limit the livetime of this token.This requires, however, that clients are able to react on an expiration error with refreshing the token.If this is not possible, expiration can be deactivated by specifying the value 0.</li> <li>Refresh Token Expiration in DaysThe refresh token can be used to authenticate for receiving a fresh Access Token.Both, Access Token and Refresh Token are obtained with the <code>/api/login</code> endpoint.If an expiration period &gt; 0 for the Refresh Token is specified, a new login is required if the refresh token has expired.</li> </ul>"},{"location":"SettingsAPI/#api-status-information","title":"API Status Information","text":"<p>The status of API support is indicated by the colored status line.</p> <p>A status change will only take effect for clients if the server is restarted with the necessary configuration:</p> <ol> <li>Store the configuration</li> <li>Make sure that the server is configured to Start with stored Configuration</li> <li>Restart the server (see Update Procedure, step 4)</li> </ol>"},{"location":"SettingsAPI/#api-enabled-but-not-active","title":"API enabled but not active","text":"<p>This is the initial status before specification of the path to the secrets file.</p>"},{"location":"SettingsAPI/#api-configuration-completed-but-not-yet-active","title":"API configuration completed but not yet active","text":"<p>This status is obtained after valid JWT data have been submitted and if the server has not yet been restarted with these data.</p>"},{"location":"SettingsAPI/#api-active","title":"API active","text":"<p>This status is shown after the server has been started with valid JWT settings.</p>"},{"location":"SettingsAPI/#generation-of-access-token","title":"Generation of Access Token","text":"<p>If a client system is not able to correctly obtain valid tokens from the server, it is possible to use an Access Token which does not expire and generate it with the raspiCamSrv UI:</p> <p></p> <p>This token can be copied into the clipboard and used as bearer token in API calls.raspiCamSrv will never persist or publish this token, except once on this screen after it has been generated.</p>"},{"location":"SettingsConfiguration/","title":"Settings / Server Configuration","text":"<p>The Settings screen includes a Configuration section with functions to control the raspiCamSrv configuration.</p> <p>The list of Unsaved Configuration Changes lists all actions with their time of execution, which have been made during the current session and which have not yet been saved to the server.</p> <p></p> <ul> <li>Button Store Configuration generates a set of JSON files which include the entire configuration of the raspiCamSrv server (see below).NOTE: This does not include Photo Series. These are persisted automatically and independently. It also does not include Events.</li> <li>Button Load Stored Configuration replaces the current configuration with the previously stored configuration.Photo Series and Events are not affected.NOTE: If you had activated API access before, this will be deactivated when the stored configuration is loaded. You need to restart the server to activate it again.</li> <li>Button Reload Cameras resets and reloads the entire camera configuration (see Reloading Cameras). This fuction must be applied when USB cameras have been unplugged or new USB cameras plugged in while the server was active (hot plug). This will adjust the entire camera configuration to the new setup.NOTE: Use this function immediately after unplugging a USB camera. Otherwise errors can occur when using other functionsNOTE: This has no effect when CSI cameras have been plugged in or out. This requires rebooting the Raspberry Pi, to be effective.</li> <li>Button Reset Server stops any background activity (live stream, video, photo series, motion capturing and event handling) and replaces the current configuration with the default configuration.Photo Series and Events are not affected. Any associated resources remain unchanged. However, an active Photo Series will be paused and needs to be continued.NOTE: If you had activated API access before, this will no longer be available when the configuration is reset.The same applies to Notification Settings which need to be reconfigured.NOTE: If you had activated Start Server with Stored Configuration, this will be deactivated. Probably, you might want to store the new configuration bofore activating this again.</li> <li>Start server with stored Configuration controls whether a server start shall use the default configuration or the stored configuration.</li> <li>Button Backup Stored Data  With this button, you can create a backup of all data currently stored in the file system.  Before pressing the button, you need to enter a unique name for the backup.</li> <li>Button Restore Backup  With this button, you can restore the selected backup.  After restore is completed and confirmed by the status message, you need to restart the server with the Restart Server button.</li> <li>Button Remove Backup  With this button, you can remove the selected Backup.</li> <li>Button Restart Server  will restart the raspiCamSrv Flask server.   The system will automatically detect whether the server was started as system unit, as user unit or from the command line.   In the latter case, you are asked to stop the server manually.  When the server restarts, the browser will lose connection.   Press the browser's Back button until you see the recently used raspiCamSrv screen and then push any of the upper menu options to reconnect with the restored configuration.</li> </ul>"},{"location":"SettingsConfiguration/#server-configuration-storage","title":"Server Configuration Storage","text":"<p>When the configuration is stored with the Store Configuration button, a set of files is created/replaced in the <code>raspi-cam-srv/raspiCamSrv/static/config</code> folder:</p> <p></p> <ul> <li>_loadConfigOnStart.txtThis is just an empty marker file. If the file exists, the server will initiate its configuration with configuration data stored in the other files.Otherwise, default configuration settings will be applied.</li> <li>cameraConfigs.jsonThis is currently not used</li> <li>cameraProperties.jsonThis file contains the camera properties of the actice camera, which are shown in Camera Properties.Camera properties are always read directly from the camera.</li> <li>cameras.jsonThis file contains the installed cameras with information shown in Installed CamerasInstalled cameras are always directly queried from the camera system.</li> <li>controls.jsonThis file includes all the camera configuration settings as shown in the upper right part of the Live screen Camera Controls</li> <li>LiveViewConfig.json, photoConfig.json, rawConfig.json, videoConfig.jsoncontain the camera configuration settings for the different use cases as shown in the Config screen</li> <li>rawFormats.jsoncontain a list of formats which can be used for raw photos.This information is extracted from the different Sensor Modes and is always directly obtained from the camera system.</li> <li>serverConfig.jsonThis file includes configuration settings for the raspiCamSrv dialog system, such as information included in the Settings dialog, or the configuration of the Display Buffer and some navigation details.</li> <li>streamingCfg.json contains, for each camera, the Tuning configuration, the Live View Configuration settings and the Camera Controls which will be used for streaming. The included Video Configuration is stored because Picamera2 always requires the main stream to be configured. This will not be used for streaming.</li> <li>triggerConfig.json contains the configuration settings for triggered capture of videos and photos (motion capture)</li> <li>tuningConfig.json contains the settings maintained in the Tuning dialog</li> </ul>"},{"location":"SettingsConfiguration/#reloading-cameras","title":"Reloading Cameras","text":"<p>When the function Reload Cameras is applied, the system will </p> <ol> <li>Detect the currently connected cameras</li> <li>Identify USB cameras, if connected </li> <li>Then determine Camera Properties (e.g. model) and Sensor Modes for CSI and USB cameras.</li> <li>Create a list of supported cameras, considering whether Use of USB cameras is disabled.</li> </ol> <p>Before applying the function the list of supported cameras may look like</p> Num Model USB Device 0 imx708 No 1 imx219 No 2 Logi 4K Stream Edition Yes /dev/video0 3 C922 Pro Stream Webcam Yes /dev/video4 <p>After remofing the imx219 and unplugging the Logi 4K, the list will be: </p> Num Model USB Device 0 imx708 No 1 C922 Pro Stream Webcam Yes /dev/video4 <p>When comparing the lists, the system will look for matching Num, Model, USB and Device.  If one of these parameters differs, the camera with that number will be initialized based on the current Camera Properties and Sensor Modes. Any previously specified Configuration or Controls will be reset to default values for the respective camera type.</p> <p>In the example above, Camera 0 will keep their settings and Camera 1 will be reset.</p>"},{"location":"SettingsConfiguration/#backups","title":"Backups","text":"<p>Backups preserve the currently stored data structures of raspiCamSrv so that they can be consistently restored later.</p> <p>This includes:</p> <ul> <li>all configuration data stored under folder <code>~/prg/raspi-cam-srv/raspi-cam-srv/static/config</code></li> <li>all photos stored under folder <code>~/prg/raspi-cam-srv/raspi-cam-srv/static/photos</code></li> <li>all photo series stored under folder <code>~/prg/raspi-cam-srv/raspi-cam-srv/static/photoseries</code></li> <li>all event data stored under folder <code>~/prg/raspi-cam-srv/raspi-cam-srv/static/events</code></li> <li>The Camera calipration photos for a Stereo Camera System stored under folder <code>~/prg/raspi-cam-srv/raspi-cam-srv/static/calib_photos</code></li> <li>The Stereo Camera calibration parameters stored under folder <code>~/prg/raspi-cam-srv/raspi-cam-srv/static/calib_data</code></li> <li>The SQLite database with User data and Event data stored as <code>~/prg/raspi-cam-srv/instance/raspiCamSrv.sqlite</code></li> </ul> <p>When a backup is created, all these data are stored underneath <code>~/prg/raspi-cam-srv/backups/&lt;backup-name&gt;</code> where <code>&lt;backup-name&gt;</code> is the name given to the backup:</p> <p></p>"},{"location":"SettingsConfiguration_NoCam/","title":"Settings / Server Configuration (No Camera)","text":"<p>This is a variant of the Settings / Server Configuration screen for the case when no camera is available.</p> <p></p> <p>The Settings screen includes a Configuration section with functions to control the raspiCamSrv configuration.</p> <p>The list of Unsaved Configuration Changes lists all actions with their time of execution, which have been made during the current session and which have not yet been saved to the server.</p> <p></p> <p>For details, see Settings / Server Configuration</p> <p>When currently no camera is available in raspiCamSrv but one or more USB cameras have been plugged in while raspiCamSrv was active, button Reload Cameras will reset the entire camera configuration and usually detect new cameras.  A confirmation is required:</p> <p></p>"},{"location":"SettingsDevices/","title":"Settings - Devices","text":"<p>On this Settings screen you can configure devices connected to the Raspberry Pi through GPIO of the 40-pin header.</p> <p></p> <p>IMPORTANT: To preserve any configurations over server restart, you need to store the configuration and activate Start Server with stored Configuration</p>"},{"location":"SettingsDevices/#creating-a-device","title":"Creating a Device","text":"<p>To create a new device, select one of the preconfigured Device Types and enter a unique ID by which the device will be identified within raspiCamSrv.</p> <p>Pressing Create will open the Device Configuration where the device can be configured in detail.</p> <p>A graphic with wiring information in the upper right area will help connecting the device.</p>"},{"location":"SettingsDevices/#configuring-a-device","title":"Configuring a Device","text":"<p>In raspiCamSrv, GPIO-connected devices are controlled using the gpiozero library which is deployed with Raspberry Pi OS.</p> <p>raspiCamSrv supports all 'regular' input and output device classes of gpizero as well as StepperMotor which is an own extension of <code>gpiozero.OutputDevice</code>.</p> <ul> <li>Config Statusshows whether the device is completely configured.This requires normally, that valid numbers have been set for all pin parameters.</li> <li>Device Typeshows the class name through which the device is accessible.</li> <li>Usageshows whether the device is an Input or Output device.This information is used when Triggers and Actions are configured where either one or the other can be selected.</li> <li>gpiozero DocA link to the gpiozero page for the specific class can help understanding the meaning of the different interface parameters as well as for the specific behavior of the class.Only the link for the StepperMotor links to a raspiCamSrv page with information about this class.</li> </ul> <p>Typically, most of the device types have an individual set of parameters with different data types and value ranges.</p> <p>These parameters are preconfigured in raspiCamSrv (see Device Type Configuration) and are shown with their default values from gpiozero.</p> <p>In almost all cases, only the parameters for the GPIO pins need to be configured.</p> <p>Only, when all GPIO pins are configured, the Config Status is set to \"OK\", which is a precondition that the device can be used.</p>"},{"location":"SettingsDevices/#device-overview","title":"Device Overview","text":"<p>The right side of the dialog shows an overview of all configured devices with their associated GPIO pins and their Config Status</p> <p>The information about Unused GPIO Pins can help finding places for new devices.This information only considers the devices configured in raspiCamSrv.</p>"},{"location":"SettingsDevices/#modifying-device-configuration","title":"Modifying Device Configuration","text":"<p>You can modify configuration parameters for a device after selecting the device ID in the Device Configuration section.</p> <p>If a device is selected, also the device Type and the image in the upper area are adjusted.</p> <p>The ID of a device can not be modified.</p>"},{"location":"SettingsDevices/#deleting-a-device","title":"Deleting a Device","text":"<p>The Delete button allows deletion of the selected device. This requires an additional confirmation.</p> <p>If a device is used in one of the Triggers or Actions configurations, it cannot be deleted. An error message will be shown only after deletion has been confirmed.</p>"},{"location":"SettingsDevices/#testing-a-device","title":"Testing a Device","text":"<p>After a device has been configured, it should be tested that it is working correctly.</p> <p>When the Config Status is \"OK\", the Device Test section is shown, which initially consists only of the Test button.</p> <p>When it is pressed, a preconfigured set of test steps will be executed.</p> <p>IMPORTANT: Before pressing Test, make sure that any moving devices (e.g. Motors, Servos) can move freely.</p> <p>After the test is completed, the return values of the configured test methods will be shown.</p> <p>For a test either the entire test or the individual steps may have preconfigured durations. So you need to wait until the test is completed and observe the device.</p>"},{"location":"SettingsDevices/#calibrating-a-device","title":"Calibrating a Device","text":"<p>Some devices require state tracking and, therefore, calibration.</p> <p>This applies currently to the StepperMotor:   The StepperMotor itself does not have knowledge about its current position and when the class is instantiated, the current_angle is set to zero.  For usage of the StepperMotor it is, however, essential to know the position at any time.</p> <p>It is, therefore, necessary to</p> <ol> <li>set a certain state as reference \"Zero\"</li> <li>track and memorize any movements</li> <li>set the last state whenever the device class is instantiated</li> </ol> <p>Devices requiring this procedure have an element <code>\"calibration\"</code> in their Device Type Configuration.</p> <p>If such a device is configured, a Calibrate button will be shown.</p> <p>Pressing Calibrate will show additional buttons for calibration as well as the current state (<code>current_angle</code> for StepperMotor):  You can now change the device status using the arrow buttons until you reach the desired zero.  Pushing OK will then set the current state as reference and hide the calibration buttons.</p> <p>raspiCamSrv will track all status changes in a JSON file named after the device ID:    </p> <p>ATTENTION: If you are using such devices in any triggered Actions you should avoid shutting down the server while event handling is activated. The system might not be able to memorize the latest device state and may, therefore start with an incorrect state.</p>"},{"location":"SettingsDevices/#device-type-configuration","title":"Device Type Configuration","text":"<p>The gpiozero device types, supported by RaspiCamSrv are preconfigured in the file <code>gpioDeviceTypes.py</code>.</p> <p>Below is an example for the <code>DistanceSensor</code>:</p> <pre><code>gpioDeviceTypes = [\n    {\n        \"type\":\"DistanceSensor\",\n        \"usage\":\"Input\",\n        \"docUrl\": \"https://gpiozero.readthedocs.io/en/stable/api_input.html#distancesensor-hc-sr04\",\n        \"image\": \"device_DistanceSensor.jpg\",\n        \"params\": {\n            \"echo\": {\n                \"value\": \"\",\n                \"type\": \"int\",\n                \"min\": 0,\n                \"max\": 27,\n                \"isPin\": True\n                },\n            \"trigger\": {\n                \"value\": \"\",\n                \"type\": \"int\",\n                \"min\": 0,\n                \"max\": 27,\n                \"isPin\": True\n                },\n            \"queue_len\": {\n                \"value\": 9,\n                \"type\": \"int\",\n                \"min\": 0,\n                \"max\": 99\n                },\n            \"max_distance\": {\n                \"value\": 1.0,\n                \"type\": \"float\",\n                \"min\": 0.0,\n                \"max\": 100.0\n                },\n            \"threshold_distance\": {\n                \"value\": 0.3,\n                \"type\": \"float\",\n                \"min\": 0.0,\n                \"max\": 100.0\n                },\n            \"partial\": {\n                \"value\": False,\n                \"type\": \"bool\"\n                }\n        },\n        \"testMethods\":[\n            \"distance\",\n            \"value\"\n        ],\n        \"events\":[\n            \"when_in_range\",\n            \"when_out_of_range\"\n        ],\n        \"eventSettings\":{\n            \"threshold_distance\": 0.0\n        },\n        \"control\":{\n            \"bounce_time\": 0.0\n        }\n    },\n]\n\n</code></pre> <p>The different elements are used for different purposes:</p> <ul> <li>typeidentifies the class name for the device type.</li> <li>usagedistinguishes Input and Output devices</li> <li>docURLis the URL for class documentation</li> <li>imageidentifies the image shown in the dialog</li> <li>paramscharacterizes the class constructor interface with parameter name, default value, type (with some non-Python declarations) as well as the valid range.The \"isPin\" sub-element identifies attributes which correspond to GPIO pins.</li> <li>testMethods is a list of test methods, if necessary with parameters, which are executed during the test.</li> <li>testDuration or testStepDuration specify the duration of the entire test or of every test step.</li> <li>eventsoccur in Input devices and identify events which are captured by the device class and to which callback routines can be assigned.This will be used in the specification of Triggers.</li> <li>eventSettingsis a list of parameter assignments which will be set before callbacks are assigned to the event parameters.An example is the <code>threshold_distance</code> which is required for <code>DistanceSensor</code> to distinguish between in_range and out_of_range.</li> <li>actionTargetsoccur in Output devices and identify methods which can be used in Actions.Whereas the sub-element \"method\" identifies the method name (which can be a method or a property which raspiCamSrv determines through inspection), the \"params\" element specifies the parameters which can be configured for the method call or the property assignment.These parameters serve also as 'templates' for type checks which are done during Action configuration.</li> <li>control elementswhich can occur as sub-elements of \"actionTarget\" for Output devices as well as for Input devices, are not part of the class interface but are used to control specific behavior in raspiCamSrv.For input devices it can, for example specify the <code>bounce_time</code> for software controlled bouncing suppression beyond that what might already be provided by gpiozero.For Output devices and a specific action target, it can, for example specify a duration for which the action shall last, for example how long an LED shall be enlighted.</li> </ul>"},{"location":"SettingsDevices/#40-pin-gpio-header","title":"40-Pin GPIO Header","text":""},{"location":"SettingsUpdate/","title":"Settings - Update","text":"<p>This dialog can be used to update raspiCamSrv to the latest version available on GitHub</p> <p></p> <p>If the installed version is lower than the latest version on GitHub, the version number on the title bar is shown in yellow.</p> <p>The Update dialog shows the following fields:</p> <ul> <li>Check for UpdatesThis switch can be used to activate or deactivate checking for updates.</li> <li>Latest VersionThis is the latest version available on GitHub. raspiCamSrv determines the latest version by analyzing the Release Notes.GitHub is checked for the latest version at every start of the Flask server or with the specified time interval when executing any function of the Live dialogs.</li> <li>See Release NotesThe link opens the latest release notes for inspection of new features.</li> <li>Installed VersionThis field shows the currently installed version.</li> <li>Update to Vx.y.zThis button is only visible if you can update to a newer version.Pressing the button will issue a <code>git pull origin main --depth=1</code> command to update raspiCamSrv.After the update has completed successfully, the button will turn to (see below):</li> <li>Restart ServerThis button will restart the raspiCamSrv Flask server to switch to the new version.</li> <li>Notify on Version later thanInitially, this field shows the current version.If you want to skip updates to the indicated latest version, you can press the Ignore ... button and the field will show the latest version.Information on possible updates will only be given, if the latest version on GitHub is later than the version shown in this field.</li> <li>Latest Version checked atThis shows the time when the indicated Latest Version was retrieved from GitHub.</li> <li>Check Interval (Hours)Is the interval with which raspiCamSrv will check for updates.</li> <li>Check NowCheck GitHub for a new version now.</li> </ul>"},{"location":"SettingsUpdate/#dialog-after-successfull-update","title":"Dialog after successfull Update","text":"<p>Now, you need to restart the server with the Restart Server button.</p> <p>NOTE: After completion of the update, the active server is still on the old version.When the server restarts, the browser will get an empty response. You should press the Back button of the browser to return to the previous screen and then press any menu options of the black menu bar.</p> <p>If the server is still on the old version after restart, you can follow the manual update procedure.</p>"},{"location":"SettingsUpdate/#dialog-with-check-for-updates-deactivated","title":"Dialog with Check for Updates deactivated","text":""},{"location":"SettingsUsers/","title":"Settings Users","text":"<p>For management of users, the Settings screen has an additional section Users which is visible only for the SuperUser:  </p> <p> </p> <p>The list shows all registered users with - unique user ID - user Name - Initial, indicating whether the user has been initially created by the SuperUser and needs to change password on first log-in. - SuperUser, indicating the user registered as SuperUser</p> <p>The SuperUser can - register new users using the Register New User button - remove users which have been selected in the list</p>"},{"location":"SettingsVButtons/","title":"Settings - Versatile Buttons","text":"<p>This Settings screen allows configuration of function buttons which will be shown on the Console screen.</p> <p> The screenshot above is an example layout. Initially, the Button Settings area is empty.</p>"},{"location":"SettingsVButtons/#button-layout","title":"Button Layout","text":"<p>Buttons on the Console screen are arranged in an N x M grid where the Number of Rows and Number of Columns can be configured.   </p> <p>Once non-zero values have been specified and submitted, the Buttons Settings area will show a list of parameters for specification of button properties.</p> <p>If an existing grid layout is modified by changing either the number of rows and/or the number of columns, the configured rows and columns of buttons will be preserved if the new values are larger than the old ones. Superfluous rows or columns will be removed in case that new dimensions are smaller than the old ones.</p> <p>The checkbox Interactive Commandline controls whether Console will show an interactive commandline where commands can be directly entered. </p> <p>IMPORTANT: You need to Store Configuration if you want the button settings to survive a server restart!</p>"},{"location":"SettingsVButtons/#button-settings","title":"Button Settings","text":"<ul> <li>RowThe row in which the button will be placed.</li> <li>ColThe column in which the button will be placed.</li> <li>VisibleWhen the checkbox is activated, a button will be shown in the given grid cell, otherways the grid cell will remain empty.</li> <li>ShapeThe shape of each button can be selected from a small set of standard shapes (Rectangle, Rounded, Circular, Square).The example layout of the above configuration is shown for the Console screen.</li> <li>ColorThe Color of each button can be selected from a small set of standard Colors (Black, Red, Green, Yellow, Blue).The example layout of the above configuration is shown for the Console screen.</li> <li>Button TextText to be shown on the button.</li> <li>CommandLinux command to be executed on OS level.You may use available Linux commands or run your own scripts.It is recommended to test these commands on an OS prompt before configuring and running them out of raspiCamSrvThe working directory is that of the service (see Service Configuration).</li> <li>ConfIf the checkbox is checked, the respective button will require a confirmation before the command will be executed.</li> </ul> <p>Any changes for these settings need to be submitted with the button underneath the table</p>"},{"location":"Settings_NoCam/","title":"raspiCamSrv Settings (No Camera)","text":"<p>This is a variant of the general Settings screen, which shows up when no camera is available.</p> <p>Other sections focus on</p> <ul> <li>Server Configuration</li> <li>User Management</li> <li>API Management</li> <li>Versatile Buttons</li> <li>Action Buttons</li> <li>Devices</li> </ul> <p>Users and/or API may be invisible, depending on context.</p> <p></p> <p>The General Paramenters include</p> <ul> <li>Use USB Cameras This option is only visible if the system has detected at least one USB camera (see Info).  Activating the checkbox will activate the connected cameras for raspiCamSrv.</li> <li>Allow access through API shows whether the installed libraries allow secure API access.Also if it is supported, it can be deactivated.</li> <li>The geo-coordinates Latitude, Longitute, Elevation as well as the Time Zone are not currently used when there are no cameras.</li> </ul>"},{"location":"Settings_NoCam/#enabling-use-of-usb-cameras","title":"Enabling Use of USB Cameras","text":"<p>If this option is shown, raspiCamSrv has identified at least one USB camera, but currently this is not available.</p> <p>If you enable use of USB cameras, the system will select one of the USB cameras as Active Camera and another one, if present, as Second Camera</p> <p>The UI will then automatically switch to the mode with cameras (Information)</p>"},{"location":"Settings_NoCam/#api-access","title":"API Access","text":"<p>API access to raspiCamSrv is protected through JSON Web Tokens (JWT).This requires the module <code>flask_jwt_extended</code>, which is first used in raspiCamSrv V2.11.</p> <p>If the upgrade to this version has been done without installing this module (see Release Notes V2.11), the system will show a hint  and also hide the API section</p> <p>In this case, the module can be installed (see Release Notes V2.11) and after the server has been restarted, it shows as   which now allows activating or deactivating API support.</p> <p>If the setting is changed, it is necessary to</p> <ol> <li>Store the configuration</li> <li>Make sure that the server is configured to Start with stored Configuration</li> <li>Restart the server (see Update Procedure, step 4)</li> </ol> <p>This will be indicated through the hint</p> <p></p>"},{"location":"SetupDocker/","title":"Running raspiCamSrv as Docker Container","text":"<p>A container image is available for raspiCamSrv at https://hub.docker.com/repository/docker/signag/raspi-cam-srv/general</p> <p>ATTENTION: Running raspiCamSrv in Docker is still somehow 'experimental'. Successful tests have been done only on Pi 4 and Pi 5. However, not all functions have so far been systematically tested. On Pi Zero W and Pi Zero 2 W, deployment of the image was not successful, probably because of its size (~475 MB).</p> <p>1. Preconditions</p> <ul> <li>Installation of Docker on a Raspberry Pi</li> <li>Check Contiguous Memory (CMA)</li> <li>Deactivate raspiCamSrv Service from manual Installation</li> </ul> <p>2. Compose Service Definition</p> <p>In an arbitrary working directory (e.g. <code>~/docker</code>), create</p> <p><code>compose.yaml</code>:</p> <pre><code>services:\n  raspi-cam-srv:\n    image: signag/raspi-cam-srv\n    container_name: raspi-cam-srv\n    network_mode: \"host\"\n    ports:\n      - \"5000:5000\"\n    devices:\n      - /dev/video0:/dev/video0\n      - /dev/gpiochip0:/dev/gpiochip0\n    volumes:\n      # Uncomment resource mappings, if required\n      # Configure and prepare container-external folders\n      #- ./resources/database/:/app/instance/\n      #- ./resources/config/:/app/raspiCamSrv/static/config/\n      #- ./resources/events/:/app/raspiCamSrv/static/events/\n      #- ./resources/photos/:/app/raspiCamSrv/static/photos/\n      #- ./resources/photoseries/:/app/raspiCamSrv/static/photoseries/\n      #- ./resources/tuning/:/app/raspiCamSrv/static/tuning/\n      - /run/udev/:/run/udev:ro\n      - /etc/timezone:/etc/timezone:ro\n      - /etc/localtime:/etc/localtime:ro\n    restart: unless-stopped\n    privileged: true\n</code></pre> <p>The volumes attribute includes prepared mappings of resource folders for database, configuration, events, photos, photoseries and tuning, which can/should be mapped to container-external folders in order to allow easy access and preserve the data also in case the container is removed or reset after a new image version has been pulled.NOTE: For a quick test, the container can also be run without these mappings.</p> <p>Consider that the database holds user data as well as event data which will be lost if the database exists only within the container and if the container is removed.</p> <p>3. Pull raspi-cam-srv Image</p> <p><code>docker compose pull raspi-cam-srv</code></p> <p>Wait until all pulls are completed.</p> <p>4. Create Container</p> <p><code>docker compose create raspi-cam-srv</code></p> <p></p> <p>5. Start Container</p> <p><code>docker compose start raspi-cam-srv</code></p> <p></p> <p>6. Initialize Database</p> <p>This step is only required if the <code>/app/instance/</code> folder, containing the database, has been mapped to a container-external folder.</p> <p>The image includes already an initialized database. However, if the <code>/app/instance/</code> is mapped, this database is not visible for the container and an empty database is created which needs to be initialized.</p> <p>This can be done on an interactive command prompt for the container:</p> <p><code>docker compose exec raspi-cam-srv sh</code></p> <p><code>flask --app raspiCamSrv init-db</code></p> <p></p> <p>7. Connect to raspiCamSrv</p> <p>For usage of raspiCamSrv see the User Guide</p>"},{"location":"SetupDocker/#useful-docker-commands","title":"Useful Docker commands","text":"<p>See Docker Reference</p> <ul> <li>Stop Container<code>docker compose stop raspi-cam-srv</code></li> <li>Start Container<code>docker compose start raspi-cam-srv</code></li> <li>Show server logs<code>docker compose logs raspi-cam-srv</code></li> <li>Open shell for interactive prompt<code>docker compose exec raspi-cam-srv sh</code></li> <li>List Containers<code>docker container ls</code></li> <li>List images<code>docker compose images</code></li> <li>Pull latest image<code>docker compose pull raspi-cam-srv</code></li> </ul>"},{"location":"SetupDocker/#update-procedure","title":"Update Procedure","text":"<p>Changes in the raspi-cam-srv Git repository will automatically trigger a new build of the raspi-cam-srv Docker Image.</p> <p>To update to the latest version, proceed as follows:</p> <ol> <li>cd to your working directory, e.g. <code>cd ~/docker</code></li> <li><code>docker compose pull raspi-cam-srv</code></li> <li><code>docker compose stop raspi-cam-srv</code></li> <li><code>docker compose rm raspi-cam-srv</code></li> <li><code>docker compose create raspi-cam-srv</code></li> <li><code>docker compose start raspi-cam-srv</code></li> </ol>"},{"location":"SetupDocker/#installation-of-docker-on-a-raspberry-pi","title":"Installation of Docker on a Raspberry Pi","text":"<p>The Docker documentation includes descriptions on how to Install Docker Engine on Raspberry Pi OS</p> <p>The most convenient way is using the convenience script provided by the Docker team:</p> <ol> <li>Connect to the Pi using SSH: <code>ssh &lt;user&gt;@&lt;host&gt;</code>with <code>&lt;user&gt;</code> and <code>&lt;host&gt;</code> as specified during setup with Imager.</li> <li>Update the system<code>sudo apt update</code> <code>sudo apt full-upgrade</code></li> <li>Install Docker using the convenience script:<code>curl -sSL https://get.docker.com \\| sh</code></li> <li>Add current user to the <code>docker</code> group:<code>sudo usermod -aG docker $USER</code></li> <li>Log out and log in to activate the modified group assignment:<code>logout</code><code>ssh &lt;user&gt;@&lt;host&gt;</code></li> <li>Check that Docker is working correctly:<code>docker run hello-world</code></li> </ol>"},{"location":"SetupDocker/#checking-contiguous-memory-cma","title":"Checking Contiguous Memory (CMA)","text":"<p>Cameras on Raspberry Pi use CMA memory (see Picamera2 Manual, chapter 8.3). The default size of CMA memory is different for different Raspberry Pi models and can be shown with    <code>cat /proc/meminfo</code></p> <p>On a Pi 5, the available CMA memory (~65 MB) was found to be too small for accessing cameras from a Docker container when larger image sizes are used.</p> <p>The value for <code>CmaTotal</code> should be at least the value found for Raspberry Pi Zero of 262144 kB.</p> <p>If the value on your system is smaller, it needs to be increased:</p> <ol> <li>Edit the Raspberry Pi configuration file:<code>sudo nano /boot/firmware/config.txt</code></li> <li>Find the line<code>dtoverlay=vc4-kms-v3d</code>and replace it with<code>dtoverlay=vc4-kms-v3d,cma-512</code> for &gt; 2GB systems<code>dtoverlay=vc4-kms-v3d,cma-384</code> for &gt; 1GB systems<code>dtoverlay=vc4-kms-v3d,cma-320</code> for smaller systems</li> <li>Reboot<code>sudo reboot</code></li> </ol>"},{"location":"SetupDocker/#deactivate-raspicamsrv-service-from-manual-installation","title":"Deactivate raspiCamSrv Service from manual Installation","text":"<p>If you have installed raspiCamSrv manually, you need to deactivate the service:</p> <ol> <li>Stop the service:<code>sudo systemctl stop raspiCamSrv.service</code>or<code>systemctl --user stop raspiCamSrv.service</code></li> <li>Disable the service so that it does not automatically start with boot:<code>sudo systemctl disable raspiCamSrv.service</code>or<code>systemctl --user disable raspiCamSrv.service</code></li> </ol>"},{"location":"Trigger/","title":"Event Handling and Triggered Capture of Videos and Photos","text":"<p>raspiCamSrv can capture events from camera and GPIO input devices and let these process actions by the camera and GPIO output devices.</p>"},{"location":"Trigger/#supported-triggers","title":"Supported Triggers","text":"<ul> <li>Triggers from GPIO-connected sensors</li> </ul>"},{"location":"Trigger/#additional-triggers-when-a-camera-is-available","title":"Additional Triggers when a Camera is available","text":"<ul> <li>Triggers from camera events such as start and stop of video recording or streaming or detection of motion.</li> <li>Motion Capturing through image analysis</li> <li>Active Motion Capture</li> </ul>"},{"location":"Trigger/#supported-actions","title":"Supported Actions","text":"<ul> <li>Actions with GPIO-connected devices, such as LEDs, motors, servos or sound devices.</li> <li>SMTP actions for sending an eMail to the configured recipient.</li> <li>Trigger-Actions define which trigger will execute which action(s).</li> <li>Under Notification, you configure the general mail recipient as well as specifics for notification on motion detection through the camera. </li> </ul>"},{"location":"Trigger/#additional-actions-when-a-camera-is-available","title":"Additional Actions when a Camera is available","text":"<ul> <li>Camera actions, such as taking photos, starting or stopping video recording or recording a video with a given length.</li> <li>Camera Actions specify the camera actions in case of motion detection through the camera.</li> <li>Under Notification, you configure whether mail notification shall include photos or videos from motion detection through the camera. </li> </ul>"},{"location":"Trigger/#event-dashboard","title":"Event Dashboard","text":"<ul> <li>Event Viewer</li> <li>Calendar</li> </ul>"},{"location":"Trigger/#event-handling-infrastructure","title":"Event Handling Infrastructure","text":"<p>raspiCamSrv comes with two different types of event handling:</p>"},{"location":"Trigger/#1-motion-capturing","title":"1. Motion Capturing","text":"<p>Originally supported was Motion Capturing with photo-taking and video recording actions as well as notification by mail.   The relevant dialogs for configuration are Motion, Camera and Notification.</p>"},{"location":"Trigger/#2-general-event-handling","title":"2. General Event Handling","text":"<p>Since version V3.3.0, raspiCamSrv supports a more general approach to event handling which includes not only the camera but also various kinds of input and output devices which can be connected to the Raspberry Pi's GPIO pins.</p> <p>If you have no devices connected to your Raspberry Pi, you just stay with Motion Capturing.</p> <p>If you have input devices, such as sensors or buttons and/or output devices, such as LEDs, buzzers, relais or motors connected to your Pi, in addition to a camera, you can benefit from the fully integrated powerful event handling of raspiCamSrv.</p> <ul> <li>You start with configuring the connected devices in the Settings/Devices screen.    </li> <li>Then, for the configured input devices, you configure Triggers which can also be based on camera events, such as start or stop of video recording, streaming or motion capturing.</li> <li>As next, you configure any type of actions which you want to see, such as LEDs being switched on, a stepper motor executing a certain number of steps or photos and/or videos being taken with the camera.In addition, you can also configure an SMTP action for being informed about an event by mail.</li> <li>Once this is done, you need to specify for each of the triggers, which actions shall be processed once an event has been triggered. This is done in dialog Trigger Actions.</li> <li>In the Triggers and Actions dialogs, you also have the possibility to deactivate or activate triggers and actions, respectively.</li> </ul>"},{"location":"Trigger/#integration","title":"Integration","text":"<p>The two types of event handling exist independently from each other and can be used separately or simultaneously.   Events from Triggers defined as part of the General Event Handling can also be logged and visualized in the Event Viewer if their event_log control parameter is set to \"True\".</p> <p>SMTP actions for mailing use the Notification settings. Whether photos and/or videos, created during action processing, shall be included in a mail, can be configured independently for each SMTP action.</p> <p>In order to receive a mail on an event, you just activate one of your configured SMTP actions for the intended trigger.  While all actions are started simultanously in individual threads, the thread for the SMTP action will wait for completion of all other actions of the same trigger and include any information and rosources from the other action threads.</p>"},{"location":"Trigger/#where-do-photos-and-videos-go","title":"Where do Photos and Videos go?","text":"<p>Photos and videos taken in case of motion detection will always be stored in the event folder while events are logged in the log file and the database.   Old data can be removed with the Cleanup function.</p> <p>The same applies to triggers and actions of General Event Handling if the control parameter event_log for the trigger is set to \"True*.</p> <p>If this parameter is \"False\", photos and videos will be stored at the same location as if they were taken on the Live screen and they can be inspected in the Photo Viewer.</p>"},{"location":"Trigger/#restrictions","title":"Restrictions","text":"<p>You can use motion capturing through the camera as trigger.  Whereas you can associate any kind of GPIO actions with such a trigger, you can not associate any camera or SMTP action.   This is because camrea- and SMTP actions are handled already in the Motion Capturing infrastructure, which must be activated in order to capture motion detection events.</p>"},{"location":"Trigger/#control","title":"Control","text":"<p>In the Control section, you may specify basic aspects of triggered actions:</p> <p>Where not otherwise stated, this applies to 'legacy' motion capturing as well as to General Event Handling.</p> <ul> <li>Under Triggers, you select the triggers to be used.  You can activate Motion detection and/or the other Configured Triggers</li> <li>Under Actions you specify the actions to be taken in case of motion detection through the camera.  You may select among video recording and photo taking.  In case Record Video is selected, also at least one photo must be taken. This photo will serve as placeholder for the video in the Event Viewer.   With Notification you specify whether or not you want to be informed by e-Mail about an event. The details need to be specified on the Notification tab.   ATTENTION: If you have chosen to only activate Configured Triggers without Motion Detection, the listed Actions will be deactivated because they are only supported with Motion Detection.From the Configured Triggers, the configured Trigger-Actions will be executed, which may also include camera actions.</li> <li>With Operation Weekdays, you specify the weekdays when triggering shall be active.</li> <li>Operation Start specifies the daytime when triggering is activated on each active weekday.</li> <li>Operation End specifies the daytime when triggering is paused.</li> <li>Automatic Start with Server  When activated, the trigger capturing process can be automatically started with the server.  When you change this parameter, you need to go to Settings and store the current Server Configuration  If you want automatic start, you also need to select Start Server with stored Configuration.   Note In case you start the Flask server manually, do not use the <code>--debug</code> option. This will cause an exception (see Flask Issue #5437).</li> <li>Detection Delay allows specifying a delay in seconds. When an event is triggered, the configured action (video and/or photo, Notification) will be delayed by the specified number of seconds. Normally, this will be 0.This applies to motion-captured events only.    </li> <li>Detection Pause specifies a 'dead time' after an event has been registerd. Within this time no new event will be registered although the system will not stop detecting motion.   This setting prevents from being flooded with registered events, for example if motion persists for a longer time.   Detection pause (and alse Detection Delay), configured here, does not apply to the configured Triggers. For these, it is possible to specify bouncing-time individually for every trigger.</li> <li>Retention Period specifies the number of days  for which event data will be retained when a cleanup is done.This does not apply for photos or videos which have been taken on triggers for which event_log was set to \"False\"</li> </ul> <p>Data changes will not be persisted unless the Submit button has been pressed.</p>"},{"location":"Trigger/#starting-trigger-capturing","title":"Starting Trigger capturing","text":"<p>Trigger- and event handling is activated using the Start button.</p> <p>Depending on the selected Triggers, Motion Detection and/or Configured Triggers are started.</p> <p>Which process is currently active is indicated by the status indicators:</p> <ul> <li>Motion detection only:   </li> <li>Configured Triggers only:   </li> <li>Both   </li> </ul> <p>Note that, whenever Motion Detection is active, also the live stream will be kept active because this is used to detect motion.</p> <p>For active of motion capturing, see Active Motion Capturing </p>"},{"location":"TriggerActions/","title":"Actions","text":"<p>This screen is used to specify actions which can be started by raspiCamSrv, either as a reaction on a Trigger or manually through an Action Button.</p> <p></p> <p>IMPORTANT: To preserve any configurations over server restart, you need to store the configuration and activate Start Server with stored Configuration.</p>"},{"location":"TriggerActions/#creating-an-action","title":"Creating an Action","text":"<ol> <li>In field Action Source, select the source system for which the action is defined:   (Camera will be available as option only if a camera is available)   </li> <li>This will open a list of devices defined for the chosen source system:    For the GPIO system, these are the Output devices configured on Settings/DevicesNOTE: For SMTP, a device will only be shown if a mail account has been specified and verified in dialog Notification.If this is the case, the configured SMTP Server will be shown as device.</li> <li>After a device has been selected, the system will show the device type with a link to related gpiozero documentation as well as the action methods which can be executed for this device (this information is taken from the fixed configuration for the device type):   </li> <li>When the method has been chosen, the sytem will display any parameters which may be required for this method:    Now you need to specify values for these parameters, unless you leave the defaults, and enter a unique name for the action.   In this step, the Submit button will be activated.    </li> <li>Pressing the Submit button will create the action and show it in the Action Overview.</li> </ol>"},{"location":"TriggerActions/#parameters","title":"Parameters","text":"<p>The parameters, for which values can be specified, are parameters of the method signature for the device class.   Information about their type and value range, as well as about their function can be obtained from the gpiozero class documentation accessible through the link.</p> <p>raspCamSrv will check the data type by analyzing the datatype of the configured template. However, the allowed value range is currently not checked. You need to consult the gpiozero documentation.</p> <p>Sometimes, the 'Action Method' is in fact a property and not a callable method. In this case, raspiCamSrv will just assign the value to the property and ignore the parameter name.</p>"},{"location":"TriggerActions/#control","title":"Control","text":"<p>Control parameters are not part of the class interfaces but they can affect how raspiCamSrv processes an action method:</p> <ul> <li>durationWith duration, you can specify the length of the time interval, during which the device will stay in the state achieved through the method, for example the 'on' state of an LED.After this time, the system will check, whether the device object has a method off() (which is the case for LEDs and Buzzer) or a method stop() (which is the case for Motor and TonalBuzzer).If either of these methods is found, it is applied.In effect, the device will be in an inactive state afterwards.</li> <li>stepsThis is the number of steps in which the device shall reach the intended state within the given duration.The intention here is that one might want a smooth rather than an abrupt movement, for example for a Servo.NOTEThis feature is currently not yet supported.</li> <li>burst_countThis is a a parameter for method \"take_photo\". You can specify the number of photos which shall be taken as part of a photo burst in a series with a given interval.</li> <li>burst_intvlThis is the interval you can specify for a photo burst.</li> <li>attach_photo, attach_videofor an SMTP action, you can specify whether or not photos and/or videos shall be attached to the mail which have been created as part of the actions of the triggered event.</li> </ul>"},{"location":"TriggerActions/#restrictions","title":"Restrictions","text":"<p>At a given time, only one action can be executed on a specific device type.</p>"},{"location":"TriggerActions/#timing-of-action-execution","title":"Timing of Action Execution","text":"<p>Whereas action execution is synchronous, when invoked through an Action Button (the user needs to wait until the action is completed), this is different for the case when an action is triggered by a Trigger.</p> <p>In the latter case, action execution is done in an own thread which allows the action to be completed independently from the event handling thread which can treat other events in the meantime.</p> <p>This means that actions are always completed and not interrupted.</p> <p>This applies to actions with a configured duration, such as an LED which shall be 'on' for a certain time or a video with a given duration.   However, it applies also to actions with an inherent time consumtion. For example the movement of a StepperMotor can consist of hundreds of steps with a waiting time of 1 to 4 ms after each step. This requires in total several seconds to complete.</p> <p>If for such an action a new action is requested before the previous action is completed, it will wait until the device is no longer busy.</p> <p>When stopping the event handling system, raspiCamSrv will wait for active actions to complete.</p>"},{"location":"TriggerActions/#activation-of-actions","title":"Activation of Actions","text":"<p>If the event-handling thread is currently active: - The Active check boxes are locked.</p> <p>If the event-handling thread is not active: - The Active check boxes are active</p> <p>You can activate/deactivate Actions by changing the Active check box and submitting the change.</p>"},{"location":"TriggerActions/#deletion-of-actions","title":"Deletion of Actions","text":"<p>You can select one or multiple actions for deletion in the Delete column and submit the selection.</p> <p>The Delete column will only be accessible for change if the event-handling thread is currently not active.</p> <p>You cannot delete an action if it is used in an Action Button.</p> <p>When an action is deleted, also its reference in the Trigger-Actions will be removed.</p>"},{"location":"TriggerActions/#changing-actions","title":"Changing Actions","text":"<p>Changing of actions is currently not possible.</p> <p>However, you can easily create a new similar one with different parameters and deactivate or delete the old one.</p>"},{"location":"TriggerActive/","title":"Triggered Capture of Videos and Photos","text":""},{"location":"TriggerActive/#active-motion-capturing","title":"Active Motion Capturing","text":"<p>The Start button on the Control page starts the trigger capturing process.</p> <p></p> <p>An active capture process is indicated with red Process Status Indicator</p> <p>The Start button has changed to Stop, which allows stopping the process.</p> <p>If motion capturing is currently active but operation paused because of schedule settings, this is indicated by a yellow process status indicator:</p> <p></p>"},{"location":"TriggerActive/#event-data","title":"Event Data","text":"<p>Event data are stored in directory <code>./prg/raspi-cam-srv/raspiCamSrv/static/events</code>:</p> <p></p> <p>Storage includes a log file as well as video and photo files.</p>"},{"location":"TriggerActive/#parallel-activities","title":"Parallel Activities","text":"<p>While motion capturing is active, the live stream process will be kept active because this is used for motion detection.</p> <p>While motion capturing is active, you may continue working with raspiCamSrv.  You may even take photos, videos or photo series.</p> <p>However, you should avoid changing camera controls or configuration because this might restart the camera.</p>"},{"location":"TriggerActive/#dos-and-donts","title":"Dos and Don'ts","text":""},{"location":"TriggerActive/#blocked","title":"Blocked:","text":"<ul> <li>Changing Settings</li> <li>Starting a Exposure Series or a Focus Stack Series</li> <li>Changing Camera Configuration</li> </ul>"},{"location":"TriggerActive/#changing-zoom","title":"Changing Zoom","text":"<p>This can be done while trigger capturing is active.  However the moment when the new zoom setting is activated will be registered as motion event.</p>"},{"location":"TriggerActive/#changing-focus","title":"Changing Focus","text":"<p>To improve the focus for camera model 3, you may change Focus Settings and Trigger Autofocus</p>"},{"location":"TriggerActive/#changing-camera-controls","title":"Changing Camera Controls","text":"<p>In order to change the quality of videos and photos, you may change any Camera Controls while motion capturing is active.</p>"},{"location":"TriggerActive/#log-file","title":"Log File","text":"<p>While events are registered and videos and photos are taken, the system maintains a log file (<code>events/_events.log</code>) with antries for all events and the times when photos are captured or videos are started and stopped:</p> <p></p> <p>The log file of the above screenshot shows examples without delayed actions as well as with configurations with 4 photos in the Photo Burst.    </p>"},{"location":"TriggerActive/#database","title":"Database","text":"<p>Events and event actions are also stored in the SQLite3 database stored at  <code>./prg/raspi-cam-srv/instance/raspiCamSrv.sqlite</code>.</p> <p>The primary purpose of the database is providing fast access to event data over a longer period for the Event Viewer</p> <p></p> <p>Table events holds all individual events:</p> <p></p> <p>Table eventactions holds the actions taken for each event:</p> <p></p>"},{"location":"TriggerCameraActions/","title":"Camera Actions","text":"<p>This section allows specification of aspects for photos and/or videos recorded in reaction an an  event:</p> <ul> <li>Video Recording Type  With Normal, video recording starts with the event or, if configured, after a specified dalay.  With \"Circular, the system continuesly captures video in a circular buffer with a capacity of a few seconds. In case of an event, also the seconds before the event will be available in the video.  Currently, only Normal* is supported.</li> <li>Pre-Record Length (sec) is the number of seconds, the system shall look 'backwards' from the time of an event.</li> <li>Video Duration specifies the length of videos captured in case of an event.   If a new event is registered while video recording from the previous event is still active, this will be stopped before recording for the new event starts.</li> <li>Photo Burst - Number of Photos allows specifying a number of photos which will be successively captured in case of an event.  If video is recorded, at least one photo must be specified.</li> <li>Photo Burst Interval is the interval after the previous photo when the system will capture a new photo if there is still motion detected. If no motion is detected after this interval, no photo will be taken.</li> <li>Action data path is the path where pictures and logs for events will be stored.</li> </ul>"},{"location":"TriggerEventViewer/","title":"Triggered Capture of Videos and Photos","text":""},{"location":"TriggerEventViewer/#calendar","title":"Calendar","text":"<p>The calendar gives an overview on the number of events which have been registered for a specific day:</p> <p></p> <p>Clicking on a red field navigates to the Events display for this specific day.</p> <p>You can change the active month using the date control and navigation arrows, or return to the current month with the Now button.</p>"},{"location":"TriggerEventViewer/#download-log","title":"Download Log","text":"<p>You can download the Log file including a timeline of all events and associated actions. Note that only those triggers and their associated actions will be included in the log, for which the control parameter event_log has the value \"True\".</p>"},{"location":"TriggerEventViewer/#cleanup","title":"Cleanup","text":"<p>The Cleanup button can be used for removing old events.  This requires that the process is stopped.</p> <p>After pressing the button, a confirmation is required:   The Retention Period for cleanup, shown in this confirmation, has been specified on the Trigger/Control page.</p> <p>For all events older than the Retention Period, cleanup will</p> <ul> <li>remove all log file entries</li> <li>delete all photo and video files</li> <li>delete related database entries</li> </ul>"},{"location":"TriggerEventViewer/#events","title":"Events","text":"<p>Event Details are shown in the Event Viewer for a specific day:</p> <p></p> <p>In the top area, you may </p> <ul> <li>change the active day using the date control or the arrow buttons.  Single arrows shift by day, double arrows by week.  In each case the starting hour is set to 00:00h.</li> <li>change the start time from which on events will be shown.  Here, single arrows shift by a quarter of an hour, double arrows by an hour.</li> <li>You can select whether you want to see videos, photos, both or none.  In case of videos, the first photo is always shown instead of the video on the left side, however clicking on the photo will open the video viewer.</li> <li>whether a video or a photo is represented by the small picture can be distinguished by information on the video length.</li> </ul> <p>Selecting a video or photo shows it in the detail area on the right side.</p> <p>The Event Card for each event     shows, from top to bottom:</p> <ul> <li>Event Type</li> <li>Event date</li> <li>Event time</li> <li>Event trigger</li> <li>Event trigger algorithm  Mean Square Diff Frame Diff. Optical Flow BG Subtraction</li> <li>Trigger parameter (see Motion tab)  cam : Camera Num by which motion was detected   roi : Index of the Region of Interest in which motion was detected  NOTE: Motion detection analysis is stopped whenever motion has been detected in one of the RoIs. The index of this ROI is reported here.   msd : Mean Square Threshold  BBox_thr : Bounding Box Threshold  IOU_thr : IOU Threshold  Motion_thr : Motion Threshold  Model : Background Subtraction Model (1=MOG2, 2=KNN)</li> </ul> <p>You may use the information to fine tune the algorithm parameters on the Motion tab.</p> <p>When Photos/Videos with RoI/RoNI has been activated, borders of RoIs/RoNIs are shown on photos and videos (for \"Mean Square Diff\" not no videos):</p> <ul> <li>Red borders represent Regions of Interest where motion was detected first.</li> <li>Green borders represent the other specified *Regions of Interest.</li> <li>Blue borders represent *Regions of NO Interest.</li> </ul> <p>In case that photos have been taken together with videos, this is represented as shown below.  Videos show the video length in the footer.</p> <p></p>"},{"location":"TriggerMotion/","title":"Triggered Capture of Videos and Photos","text":""},{"location":"TriggerMotion/#motion-capturing","title":"Motion Capturing","text":"<p>With Motion Capturing, you may trigger actions in case that raspiCamSrv has detected changes in the visual area of the active camera.   Sensitivity of detection is strongly dependent on the algorithm used for detection.</p> <p>raspiCamSrv currently supports 4 different algorithms: - Mean Square Difference between pixel color levels of successive frames. - Frame Differencing - Optical Flow - Background Subtraction</p> <p>The latter 3 variants are implementations of algorithms proposed by Isaac Berrios in Introduction to Motion Detection.</p> <p>Whereas the Mean Square Difference is available in general, the other algorithms require special preconditions for Extended Motion Capturing.</p>"},{"location":"TriggerMotion/#motion-detection-configuration","title":"Motion Detection Configuration","text":"<p>This section allows specification of motion capturing aspects:</p> <ul> <li>Motion Detection Algorithm  allows selecting the algorithm by which the system will recognize motion through its camera.   Depending on the selected algorithm, the relevant parameters are editable and can be adjusted.</li> <li>Mean Square Threshold  is the value of the mean square difference above which the system detects a motion event.</li> <li>Bounding Box Threshold  is the threshold for acceptable contour sizes (see IB-1)</li> <li>IOU Threshold  is the Threshold for \"Intersection Over Union or IOU\" of overlapping bounding boxes (see IB-1)</li> <li>Motion Threshold  is the minimum flow threshold for motion used in Optical Flow algorithm (see IB-2)</li> <li>Background Subtraction Model  is the model used for generating a background model in Background Subtraction algorithm. (see IB-3)</li> <li>Video with Bounding Boxes  allows selection of the type of video recorded for a motion event, if activated on the Control tab.  If activated, the video will show bounding boxes around areas for which motion has been detected.  Otherwise, normal videos will be recorded.</li> <li>Use Regions of Interest  If selected (and submitted) it will be possible to specify a set of rectangular areas which serve as Regions of Interest / Regions of NO Interest.   For Regions of Interest (RoI), motion will only be detected when occurring within these regions (see below).   Regions of NO Interest (RoNI) will be generally excluded from motion detection.</li> <li>Regions of Interest  This field holds the Regions of Interest as a tuple of tuples where each tuple represents one region with (x offset, y offset, width, height). The values refer to the Pixel Array Size of the sensor.   The field is not editable; it is populated when Regions of Interest are drawn.</li> <li>Regions of No Interest  This field holds the Regions of No Interest as a tuple of tuples where each tuple represents one region with (x offset, y offset, width, height). The values refer to the Pixel Array Size of the sensor.   The field is not editable; it is populated when Regions of No Interest are drawn.</li> <li>Photos/Videos with RoI/RoNI  This switch decides whether or not Regions of Interest and/or Regions of NO Interest are drawn on photos or videos captured while Motion Detection is active.  NOTE: When Algorithm \"Mean Square Diff\" is used, RoIs/RoNIs can only be shown on photos but not on videos.</li> </ul> <p>Any changes must be submitted with the Submit button.  Changes will be effective after the Motion Capturing Process has been started the next time.   For example, trees or leaves moving in the wind are normally not of interest.</p>"},{"location":"TriggerMotion/#regions-of-interest-and-regions-of-no-interest","title":"Regions of Interest and Regions of NO Interest","text":"<p>In many cases, it is desirable to restrict the motion-sensitive region of the camera view to specific areas.</p> <p>raspiCamSrv supports two type of areas: - Regions of Interest (RoI) restrict motion detection to these areas - Regions of NO Interest (RoNI) exclude motion detection from specific areas.</p> <p>Both can be used simultaneously or alternatively.   When no RoI is defined, the entire cropping area will be the Region of Interest.  RoNIs will only have an effect if at least a part of them is within a RoI.</p> <p>NOTE: Regions of Interest may be automatically adjusted when the Live View is zoomed or panned/tilted</p> <p>After Use Regions of Interest has been activated (and submitted), a Live View will be shown with a canvas activated on which the intended regions can be drawn:</p> <p></p> <p>You first need to select the type of region to be drawn. Afterwards, you draw the region with left mouse key pressed.</p> <p>Regions of Interest are shown with green border line. Regions of No Interest are shown as blue filled rectangle</p> <p>While drawing a new region, the borders of previously drawn regions are invisible.   All borders are shown as soon as the mouse pointer has left the drawing canvas.</p> <p>To remove previously drawn regions, just deactivate and activate the Use Regions of Interest checkbox without submitting.</p> <p>After all intended regions are finally drawn, submit the Motion Detection Configuration settings.</p>"},{"location":"TriggerMotion/#testing-motion-capturing","title":"Testing Motion Capturing","text":"<p>In order to optimize the parameters for the intended application, raspiCamSrv allows test runs for the selected algorithm.   During a test run, no events are generated. Instead, a preview of different aspects of the chosen algorithm is shown.   Detected motion events are indicated by the occurrence of bounding boxes.   An active test run is indicated by the turquoise status indicator.</p> <ul> <li>For the Mean Square Difference algorithm, there is no test. However, pressing the Test Motion Detection button will show the current framerate in the message line, if motion detection is active.</li> <li>For the other algorithms, pressing the Test Motion Detection button will stop an active Motion Detection server and start a test run.   A set of 4 intermediate images are presented which are calculated from the last, or the last two, frames. </li> </ul> <p>If Regions of Interest are defined, these will be considered and visualized during the test.</p>"},{"location":"TriggerMotion/#test-for-frame-differencing-algorithm","title":"Test for Frame Differencing Algorithm","text":"<p>For a detailed description of this algorithm, see Introduction to Motion Detection: Part 1 by Isaac Berrios.</p> <p></p>"},{"location":"TriggerMotion/#test-for-optical-flow-algorithm","title":"Test for Optical Flow Algorithm","text":"<p>For a detailed description of this algorithm, see Introduction to Motion Detection: Part 2 by Isaac Berrios.</p> <p></p>"},{"location":"TriggerMotion/#test-for-background-subtraction-algorithm","title":"Test for Background Subtraction Algorithm","text":"<p>For a detailed description of this algorithm, see Introduction to Motion Detection: Part 3 by Isaac Berrios.</p> <p></p> <p>This algorithm can normally be expected to give best results.  The fact that the shown example has a lower quality compared to Optical Flow may be attributed to the 'stationary' movement of the object which 'burns' itself into the background model because each frame contributes to the model.</p>"},{"location":"TriggerMotion/#performance","title":"Performance","text":"<p>The performance requirements for the different algorithms have an impact on the frame rates which can be achieved during testing and an active Motion Capturing process.    </p> <p>In order to get information on the frame rates, these are measured during a test and displayed at the bottom of the screen.  Reliable values can only be obtained after the test has run some time. Therefore, it is necessary to refresh the screen using the button aside of the displayed value.</p> <p>Unfortunately, framerates had not been refreshed before recording the GIFs, above.</p> <p>The the following table shows framerates observed with a Pi 5 and a camera model 3:</p> Algorithm Stream Sensor Mode Stream Size Framerate Mean Square Diff lores default 640 x 360 ~14 Frame Differencing lores default 640 x 360 ~14 Optical Flow lores default 640 x 360 ~5 Background Subtraction lores default 640 x 360 ~14 Mean Square Diff lores 0 1536 x 864 ~14 Frame Differencing lores 0 1536 x 864 ~14 Optical Flow lores 0 1536 x 864 ~1 Background Subtraction lores 0 1536 x 864 ~5 Mean Square Diff lores 1 2304 x 1296 ~10 Frame Differencing lores 1 2304 x 1296 ~6 Optical Flow lores 1 2304 x 1296 ~0.3 Background Subtraction lores 1 2304 x 1296 ~2 <p>Below is a load profile taken wit a Pi5, 8GB memory, built in a standard case with fan.  Steaming was never active and no motion was tracked during recording.  </p> <p>Motion tracking with different algorithms was run for 30 minutes in the following sequence: - 18:15 - System idle - 18.30 - Mean Square Diff - 19:00 - Frame Differencing - 19:30 - Background Subtraction - 20:00 - Optical Flow - 20:30 - Motion tracking stopped - 20:45 - raspiCamSrv stopped</p> <p>Although there is a significant impact on CPU utilization, especially for the Optical Flow algorithm, CPU temperature is within reasonable ranges.</p>"},{"location":"TriggerMotion/#recorded-videos","title":"Recorded Videos","text":"<p>If the option to record videos with bounding boxes has been chosen, the videos are generated frame by frame within the algorithm.  The framerate needs to be specified before frames are added to the video.   Currently, the video is started when a motion event has been detected (final number of detected bounding boxes &gt; 0). However, at this time, the real frame rate is not yet known. Therefore a rough estimate is used for the individual algorithms which is close to the values shown in figures, above.</p> <p>This results in videos with motion speed close to real life.</p> <p>If, however, the achieved rates on a specific system differ from these values, the video speed may be timelapse or slow-motion.</p>"},{"location":"TriggerNotification/","title":"Triggered Capture of Videos and Photos","text":""},{"location":"TriggerNotification/#notification","title":"Notification","text":"<p>On this tab, you specify the details required for notification on an event by e-Mail:</p> <p></p>"},{"location":"TriggerNotification/#mail-server-settings","title":"Mail Server Settings","text":"<ul> <li>SMTP Server is the server address, for example \"smtp.gmail.com\"</li> <li>Port is the server port to be used</li> <li>Use SSL specifies whether or not SSL (Secure Sockets Layer) is to be used</li> <li>Server requires Authentication must be checked if the mail server requires authentication with user and password.</li> <li>User is the user name to be used for login to the server. This is typically identical with the e-Mail address.</li> <li>Password is the password required for authentication</li> </ul>"},{"location":"TriggerNotification/#handling-of-mail-server-credentials","title":"Handling of Mail Server Credentials","text":"<p>Credentials for authentication to the mail server are not part of the normal raspiCamSrv configuration.   They ere never exported to JSON files when configuration is stored (Settings/Configuration)  Therefore, they can also not be imported when the server restarts.</p> <p>raspiCamSrv offers two alternatives for secure handling:</p>"},{"location":"TriggerNotification/#1-storage-in-a-secrets-file","title":"1. Storage in a Secrets File","text":"<p>This is activated by checking Store Credentials in File and by specifying the full path of that file in Credentials File Path.  For example, the path could be <code>/home/&lt;user&gt;/.secrets/raspiCamSrv.secrets</code>.  If the path and the file do not exist, they will be automatically created. Access to this file should be restricted to the user running raspiCamSrv as service or from the command line.</p> <p>The advantage of this method is, that on server restart the system can automatically load user name and password for connection to the mail server. Thus, notification will automatically be activated, provided that Triggered Capture is automatically started with server start.</p>"},{"location":"TriggerNotification/#2-manual-entry","title":"2. Manual Entry","text":"<p>Alternatively to storage in a secrets file, User and Password can be manually entered.  raspiCamSrv will keep this information in memory during the server livetime.  After server restart, these credentials are initally not available and, therefore, notification will not be active until the credentials have been entered once on this screen.</p>"},{"location":"TriggerNotification/#mail-settings","title":"Mail Settings","text":"<ul> <li>From e-Mail is the e-Mail address to be shown in the From field. Mail servers may replace this with the e-Mail address of the account.</li> <li>To e-Mail is the e-Mail address of the recipient to whom the notification is to be sent.</li> <li>Subject Is the text for the Subject field of the mail to be sent.</li> <li>With Notification Pause, you can specify a pause in seconds in which no further notification mail wil be sent.  A value smaller than the Detection Pause (see Trigger Control) will have no effect, so that every event will be notified.   If the value is chosen as a multiple (N) of the Detection Pause, only every Nth event will be notified.</li> <li>Include Video specifies whether or not the event video will be included in the mail.   If this is selected, the mail will be sent not earlier than video recording has terminated.   This is determined by Video Duration (see Camera Actions).  Keep in mind that the video size should not exceed the maximum mail size allowed by the provider.</li> <li>Include Photos specifies whether or not photos should be attached to the mail.  If this is selected and a number &gt; 1 has been specified for Photo Burst (see Camera Actions), the mail will not be sent before the last photo has been taken or the next event has been registered.</li> </ul>"},{"location":"TriggerNotification/#submitting-configuration-settings","title":"Submitting Configuration Settings","text":"<p>When submitting configuration entries, the system will automatically try to connect to the mail server using the specified credentials.</p> <p></p> <p></p> <p>If the connection test was successful, this is indicated in the message area, otherwise, an error message is shown.  User and password are removed from the screen and need to be entered again, if necessary.</p> <p>Whether or not connection to the mail server has been verified, is allways shown in the top of the screen.</p>"},{"location":"TriggerNotification/#entering-credentials-after-server-restart","title":"Entering Credentials after Server Restart","text":"<p>After the server has been restarted and credentials are not stored in a secrets file, they need to be entered once:</p> <p></p>"},{"location":"TriggerNotification/#notification-errors","title":"Notification Errors","text":"<p>Sending a mail may require several seconds, especially if the mail includes larger attachments.  Therefore an additional thread is started for each mail to be sent, in order not to block capturing events.</p> <p>If an error occurs while trying to send a mail, an error status is set in the Trigger configuration settings.  The error message is shown on the Control Tab of the Trigger screen:   </p> <p></p> <p>The message will vanish when Triggered Capture is restarted or when the server is restarted.   </p> <p>Errors occurring in the sending process do not stop motion capturing.</p>"},{"location":"TriggerTriggerActions/","title":"Trigger-Actions","text":"<p>On this page, you specify which actions are invoked in case of a specific Trigger event.</p> <p></p> <p>IMPORTANT: To preserve any configurations over server restart, you need to store the configuration and activate Start Server with stored Configuration</p> <p>The dialog will only allow changes when the event handling thread is not active.</p> <p>Just activate the check box for every event you want to be triggered by a specific trigger.</p>"},{"location":"TriggerTriggers/","title":"Triggers","text":"<p>This page is used for spacification of triggers.    Triggers are registered events occurring for the camera system or for GPIO input devices which can be used to initiate one or multiple actions.</p> <p></p> <p>IMPORTANT: To preserve any configurations over server restart, you need to store the configuration and activate Start Server with stored Configuration</p>"},{"location":"TriggerTriggers/#creating-a-trigger","title":"Creating a Trigger","text":"<ol> <li> <p>In field Trigger Source, select the source system for which the trigger is defined:   (Camera and Motion Detector will be available as option only when a camera is available)   </p> </li> <li> <p>This will open a list of devices defined for the chosen source system:    for the GPIO system, these are the Input devices configured on Settings/Devices</p> </li> <li>After a device has been selected, the system will show the device type with a link to related gpiozero documentation as well as the events which can be trapped for this device (this information is taken from the fixed configuration for the device type):   </li> <li>When the event has been chosen, the sytem will display any parameters which may be required for this event:    Now you need to specify values for these parameters, unless you leave the defaults, and enter a unique name for the trigger.   In this step, the Submit button will be activated.    </li> <li>Pressing the Submit button will create the trigger and show it in the Trigger Overview.</li> </ol>"},{"location":"TriggerTriggers/#parameters","title":"Parameters","text":"<p>The parameters, for which values can be specified, are properties or methods of the device class.   Information about their function can be obtained from the gpiozero class documentation accessible through the link.</p>"},{"location":"TriggerTriggers/#control","title":"Control","text":"<p>Control parameters are not part of the class functionality but they can affect how raspiCamSrv processes a captured event:</p> <ul> <li>bounce_timeThis is a time interval given in seconds.After an event has been processed, other events occurring within this interval will be ignored.This shall avoid jitter in triggered actions. For some devices (e.g. Button), bounce time can already be specified for the device and will be handled by gpiozero.</li> <li>event_logThe value of this parameter decides whether or not a trigger and its associated actions will be treated as events and included in event logging and event viewer.If False, events triggered by the trigger will not be logged in event logging and they will also not be visible in the event viewer. Instead, if camera actions are associated with the trigger, the resulting photos and videos will be visible in the normal Photo Viewer.</li> </ul>"},{"location":"TriggerTriggers/#restrictions","title":"Restrictions","text":"<p>Only one active trigger can be configured for a specific device-event.</p> <p>If another trigger is configured for the same event, only one trigger will remain active.</p> <p>If you want multiple actions on a specific trigger, you will specify this in Trigger-Actions.</p>"},{"location":"TriggerTriggers/#activation-of-triggers","title":"Activation of Triggers","text":"<p>If the event-handling thread is currently active: - The Active check boxes are locked. - If this is the only trigger for the chosen device-event, the trigger will be activated. - If another trigger exists for the same device-event, the new trigger will not be activated.</p> <p>If the event-handling thread is not active: - The Active check boxes are active - If this is the only trigger for the chosen device-event, the trigger will be activated - If another trigger exists for the same device-event, this will be deactivated and the new trigger will be activated.</p> <p>You can activate/deactivate triggers by changing the Active check box and submitting the change.</p> <p>If you tried to activate several triggers for the same device-event, the system will leave only one of them active.</p>"},{"location":"TriggerTriggers/#deletion-of-triggers","title":"Deletion of Triggers","text":"<p>You can select one or multiple triggers for deletion in the Delete column and submit the selection.</p> <p>The Delete column will only be accessible for change if the event-handling thread is currently not active.</p>"},{"location":"TriggerTriggers/#changing-triggers","title":"Changing Triggers","text":"<p>Changing of triggers is currently not possible.</p> <p>However, you can easily create a new similar one with different parameters and deactivate the old one.</p>"},{"location":"Troubelshooting/","title":"raspiCamSrv Troubleshooting","text":"<p>This page intends to collect information on how to deal with errors or problems which may occur while running raspiCamSrv.</p> <ul> <li> <p>Password forgotten  If you have your password forgotten, there are two alternatives:1. Somone else is Superuser:Ask him to remove your user entry and create a new one (See Settings / Users).2. You are the Superuser.You need to reset the database where user entries are stored.You do this with with <code>flask --app raspiCamSrv init-db</code> (see RaspiCamSrv Installation Step 11).At the next Login, you need to Register as new Superuser (see Authorization)</p> </li> <li> <p>ERROR in motionDetector: Exception in _motionThread: OpenCV(4.6.0)  This error may occur when trying to use extended motion capturing while the 'YUV420' stream format is set for the Live View Configuration. It seems that OpenCV is not capable to handle images with this format.   This error is typically observed on Pi3 and Pi4 where the YUV stream format is mandatory for the lores stream according to the Picamera2 Manual, ch. 4.2. As a workaround, you may try setting the \"main\" stream for the Live View configuration with \"RGB888\" Stream Format.  To avoid performance issues, also a low Stream Size (e.g. 640x400) should be chosen. See raspi-cam-srv Issue #48</p> </li> <li> <p>No Connection to server although server has been started as service.   This may happen (see raspi-cam-srv Issue #8) if the service has been started before the network interfaces are ready.  The systemd journal will indicate that the Flask server is only listening to localhost (127.0.0.1)  In this case, more restrictive settings in the After clause of the service configuration file may be required (see systemd Network Configuration Synchronization Points) </p> </li> <li>SystemError: No cameras were found on the server's device  See raspi-cam-srv Issue #6</li> <li> <p>ERROR in camera_pi: Could not import SensorConfiguration from picamera2.configuration. Bypassing sensor configuration  This message may occur when running on Bullseye systems.  Currently, it can be ignored because the missing SensorConfiguration class has currently no impact on raspiCamSrv functionality.  SensorConfiguration is a class in Picamera2 which is referenced in the CameraConfiguration (see Picamera2 Manual chapter 4.3)   It includes information on the output size and bit depth of a stream.   In Bullseye systems, this class is missing.        Currently, raspiCamSrv does not require the SensorConfigiuration but it is included in the data model because Picamera2 uses it.  The error occurs when trying to import the class.   </p> </li> <li> <p>WARN RPiSdn sdn.cpp:39 Using legacy SDN tuning - please consider moving SDN inside rpi.denoise  This is just a warning from the libcamera system that the tuning file should be updated.     It is currently not known that there is an impact on raspiCamSrv functionality.</p> </li> <li> <p>ERROR V4L2 v4l2_videodevice.cpp:1906 /dev/video4[16:cap]: Failed to start streaming: Broken pipe See picamera2 Issue #104 from Feb 1, 2024  The recommended solution was to go back to kernel release 6.1.65 with <code>sudo rpi-update d16727d</code></p> </li> <li>ModuleNotFoundError: No module named 'picamera2'  See raspi-cam-srv Issue #4</li> <li>TypeError: memoryview: casts are restricted to C-contiguous views  See picamera2 Issue #959</li> </ul>"},{"location":"Troubelshooting/#logging","title":"Logging","text":"<p>The raspiCamSrv server uses Python logging.</p> <p>Logging is initialized in module <code>__init__.py</code>.  All lines controlling the way of logging or code generation are preceeded with a comment line, starting with  <code>#&gt;&gt;&gt;&gt;&gt;</code></p> <p>By default, a StreamingHandler is added to all loggers which outputs log information to sys.stderr.  If desired, the prepared FileHandler can be activated.</p> <p>The log level for all loggers is initialized with level ERROR.  This can be modified for all or for specific modules.</p>"},{"location":"Troubelshooting/#flask-logging","title":"Flask logging","text":"<p>Flask logging is controlled by <code>app.logger</code></p>"},{"location":"Troubelshooting/#werkzeug-logging","title":"Werkzeug logging","text":"<p>Werkzeug implements WSGI, the standard Python interface between applications and servers.</p> <p>Werkzeug logs basic request/response information.</p> <p>Werkzeug logging is controlled by <code>logging.getLogger(\"werkzeug\")</code>.</p> <p>The log level is initialized in <code>__init__.py</code> with INFO, in order to enable informative logging during server start.</p> <p>After the server has been started, the log level is raised to ERROR.  This is done in <code>auth.py</code> in function <code>login_required(view)</code>.</p>"},{"location":"Troubelshooting/#raspicamsrv-logging","title":"raspiCamSrv Logging","text":"<p>Logging can be controlled individually for each module.</p>"},{"location":"Troubelshooting/#libcamera-logging","title":"libcamera logging","text":"<p>The libcamera library is the basic C++ camera library on which Picamera2 is based.</p> <p>The log level is controlled through an environment variable LIBCAMERA_LOG_LEVELS.  This is set in <code>__init__.py</code> to WARNING.  Other allowed log levels are listed in the comment.</p> <p>For more details, see Picamera2 manual, chapter 8.6.2</p>"},{"location":"Troubelshooting/#picamera2-logging","title":"Picamera2 logging","text":"<p>Picamera2 logging is initialized in <code>__init__.py</code> with ERROR</p> <p>For more details, see Picamera2 manual, chapter 8.6.1</p>"},{"location":"Troubelshooting/#generation-of-python-code-for-camera","title":"Generation of Python Code for Camera","text":"<p>The system can generate a file with Python code including the entire interaction of raspiCamSrv with Picamera2.  This file can then be used for debugging and error analysis.</p> <p>A specific logger (\"pc2_prg\") with with level DEBUG is used for code generation.  The logger can be activated by setting  <code>prgLogger.setLevel(logging.DEBUG)</code>  in <code>__init___.py</code></p> <p>The code file is located in  <code>/home/&lt;user&gt;/prg/raspi-cam-srv/logs</code>  with name  <code>prgLog_YYYYMMDD_hhmmss.log</code></p> <p>A new file will be generatet at every server start.</p> <p>To run the files, you neet to change the file type from <code>.log</code> to <code>.py</code>  Generating the files with <code>.py</code> extension does not work because Flask seems to recognize these files and does strange things.</p> <p>All photo and video output generated by these files will be located at   <code>/home/&lt;user&gt;/prg/raspi-cam-srv/output</code>  with the same file names as in the original session.</p>"},{"location":"Tuning/","title":"raspiCamSrv Camera Tuning","text":"<p>The algorithms of Raspberry Pi cameras are affected by tuning files which are specific for each camera type and Raspberry Pi version. These files are automatically loaded when the camera system is instantiated.  A set of default tuning files for all camera models are part of the Raspberry Pi OS distribution.    (For details, see the Raspberry Pi Camera Algorithm and Tuning Guide)</p> <p>With raspiCamSrv, you can control which files are used and you may tweak specific features within these files to optimize the camera behavior for your specific needs.</p> <p>This functionality can be accessed through menu Config, submenu Tuning:</p> <p></p> <p>The configuration provides three parameters:</p> <ul> <li>Name of Tuning FileThis is the name of the tuning file to be loaded for the active camera.Raspberry Pi OS distributions include default tuning files with '.json' type and a name which is identical to the name of the camera model.If you provide own tuning files, you may choose an arbitrary name. If you are using multiple camera models simultaneously, you should be able to correctly associate a file with a camera model.</li> <li>Full path to folder with tuning filesIf this is empty (None), Picamera2 will search a system-specific list of likely installation folders for the required tuning file.raspiCamSrv supports usage of a custom folder (<code>/home/&lt;user&gt;/prg/raspi-cam-srv/raspiCamSrv/static/tuning</code>) which allows keeping own tuning files separate from the default ones.</li> <li>Load Tuning FileIf this checkbox is activated, raspiCamSrv will request Picamera2 to load the specified tuning file instead of the default one.Otherwise, Picamera2 will load the default tuning file.</li> </ul> <p>Any changes of one of these parameters needs to be submitted with the Submit &amp; Apply button.   If Load Tuning File is checked, a restart of the live stream will be requested so that the result of the chosen tuning file can be directly seen in the Live view.</p>"},{"location":"Tuning/#switching-between-custom-and-default-folder","title":"Switching between Custom and Default Folder","text":"<ul> <li>Button Custom Folder will switch the folder for tuning files to the custom folder <code>/home/&lt;user&gt;/prg/raspi-cam-srv/raspiCamSrv/static/tuning</code>If there is already a tuning file with the specified name in this folder, it will be used.If the tuning file does not yet exist in the custom folder, the standard tuning file will be copied to the custom folder.</li> <li>Button Default Folder (toggled) will switch to the default folder.This folder is system-specific, e.g. <code>/usr/share/libcamera/ipa/rpi/pisp</code></li> </ul>"},{"location":"Tuning/#modification-of-tuning-files","title":"Modification of Tuning Files","text":"<p>Modification of tuning files with raspiCamSrv can only be done in the custom folder.</p> <p>If you are not directly accessing the tuning files on the Raspberry Pi, you can download a file, rename it, if desired, and modify it on the client machine.    Afterwards you can upload it to the custom folder.   When done, the file will be available for selection.</p>"},{"location":"Tuning/#deleting-a-tuning-file","title":"Deleting a Tuning File","text":"<p>The button Delete Tuning File will only be active, if</p> <ul> <li>the custom folder is activated</li> <li>Load Tuning File is unchecked</li> <li>No parameter changes have beenn made after the last Submit &amp; Apply</li> </ul> <p>This restriction avoids inadvertently deleting the wrong file if the file has been changed without submitting.</p>"},{"location":"Tuning/#download-tuning-file","title":"Download Tuning File","text":"<p>A tuning file can be downloaded from the default folder or from the custom folder.</p>"},{"location":"Tuning/#uploading-tuning-files","title":"Uploading Tuning Files","text":"<p>The buttons for upload will only be active if the custom folder is selected.</p> <ol> <li>You start pushing the Select Tuning File for Upload button</li> <li>If a single file has been selected, its name will be shown on the button:</li> <li>If a multiple files have been selected, the number of selected files will be shown on the button:</li> <li>Finally, you need to the Upload selected File button to upload:</li> </ol>"},{"location":"Tuning/#using-a-different-custom-folder","title":"Using a different Custom Folder","text":"<p>If you have already prepared tuning files in a specific folder on the Raspberry Pi, which is different from the Custom Folder used by raspiCamSrv, you can also refer to this folder.</p> <p>You first need to manually enter the Full Path to this folder and push Submit &amp; Apply.</p> <p>Afterwards, the .json files in this folder will be available for selection as Name of Tuning File</p>"},{"location":"Tuning/#tuning-with-multiple-cameras","title":"Tuning with Multiple Cameras","text":"<p>Tuning files are specific for a camera and not for a camera model.</p> <p>If two cameras are used with a Pi5, the tuning file needs to be individually specified for each camera, also if both are the same model.</p> <p>To preserve the tuning configuration for a camera, it must be memorized using the Memorize Configuration and Controls for Camera Change in screen Multi Cam</p> <p>Because of a Threading issue in Picamera2 (see Picamera2 Issue #1103 Tuning file support not thread-safe?), the streams from the two cameras in dialog Web Cam may look as if the tuning file of the first camera would have also been applied to the second one.</p> <p>Nevertheless, the handling in raspiCamSrv is correct.  You may proof this in the following way:</p> <ol> <li>Activate a dialog without live view, e.g. Info.</li> <li>Wait at least 10 sec. until both streaming threads have terminated (refresh the screen from time to time)</li> <li>In another browser window, stream just one camera (endpoint video_feed or video_feed2).You should then see the effect of the correct tuning file.However, if you later start streaming the other camera, you may see that the tuning file for the previously started camera has been applied.</li> </ol>"},{"location":"UserGuide/","title":"RaspiCamSrv User Guide","text":"<p>The variant of the user interface, described on this page, refers to the case where at least one camera (CSI or USB) is available.  If this is not the case, refer to the reduced user interface.</p>"},{"location":"UserGuide/#startup","title":"Startup","text":"<p>When the server on a Pi is running and the Pi is reacheable through the network (usually WiFi), you can connect with a browser using the Pi address ('raspi05' in the example below) with the Flask port number, usually 5000, e.g.: <code>http://raspi05:5000</code></p>"},{"location":"UserGuide/#login","title":"Login","text":"<p>The system will request an initial registration and a login and subsequently open the Live application screen.</p> <p>For error handling, see raspiCamSrv Troubleshooting  For interoperability, raspiCamSrv provides an API which allows access to selected functions through web services.</p>"},{"location":"UserGuide/#csi-usb-cameras","title":"CSI-/USB-Cameras","text":"<p>In addition to CSI cameras (2 for Pi 5), you can connect as many USB cameras as physical USB ports are available.   However, at a time, raspiCamSrv will only operate two of them simultaneously.  Related to usability in the UI, you will almost see no difference between CSI and USB cameras. Where they are important, they are handled in the UI and described in their context.</p>"},{"location":"UserGuide/#application-screen","title":"Application Screen","text":""},{"location":"UserGuide/#elements","title":"Elements","text":""},{"location":"UserGuide/#title-bar","title":"Title bar","text":"<p>On the left side, the title bar shows</p> <ul> <li>the current version of raspiCamSrvIf an update to this version is available, the version number is shown in yellow: (See Settings/Update dialog)</li> </ul> <p>On the right side, the title bar shows</p> <ul> <li>the current server connection</li> <li>the active camera as advertised by Picamera2</li> <li>the active user</li> <li>A special icon will indicate unsaved configuration changes:It will vanish after changes have been saved with Settings/Configuration/Store Configuration or after a stored configuration has been loaded.  The icon can be pressed (2 times) to save unsaved changes.</li> </ul> <p>On the left side, the title bar shows the application name (raspiCamSrv) and the current screen.</p>"},{"location":"UserGuide/#main-menu","title":"Main Menu","text":"<p>The main menu (black background) allows navigation to different screens:</p> <ul> <li>Live shows the Live Screen which includes functionality for image control as well as photo- and video taking</li> <li>Config gives access to camera Tuning and camera Configuration where basic camera configurations can be specified for different scenarios.</li> <li>Info opens the Camera Information page with information on the system and installed cameras as well as Properties and Sensor Modes of the active camera.</li> <li>Photos shows the Photos where the currently available photos and videos can be browsed and inspected in detail.</li> <li>Photoseries opens the Photo Series page for definition and control of photo series.</li> <li>Trigger Allows configuring and controlling triggered actions, based on Motion Capturing as well as on configured events from GPIO-connected sensors</li> <li>Cam gives access to the dialogs for Web Cam access; Multi Cam for multi-camera control.   If a Stereo Camera configuration is activated, it hosts also the dialogs for Camera Calibration as well as for Stereo Vision.</li> <li>Console is dedicated to manually controlled interactions with the Raspberry Pi OS or with GPIO-connected Actors, such as motors, servos or LEDs.</li> <li>Settings opens the Settings page for all kinds of static configurations for raspiCamSrv.</li> <li>Log Out will log the active user out and direct to the Log-In Screen</li> </ul> <p>NOTE: Selecting an option on the main menu will issue a request to the server with a specific URL and, thus, refresh the screen.</p>"},{"location":"UserGuide/#submenu","title":"Submenu","text":"<p>Many of the raspiCamSrv pages, selected by a Main Menu option have a submenu.   Submenues are indicated by a green background.</p> <p>NOTE: Selecting an option on a submenu will not issue a new request and, thus, will not refresh the screen with new information from the server.   Instead, submenu options activate different sections of the currently loaded page.  However, Submit buttons on a page section apply only to data shown on the active section and not to data on other sections of the same page.</p>"},{"location":"UserGuide/#process-status-indicators","title":"Process Status indicators","text":"<p>On the right side of the menu bar there is a group of status indicators for the different background processes:</p> <p></p> <p></p> <p>From right to left, these indicate the status of</p> <ul> <li>Live stream thread for active camera</li> <li>Video thread for the active camera</li> <li>Recording audio along with video for the active camrera</li> <li>Photo Series thread</li> <li>Motion Capture thread</li> <li>Trigger thread</li> <li>Live stream thread for the second camera, if available (see Web Cam or Multi-Cam)</li> <li>Video thread for the second camera, if available (see Multi-Cam)</li> </ul> <p>Red color indicates that a process is active whereas gray indicates that it is inactive.   </p> <p>In the case of motion capture or event handling,    </p> <ul> <li>yellow color indicates that the process is active but currently not scheduled to register events</li> <li>turquoise color indicates that the motion capture process runs in test mode</li> </ul> <p> </p>"},{"location":"UserGuide/#message-line","title":"Message Line","text":"<p>At the bottom of the screen, there is a message line where application messages will be shown when necessary.</p>"},{"location":"UserGuide/#streaming","title":"Streaming","text":"<p>raspiCamSrv supports streaming MJPEG video.</p> <p>The straming URLs are  <code>http://&lt;server&gt;:&lt;port&gt;/video_feed</code> for MJPEG video with Active Camera  <code>http://&lt;server&gt;:&lt;port&gt;/photo_feed</code> for photo snapshots with Active Camera and low resolution    <code>http://&lt;server&gt;:&lt;port&gt;/photo_feed_hr</code> for photo snapshots with Active Camera and high resolution    <code>http://&lt;server&gt;:&lt;port&gt;/video_feed2</code> for MJPEG video with Second Camera  <code>http://&lt;server&gt;:&lt;port&gt;/photo_feed2</code> for photo snapshots with Second Camera and low resolution    <code>http://&lt;server&gt;:&lt;port&gt;/photo_feed2_hr</code> for photo snapshots with Second Camera and high resolution    All URLs can be accessed without authentication if the checkbox Req. Auth for Streaming on the Settings screen is deactivated.  If this checkbox is activated, a user must have logged in to raspiCamSrv once in the same browser session which shall be used for streaming. A streaming or snapshot request in a browser session without login will redirect to the login screen.</p> <p>In the web client, an active streaming server is indicated with the process status indicators as    if only the active camera is streaming or   if both cameras are streaming or     if if only the second camera is streaming     </p> <p>A live stream is shown in in the Live Screen for the active camera or on the Web Cam or Multi-Cam pages for both cameras.</p> <p>If Stereo Vision is active, both cameras are streaming:             When these indicators turn yellow, this indicates that the additional stereo camera process is active, serving the stereo vision stream.</p> <p>The streaming servers are automatically shut down if no client has been streaming within the last 10 seconds.  This is independently controlled for both cameras as well as for the stereo camera process.  For example if one is working in other dialogs rather than Live Screen, straming is not used and the streaming servers are shut down, which is indicated by   Streaming is automatically reactivated, if a streaming client connects, for example if the Live Screen is activated.</p> <p>Other clients, either connecting directly through the streaming URL or by using the raspiCamSrv web client, will also activate the streaming servers.</p> <p>Streaming of the active camera can be deactivated, if a raspiCamSrv task is executed which requires exclusive access to the camera because of a specific Configuration which is not compliant with the configuration required for streaming (for more details, see raspiCamSrv Tasks and Background Processes).</p> <p>NOTE  For a full understanding of application details, users should familiarize with the official document Raspberry Pi - The Picamera2 Library. The document version, on which this raspiCamSrv release is based, is also included in this documentation: picamera2-manual.pdf</p>"},{"location":"UserGuide/#media-viewer","title":"Media Viewer","text":"<p>In several dialogs, the raspiCamSrv UI shows photos or videos which have been taken with the camera system.   Although most of these are larger than typical thumbnails, they may be too small for more detailed inspection of quality or image details.</p> <p>Therefore, raspiCamSrv provides a Media Viewer which can be started by clicking on the image or video.</p> <p>The availability of a Media Viewer is indicated by a modified cursor when hovering over the image.</p> <p></p> <p>Klicking on the image, will open a new browser tab with the selected image or video:</p> <p></p> <p>The tab can be separated from the main browser window and zoomed to screen size or full screen mode.</p> <p>The file name of the image/video is shown as tab title.</p>"},{"location":"UserGuide/#media-viewer-for-videos","title":"Media Viewer for videos","text":"<p>When videos are shown with controller icons for play/stop etc., only the upper area is sensitive for starting the media viewer whereas the lower area is used for controlling the video playback.</p> <p></p> <p>The Media Viewer browser tab will include its own set of controls:</p> <p></p>"},{"location":"UserGuide/#live-stream","title":"Live Stream","text":"<p>The live stream, available in dialogs Live, Cam and Trigger/Motion are not enabled for Media Viewer activation. Instead, the live stream can be directly opened in a separate window using the Streaming URL.</p>"},{"location":"UserGuide_NoCam/","title":"RaspiCamSrv User Guide (No Camera)","text":"<p>This is a special variant of the general raspiCamSrv User Interface for the case when no camera is available.</p> <p>This applies to the following situations:</p> <ul> <li>There is currently no camera at all connected to the Raspberry Pi, neither CSI camera nor USB camera.</li> <li>Currently, only one or more USB cameras are connected and have been recognized by the system (see Info) but usage of USB cameras has been deactivated in Settings.</li> </ul>"},{"location":"UserGuide_NoCam/#application-screen","title":"Application Screen","text":"<p>Initailly, the system starts up with the Info dialog activated: </p>"},{"location":"UserGuide_NoCam/#elements","title":"Elements","text":""},{"location":"UserGuide_NoCam/#title-bar","title":"Title bar","text":"<p>On the right side, the title bar shows</p> <ul> <li>the current server connection</li> <li>An information that currently no camera is available</li> <li>the active user</li> <li>A special icon will indicate unsaved configuration changes:It will vanish after changes have been saved with Settings/Configuration/Store Configuration or after a stored configuration has been loaded.   The icon can be pressed to save unsaved changes.</li> </ul> <p>On the left side, the title bar shows the application name (raspiCamSrv) and the current screen.</p>"},{"location":"UserGuide_NoCam/#main-menu","title":"Main Menu","text":"<p>The main menu (black background) allows navigation to different screens:</p> <ul> <li>Info opens the Camera Information page with information on installed cameras as well as Properties and Sensor Modes of the active camera.</li> <li>Trigger Allows configuring and controlling triggered actions, based on configured events from GPIO-connected sensors</li> <li>Console is dedicated to manually controlled interactions with the Raspberry Pi OS or with GPIO-connected Actors, such as motors, servos or LEDs.</li> <li>Settings opens the Settings page for all kinds of static configurations for raspiCamSrv.</li> <li>Log Out will log the active user out and direct to the Log-In Screen</li> </ul> <p>NOTE: Selecting an option on the main menu will issue a request to the server with a specific URL and, thus, refresh the screen.</p>"},{"location":"UserGuide_NoCam/#submenu","title":"Submenu","text":"<p>Most of the raspiCamSrv pages, selected by a Main Menu option have a submenu.   Submenues are indicated by a green background.</p> <p>NOTE: Selecting an option on a submenu will not issue a new request and, thus, will not refresh the screen with new information from the server.   Instead, submenu options activate different sections of the currently loaded page.  However, Submit buttons on a page section apply only to data shown on the active section and not to data on other sections of the same page.</p>"},{"location":"UserGuide_NoCam/#process-status-indicators","title":"Process Status indicators","text":"<p>On the right side of the menu bar there is space status indicators for background processes:</p> <p>When a camera is not available, there is only the status indicator for the Trigger thread:</p> <p></p> <p>Gray color indicates that a process is inactive whereas red indicates that it is active.  </p> <p>Yellow color indicates that the process is active but currently not scheduled to register events </p>"},{"location":"UserGuide_NoCam/#message-line","title":"Message Line","text":"<p>At the bottom of the screen, there is a message line where application messages will be shown when necessary.</p>"},{"location":"ZoomPan/","title":"raspiCamSrv Zoom &amp; Pan","text":"<p>This tab allows zooming and panning the image area within the dimensions supported by the camera pixel array size and Sensor Modes.</p> <p>For more details, see Image Cropping and Sensor Modes</p> <p>NOTE: When zoom or pan/tilt changes the cropping window of the Live View, Regions of Interest which may heve been defined for Motion Capturing may be adjusted to the new cropping window.</p>"},{"location":"ZoomPan/#current-zoom-factor-in","title":"Current zoom factor in %","text":"<p>This value shows the current zoom factor.  It cannot be modified manually but only through the Zoom in, Zoom out or Full buttons.</p> <p>The value is given in % of the ScalerCrop Default size.</p>"},{"location":"ZoomPan/#zoom-pan-step-in","title":"Zoom &amp; pan step in %","text":"<p>This value can be adjusted.  It specifies the step size by which every click on Zoom in or Zoom out will change the Current zoom factor.</p>"},{"location":"ZoomPan/#current-scalercrop-zoom","title":"Current ScalerCrop (Zoom)","text":"<p>This rectangle, given in pixels, specifies the ScalerCrop rectangle which will be requested as part of the Camera Controls.   </p> <p>The rectangle is given as tuple (x_offset, y_offset, width, height).</p> <p>When drawing the zoom window (see below), the rectangle parameters will be updated.</p> <p>After Submitting, the entry should be identical to the Current ScalerCrop (Live View).</p>"},{"location":"ZoomPan/#current-scalercrop-live-view","title":"Current ScalerCrop (Live View)","text":"<p>This shows the scaler crop rectangle which is currently active for the live view.</p> <p>The Current ScalerCrop (Live View) is the base for determining offset and size of the Autofocus Windows when drawing rectangles on the canvas (see Focus).</p> <p>The Current ScalerCrop (Live View) is also the base for Regions of Interest or Regions of No Interest, which can be defined for Motion Capturing.</p>"},{"location":"ZoomPan/#zoom","title":"Zoom","text":"<p>The following buttons allow zooming:</p> <ul> <li>Zoom in  zooms into the image (reduces the viewport), keeping the center.</li> <li>Zoom out  zooms out (enlarges the viewport), keeping the center.   If the image had been panned before, the center will be shifted, if necessary, to keep the ScalerCrop rectangle within the ScalerCrop Maximum area.</li> <li>Full   Zooms to 100% keeping the center, unless a shift is required to keep the ScalerCrop rectangle within the ScalerCrop Maximum area.</li> </ul>"},{"location":"ZoomPan/#pan","title":"Pan","text":"<p>Panning can be done with the following buttons:</p> <ul> <li>Pan up / Pan down   Move the ScalerCrop rectangle up/down until the upper/lower border of the ScalerCrop Maximum rectangle is reached.</li> <li>Pan left / Pan right   Move the ScalerCrop rectangle left/right until the left/right border of the ScalerCrop Maximum rectangle is reached.</li> <li>Center  Move the ScalerCrop rectangle to the center of the ScalerCrop Maximum rectangle, keeping the zoom factor.</li> <li>Default  Set the ScalerCrop rectangle to the ScalerCrop Default rectangle.</li> </ul>"},{"location":"ZoomPan/#graphically-setting-the-zoom-window","title":"Graphically setting the Zoom Window","text":"<p>Pushing the Draw button will switch into graphical mode where the zoom window can be drawn on a canvas over the Live Stream area.  All other buttons, except Full will be disabled in this mode.</p> <p></p> <p>Attention: With Safari (e.g. on an iPad), due to the issue with onload events, the canvas will not be directly visible. It needs to trigger window resize by shortly 'pulling' down the window.</p> <p>While drawing a rectangle for the intended image section, the original aspect ratio will be preserved.  After drawing is finished, the Current ScalerCrop (Zoom) will be updated with offset and dimensions of the zoom window.</p> <p>After pressing Draw, the button has changed to Submit which must be pressed in order to apply the ScalerCrop setting to the preview and store it for later photo or video taking.</p> <p>Pressing Submit terminates the graphic mode.</p> <p>When the Full button is pressed in the graphic mode, the dialog returns to normal mode without applying a previously drawn zoom window.</p>"},{"location":"bp_Hotspot_Bookworm/","title":"Hotspot Configuration for 'Bookworm' OS","text":"<p>This section describes how to configure a Raspberry Pi as hotspot if the OS is Debian Bookworm.</p> <p>In the following description, you will need to replace</p> <ul> <li><code>&lt;SSID&gt;</code> with the intended hotspot SSID, e.g. \"RaspCamSrv01\"</li> <li><code>&lt;passphrase&gt;</code> with the passphrase to protect hotspot access</li> </ul> <p>The connection ID, used in NetworkManager commands is chosen as \"RaspiCamSrv\"</p>"},{"location":"bp_Hotspot_Bookworm/#1-install-required-packages","title":"1. Install required packages","text":"<pre><code>sudo apt install dnsmasq iptables\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#2-configure-hotspot","title":"2. Configure Hotspot","text":"<pre><code>sudo nmcli con add type wifi ifname wlan0 con-name RaspiCamSrv autoconnection yes ssid &lt;SSID&gt;\n\nsudo nmcli con modify RaspiCamSrv 802-11-wireless.mode ap 802-11-wireless.band bg\n\nsudo nmcli con modify RaspiCamSrv wifi-sec.key-mgmt wpa-psk\n\nsudo nmcli con modify RaspiCamSrv wifi-sec.psk \"&lt;passphrase&gt;\"\n\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#3-assign-a-fixed-ip-address","title":"3. Assign a Fixed IP Address","text":"<pre><code>sudo nmcli con modify RaspiCamSrv ipv4.method manual ipv4.addresses 192.168.1.1/24\n\nsudo nmcli con modify RaspiCamSrv ipv4.gateway 192.168.1.1\n\nsudo nmcli con modify RaspiCamSrv ipv4.dns 192.168.1.1\n\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#4-activate-hotspot","title":"4. Activate Hotspot","text":"<pre><code>sudo nmcli con up RaspiCamSrv\n</code></pre> <p>If your SSH session uses the Wi-Fi Adapter, connection will now be lost.</p> <p>If you reconnect, the ethernet adapter will be used.</p> <p>At this time, a TCP/IP connection through the hotspot is not yet possible. </p>"},{"location":"bp_Hotspot_Bookworm/#5-configure-dhcp-for-hotspot","title":"5. Configure DHCP for hotspot","text":"<pre><code>sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf.orig\n\nsudo nano /etc/dnsmasq.conf\n</code></pre> <p>Enter the following code:</p> <pre><code>interface=wlan0 \nno-dhcp-interface=eth0\ndhcp-range=192.168.1.100,192.168.1.200,255.255.255.0,24h\ndhcp-option=option:router,192.168.1.1 \ndhcp-option=option:dns-server,192.168.1.1\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#6-check-and-start-dhcp-server-and-dns-cache","title":"6. Check and start DHCP Server and DNS-Cache","text":"<pre><code>dnsmasq --test -C /etc/dnsmasq.conf\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#7-enable-dnsmasq-for-automatic-start","title":"7. Enable dnsmasq for automatic start","text":"<pre><code>sudo systemctl restart dnsmasq\n\nsudo systemctl status dnsmasq\n\nsudo systemctl enable dnsmasq\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#8-enable-ip-forwarding","title":"8. Enable IP Forwarding","text":"<pre><code>sudo nano /etc/sysctl.conf\n</code></pre> <p>Find and uncomment the following line:</p> <pre><code>net.ipv4.ip_forward=1\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#9-set-up-nat","title":"9. Set up NAT","text":"<pre><code>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\n\nsudo iptables -A FORWARD -i eth0 -o wlan0 -m state --state RELATED,ESTABLISHED -j ACCEPT\n\nsudo iptables -A FORWARD -i wlan0 -o eth0 -j ACCEPT\n\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#10-save-firewall-rules","title":"10. Save Firewall Rules","text":"<pre><code>sudo sh -c \"iptables-save &gt; /etc/iptables.rules\"\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#11-load-firewall-rules-on-boot","title":"11. Load firewall rules on boot","text":"<pre><code>sudo nano /etc/network/interfaces\n</code></pre> <p>Add the following line:</p> <pre><code>post-up iptables-restore &lt; /etc/iptables.rules\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#12-extend-hosts","title":"12. Extend hosts","text":"<pre><code>sudo nano /etc/hosts\n</code></pre> <p>Add the following line:</p> <pre><code>192.168.1.1 &lt;hostname&gt;\n</code></pre> <p>where <code>&lt;hostname&gt;</code> must be replaced by the host name specified during OS setup.</p>"},{"location":"bp_Hotspot_Bookworm/#13-reboot-the-system","title":"13. Reboot the system","text":"<pre><code>sudo reboot\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#14-check-processes","title":"14. Check processes","text":"<p>After reconnecting with SSH</p> <pre><code>nmcli con show --active\n\nip addr show wlan0\n</code></pre>"},{"location":"bp_Hotspot_Bookworm/#19-test-hotspot-access","title":"19. Test Hotspot access","text":"<ul> <li>Unplug the network cable</li> <li>Switch Off/On the power supply</li> <li>From a mobile device, wait for the hotspot and try to connect.</li> </ul>"},{"location":"bp_Hotspot_Bullseye/","title":"Hotspot Configuration for 'Bullseye' OS","text":"<p>This section describes how to configure a Raspberry Pi as hotspot if the OS is Debian Bullseye.</p>"},{"location":"bp_Hotspot_Bullseye/#1-install-required-packages","title":"1. Install required packages","text":"<pre><code>sudo apt install dnsmasq hostapd iptables\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#2-configure-wlan","title":"2. Configure WLAN","text":"<pre><code>sudo nano /etc/dhcpcd.conf\n</code></pre> <p>Copy/Paste the following code:</p> <pre><code>interface wlan0\nstatic ip_address=192.168.1.1/24\nnohook wpa_supplicant\n</code></pre> <p>This will configure the Wi-Fi adapter with a static IP address 192.168.1.1</p>"},{"location":"bp_Hotspot_Bullseye/#3-restart-dhcp","title":"3. Restart DHCP","text":"<pre><code>sudo systemctl restart dhcpcd\n</code></pre> <p>If your client is connected through Wi-Fi, it will now lose connection and you need to reconnect, which will now use the ethernet connection.</p>"},{"location":"bp_Hotspot_Bullseye/#4-check-interfaces","title":"4. Check interfaces","text":"<pre><code>ip l\n</code></pre> <p>Check that both, the ethernet interface (eth0) and Wi-Fi adapter (wlan0) are available.</p>"},{"location":"bp_Hotspot_Bullseye/#5-setup-dhcp-server-and-dns-cache","title":"5. Setup DHCP server and DNS-Cache","text":"<pre><code>sudo mv /etc/dnsmasq.conf /etc/dnsmasq.conf_orig\n\nsudo nano /etc/dnsmasq.conf\n</code></pre> <p>Enter the following code:</p> <pre><code>interface=wlan0\nno-dhcp-interface=eth0\ndhcp-range=192.168.1.100,192.168.1.200,255.255.255.0,24h\ndhcp-option=option:dns-server,192.168.1.1\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#6-test-start-dhcp-server-and-dns-cache","title":"6. Test &amp; start DHCP server and DNS Cache","text":"<pre><code>dnsmasq --test -C /etc/dnsmasq.conf\n</code></pre> <p>The response should be</p> <pre><code>dnsmasq: syntax check OK.\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#7-restart-dnsmasq-and-enable-it-for-automatic-start","title":"7. Restart DNSMASQ and enable it for automatic start","text":"<pre><code>sudo systemctl restart dnsmasq\n\nsudo systemctl status dnsmasq\n\nsudo systemctl enable dnsmasq\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#8-setup-wlan-ap-host-hostapd","title":"8. Setup WLAN-AP-Host (hostapd)","text":"<pre><code>sudo nano /etc/hostapd/hostapd.conf\n</code></pre> <p>Replace the content with the following code</p> <pre><code>interface=wlan0\nssid=&lt;SSID&gt;\nchannel=1\nhw_mode=g\nieee80211n=1\nieee80211d=1\ncountry_code=&lt;Country Code&gt;\nwmm_enabled=1\nauth_algs=1\nwpa=2\nwpa_key_mgmt=WPA-PSK\nrsn_pairwise=CCMP\nwpa_passphrase=&lt;wpa_passphrase&gt;\n</code></pre> <p>where you need to replace</p> <ul> <li> with the intended SSID for the hotspot (e.g.: RaspiCamSrv) <li> with your A-2 ISO 3166-1 Country Code <li> with the passphrase to secure hotspot access"},{"location":"bp_Hotspot_Bullseye/#9-test-start-wlan-ap-host","title":"9. Test &amp; start WLAN-AP-Host","text":"<pre><code>sudo hostapd -dd /etc/hostapd/hostapd.conf\n</code></pre> <p>At the end of the output you should find:</p> <pre><code>...\nwlan0: interface state COUNTRY_UPDATE-&gt;ENABLED\n...\nwlan0: AP-ENABLED\n...\n\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#10-test-hotspot-access","title":"10. Test Hotspot Access","text":"<p>With a mobile device try to access the hotspot.</p> <p>This will generate log output in the SSH session.</p>"},{"location":"bp_Hotspot_Bullseye/#11-enable-hostapd-process-for-automatic-start","title":"11. Enable hostapd process for automatic start","text":"<p>In the SSH session stop the active process <pre><code>sudo systemctl unmask hostapd\nsudo systemctl start hostapd\nsudo systemctl enable hostapd\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#12-check-that-hostapd-is-active","title":"12. Check that hostapd is active","text":"<pre><code>sudo systemctl status hostapd\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#13-activate-routing","title":"13. Activate routing","text":"<pre><code>sudo nano /etc/sysctl.conf\n</code></pre> <p>Find and uncomment the following line:</p> <pre><code>net.ipv4.ip_forward=1\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#14-activate-nat","title":"14. Activate NAT","text":"<pre><code>sudo iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE\n\nsudo sh -c \"iptables-save &gt; /etc/iptables.ipv4.nat\"\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#15-assure-nat-activation-at-system-start","title":"15. Assure NAT activation at system start","text":"<pre><code>sudo nano /etc/rc.local\n</code></pre> <p>Before the last line with <code>exit 0</code> enter</p> <pre><code>iptables-restore &lt; /etc/iptables.ipv4.nat\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#16-reboot-the-system","title":"16. Reboot the system","text":"<pre><code>sudo reboot\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#18-check-processes","title":"18. Check processes","text":"<p>After reconnecting with SSH</p> <pre><code>sudo systemctl status hostapd\n\nps ax | grep hostapd\n\nsudo systemctl status dnsmasq\n\nps ax | grep dnsmasq\n</code></pre>"},{"location":"bp_Hotspot_Bullseye/#19-test-hotspot-access","title":"19. Test Hotspot access","text":"<ul> <li>Unplug the network cable</li> <li>Switch Off/On the power supply</li> <li>From a mobile device, wait for the hotspot and try to connect.</li> </ul>"},{"location":"bp_PiZero_Standalone/","title":"Setup of Raspberry Pi Zero as Standalone System","text":"<p>This section describes how to set up a Raspberry Pi Zero W or Zero 2 W as standalone system.</p> <p>This will allow you placing the Raspi camera anywhere, independently from an accessible Wi-Fi.</p> <p>It will act as hotspot to which you can connect from a mobile client to gain access to raspiCamSrv.</p> <p>The subsequent descriptions can, in principle, also be applied for other Raspberry Pi models.</p>"},{"location":"bp_PiZero_Standalone/#headless-setup","title":"Headless Setup","text":"<p>During the setup of such a system, the Raspberry Pi requires a cabled network connection because the Wi-Fi adapter will be configured as hotspot and is, therefore, not available for access by the configuration client.</p> <p>Connections to a display, keyboard and mouse are not required.</p> <p></p> <p>Required cables and adapters:</p> <ul> <li>USB A to Ethernet adapter</li> <li>Micro USB/Male to USB A/Female cable</li> <li>Power supply with Micro USB plug</li> </ul>"},{"location":"bp_PiZero_Standalone/#1-install-os-on-microsd-card","title":"1. Install OS on microSD Card","text":"<p>Follow the instructions for Install using Imager.</p> <ul> <li>Model Make sure to select the correct model</li> <li>Bullseye or Bookworm? raspiCamSrv can be used with both systems. Whereas there were still some issues for early versions of Bookworm on Pi Zero systems,  this is no longer the case with the current version.</li> <li>Full or lite system? It is recommended to install the full system although the desktop environment will not be required.</li> <li>OS Customisation Make sure to Configure wireless LAN, although the Wi-Fi Adapter will later not be run in client mode, however this will assure that the Wireless LAN Country will be set.</li> </ul>"},{"location":"bp_PiZero_Standalone/#2-power-up","title":"2. Power Up","text":"<ol> <li>Connect the camera (the small CSI-2 port of Pi Zero and Pi 5 require a special cable)</li> <li>Insert the microSD card into the card slot</li> <li>If available, encapsulate the Pi into a case</li> <li>Connect the network USB cable through an ethernet adapter to a switch of your local network</li> <li>Connect the power supply</li> </ol>"},{"location":"bp_PiZero_Standalone/#3-connect-and-upgrade","title":"3. Connect and upgrade","text":"<p>The system may take some time until it is visible within the network.</p> <p>From a client device connect via SSH</p> <pre><code>ssh &lt;user&gt;@&lt;hostname&gt;\n\n...\n\nsudo apt update\nsudo apt full-upgrade\n</code></pre>"},{"location":"bp_PiZero_Standalone/#4-configure-hotspot","title":"4. Configure Hotspot","text":"<p>The process of configuration is slightly different, depending on the cosen OS:</p> <ul> <li>Hotspot Configuration for 'Bullseye' OS</li> <li>Hotspot Configuration for 'Bookworm' OS</li> </ul>"},{"location":"bp_PiZero_Standalone/#5-install-raspicamsrv","title":"5. Install raspiCamSrv","text":"<p>For installation, you will need to connect through ethernet.</p> <p>Then, follow the raspiCamSrv Installation Procedure</p>"},{"location":"bp_PiZero_Standalone/#6-configure-raspicamsrv-sercice","title":"6. Configure raspiCamSrv Sercice","text":"<p>Follow the Service Configuration instructions</p>"},{"location":"bp_PiZero_Standalone/#7-test","title":"7. Test","text":"<p>After rebooting, first test using the client connected with ethernet cable.</p> <p>If this is successfull, you can shutdown and unplug the ethernet cable</p> <p>After restart, connect from a mobile client to the hotspot and connect to raspiCamSrv from a browser window.</p>"},{"location":"features/","title":"Features V4.4.x","text":"<p>For more details, see the User Guide.    </p> <p></p>"},{"location":"features/#feature-overview","title":"Feature Overview","text":""},{"location":"features/#platform-support","title":"Platform Support","text":"<ul> <li>raspiCamSrv can be run on all currenly known Raspberry Pi hardware platforms (except microcontroller boards) from Raspberry Pi Zero W to Raspberry Pi 5</li> <li>Supported Operating Systems are the Raspberry Pi OS versions Bullseye, Bookworm and Trixie.</li> <li>The recommended variant for all of these is the full 64-Bit variant recommended by Raspberry Pi Imager</li> </ul>"},{"location":"features/#camera-support","title":"Camera Support","text":"<ul> <li>raspiCamSrv supports the currently available Raspberry Pi Cameras, however AI features for the AI Camera are currently not yet supported.</li> <li>CSI Cameras from other providers can be used as long as they are supported by Picamera2.</li> <li>USB cameras connected through the Pi's USB ports are seamlessly integrated, however control options are limited, depending on their capabilities.</li> </ul>"},{"location":"features/#camera-management","title":"Camera Management","text":"<ul> <li>raspiCamSrv can detect and use all CSI and USB cameras connected to a Raspberry Pi, as long as they are identified by Picamera2, which is usually the case.</li> <li>One of these camaras must be selected as Active Camera.   Camera configuration (e.g. stream size colour space or flipping) as well as controls (e.g. focus, zoom/pan/tilt, exposure- and image-control) can be actively modified only for the Active Camera.</li> <li>Another camera, if available, can be selected as Second Camera by Multi Camera Control.</li> <li>All settings for the Active Camera can be preserved before it is replaced by another camera (e.g. by switching cameras). They will be restored/applied when this camera is set as Active Camera or as Second Camera.</li> <li>Function Reload Cameras allows hot plug-in/-out of USB cameras without server restart</li> </ul>"},{"location":"features/#camera-configuration","title":"Camera Configuration","text":"<ul> <li>raspiCamSrv supports all camera configuration options which are foreseen by Picamera2.</li> <li>Individual configuration sets can be specified for 4 different use-cases: Live View, Photo, Raw Photo and Video.</li> <li>Before the camera is started, raspiCamSrv configures all three camera streams (lowres, main, raw) for the most likely use-cases. This allows to keep the live stream (lowres) active while the camera is being used for phototaking (main), raw photo taking (raw) or video recording (main)</li> <li>If necessary, specific applications can request the camera for exclusive use.</li> <li>Support of Camera Tuning by selection and management of tuning files.</li> </ul>"},{"location":"features/#camera-control","title":"Camera Control","text":"<ul> <li>raspiCamSrv supports all Camera Control options foreseen by Picamera2.</li> <li>Focus control if supported by the camera (e.g. camera module 3 or specific USB cameras).</li> <li>Graphically drawing Autofocus Windows for CSI cameras.</li> <li>Pan / Tilt / Zoom for CSI as well as for USB cameras.</li> <li>Auto Exposure Control for CSI cameras.</li> <li>Exposure Control for CSI cameras.</li> <li>Image Control for CSI cameras as well as for USB camaras (if supported by the camera).</li> <li>NEW: Panel for Direct Control of numeric control parameters.</li> </ul>"},{"location":"features/#photo-taking-video-recording","title":"Photo Taking / Video Recording","text":"<ul> <li>Taking Photos / Raw Photos.</li> <li>Recording Video.</li> <li>Recording Audio along with the Video.</li> <li>Photo/Video metadata display.</li> <li>Photo histogram generation and display.</li> <li>Display buffer for comparison of photos and metadata/histogram.</li> <li>Photo Viewer</li> <li>Photo Download</li> <li>Photos/videos are enabled for being inspected in a separate Media Viewer window.</li> </ul>"},{"location":"features/#streaming","title":"Streaming","text":"<ul> <li>Endpoint for streaming (MJPEG) the active camera.</li> <li>Endpoint for streaming the second camera.</li> <li>Endpoints for photo snapshots of active and second camera with low resolution.</li> <li>NEW: Endpoints for photo snapshots of active and second camera with high resolution.</li> <li>Option for activating / deactivating authentication for streaming and snapshots.</li> </ul>"},{"location":"features/#multi-camera-features","title":"Multi-Camera Features","text":"<ul> <li>Selection of Active Camera and Second Camera out of connected CSI and USB cameras.</li> <li>Simultaneous streaming of both cameras.</li> <li>Simultaneous photo taking or video recording for both cameras.</li> <li>Camera switch.</li> <li>Preserving active camera configuration and controls for later reuse.</li> <li>Stereo vision support for two cameras of same model.</li> <li>Synchronization of settings for stereo cameras</li> <li>Camera calibration for stereo cameras.</li> <li>Depth Maps</li> <li>3D Video</li> </ul>"},{"location":"features/#photo-series","title":"Photo Series","text":"<ul> <li>Definition of Photo Series (# shots, interval etc.).</li> <li>Control of Photo Series (start, stop, pause, resume).</li> <li>Download of Photo Series.</li> <li>Timelapse Series with optional sunrise/sunset restrictions.</li> <li>Exposure Series with varying exposure time or gain (ISO).</li> <li>Exposure Series Result showing histograms.</li> <li>Focus Stack Series iterating through a range of focus settings.</li> <li>Capability for auto restart of series when Server or Raspi is restarted.</li> </ul>"},{"location":"features/#motion-detection","title":"Motion Detection","text":"<ul> <li>Scheduled Detection of Motion.</li> <li>Support for different algorithms for motion detection.</li> <li>Adjustable Sensitivity for motion detection.</li> <li>Support for Regions of Interest.</li> <li>Support for Regions of NO Interest</li> <li>Test Mode for Motion Detection.</li> </ul>"},{"location":"features/#gpio-device-management","title":"GPIO Device Management","text":"<ul> <li>Configuration of GPIO Devices.</li> <li>Testing of GPIO Devices</li> <li>Device Calibration for devices which rquire state tracking (e.g. stepper motor)</li> <li>Device control through gpiozero</li> <li>All gpiozero device types are supported in raspiCamSrv</li> <li>Own device types can be added by configuration (see Stepper Motor)</li> </ul>"},{"location":"features/#event-handling-triggers-and-actions","title":"Event Handling - Triggers and Actions","text":"<ul> <li>Configuration of Triggers</li> <li>Triggering by GPIO Input Devices (button, sensors)</li> <li>Triggering by Motion Detection</li> <li>Triggering by Camera events (photo taken, video start, video stop)</li> <li>Configuration of Actions</li> <li>Actions by GPIO Output Devices (LED, buzzer, servo, motor)</li> <li>Actions by Camera (take photo, start/stop video)</li> <li>Camera Actions in case of motion detection (video duration, photo burst)</li> <li>Notification actions (mail, mail attachments)</li> <li>Action-to-Trigger Association</li> <li>Event Viewer</li> <li>Event Calendar</li> <li>Detailed Event Information</li> <li>Event Photos / Videos with motion detection frame</li> <li>Event Photos / Videos with RoI RoNI</li> </ul>"},{"location":"features/#console-functions","title":"Console Functions","text":"<ul> <li>Freely configurable Array of Versatile Buttons</li> <li>Freely configurable Array of Action Buttons for execution of configured Actions.</li> </ul>"},{"location":"features/#api","title":"API","text":"<ul> <li>Selected functions of raspiCamSrv are accessible through specific Web Service End Points</li> <li>API access is secured through JSON Web Tokens (JWT).</li> <li>A Postman collection is available for testing</li> <li>A specific API (probe) is available for 'probing' attribute values of raspiCamSrv live objects.</li> </ul>"},{"location":"features/#privacy-protection","title":"Privacy Protection","text":"<ul> <li>raspiCamSrv access requires registered users</li> <li>The Superuser can manage other users: create, remove, reset password</li> <li>Login requires a password</li> <li>For streaming, it is possible to disable the necessity of authentication</li> <li>API access is secured through JSON Web Tokens (JWT).</li> <li>Secrets (mail account, JWT secret key) are held in a separate secrets store which is not part of the persisted configuration data.</li> </ul>"},{"location":"features/#configuration-management","title":"Configuration Management","text":"<ul> <li>Configuration Management refers to the way how raspiCamSrv handles its operational data which may be modified during user sessions.</li> <li>On request, all data of the raspiCamSrv server can be persisted as JSON files</li> <li>Optionally, the server can start with the stored configuration or with an initialized setup.</li> <li>An indicator shows when configuration data have been modified during a session.</li> <li>All modifications, which have not yet been saved, are listed in a dialog.</li> <li>You can create backups of entire configuration sets and restore them at another time.</li> </ul>"},{"location":"features/#system-information","title":"System Information","text":"<ul> <li>Information on the Raspberry Pi System, the raspiCamSrv software stack and the connected cameras is shown on the Info / Installed Cameras screen.</li> <li>Properties of the Active Camera are also shown.</li> <li>In addition, the Info Menu provides also details for the individual Sensor Modes of the Active Camera.</li> </ul>"},{"location":"features/#no-camera","title":"No Camera","text":"<ul> <li>raspiCamSrv can operate in a special mode when no camera is connected.</li> <li>In this case, all camera-related features are invisible.</li> <li>Functions which do not require a camera, remain available: GPIO devices, Event Handling, Console.</li> </ul>"},{"location":"features/#supervision","title":"Supervision","text":"<ul> <li>For error analysis, Logging can be activated on module level.</li> <li>In order to inspect the interface of raspiCamSrv with Picamera2, it is possible to activate Generation of Python Code for the Camera. This will create an executable Python file including all Picamera2 calls.</li> </ul>"},{"location":"features/#known-issues","title":"Known Issues","text":"<ul> <li>In Safari (e.g. on an iPad), there is still an issue with the Live Screen:    Due to the specific timing of the onload event, AF Windows may not be visible immediately after the page has been loaded. If you just 'pull' the entire window down for a short time (don't touch the AF Windows canvas), they will show up.   If the Live stream does not show up (e.g. after visiting another screen), take a photo and then push Hide/Show. This will show the live stream.</li> <li>There may be an issue configuring specific sensor modes or stream sizes for the Live View in Config. As a result, the live view will not show up and the server log will show an exception. You may need to reset the server (see Reset Server)This is already fixed but may not yet be available in your environment (see picamera2 Issue #959)</li> </ul>"},{"location":"features/#limitations","title":"Limitations","text":"<p>The software is still being tested and extended.</p> <ul> <li>Hot plug of CSI cameras is not supported. This will require rebooting the Raspberry Pi (Hot plug of USB cameras is supported).</li> <li>Hot plug of USB cameras is possible but requires to Reload Cameras.    Hot plug-out of a USB camera should be avoided when the camera is active. This will produce exceptions.</li> <li>Although the layout is responsive, it may not be \"good-looking\" with all sizes of browser windows</li> </ul>"},{"location":"features/#credits","title":"Credits","text":"<ul> <li>Most technical information on Picamera2 (https://github.com/raspberrypi/picamera2) has been taken from the Raspberry Pi - The Picamera2 Library document.</li> <li>The implementation of live streaming with Flask has been inspired by https://blog.miguelgrinberg.com/post/video-streaming-with-flask</li> <li>The detailed solution for the mjpeg_server is based on the example mjpeg_server.py of the picamera2 repository</li> <li>The solution for drawing on the canvas for definition of AF Windows has been inspired by https://codepen.io/AllenT871/pen/GVyXKp</li> <li>The Extended Motion Capturing Algorithms are based on work done by Isaac Berrios, published under Introduction to Motion Detection: Part 1 - 3  The algorithm code has been taken from this source as well as its GitHub Repository and integrated into the raspiCamSrv environment.</li> <li>raspiCamSrv uses the gpiozero library for interfacing GPIO-connected devices.</li> </ul>"},{"location":"getting_started_overview/","title":"Getting started with raspiCamSrv","text":"<ol> <li>Check requirements</li> <li>Setup the system for raspiCamSrv</li> <li>Install raspiCamSrv</li> </ol>"},{"location":"getting_started_overview/#manual-step-by-step-installation","title":"Manual Step-by-Step Installation","text":"<p>The following procedures can be applied if an individual installation is intended or if the automatic installation fails:</p> <ol> <li>Manual installation of raspiCamSrv</li> <li>Manual Service Configuration</li> </ol>"},{"location":"getting_started_overview/#alternatives","title":"Alternatives","text":"<ul> <li>Running raspiCamSrv as Docker container</li> <li>Setup of Raspberry Pi Zero as Standalone System</li> </ul>"},{"location":"getting_started_overview/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Trouble Shooting Guide</li> </ul>"},{"location":"installation/","title":"RaspiCamSrv Installation","text":"<p>The following description refers to the initial installation.   If you want to update an existing installation to the latest version, see Update Procedure.</p> <ol> <li>Connect to the Pi using SSH: <code>ssh &lt;user&gt;@&lt;host&gt;</code>with <code>&lt;user&gt;</code> and <code>&lt;host&gt;</code> as specified during setup with Imager.</li> <li>Make sure that the system is up to date<code>sudo apt update</code> <code>sudo apt full-upgrade</code></li> <li>Run the automatic installer with:     <code>bash &lt;(curl -fsSL https://raw.githubusercontent.com/signag/raspi-cam-srv/main/scripts/install_raspiCamSrv.sh)</code></li> <li>When the installer has finished successfully, open a browser and connect to raspiCamSrv using the indicated URL.</li> <li>Before you can login, you first need to register.The first user will automatically be SuperUser who can later register other users (User Management)</li> <li>After successful log-in, the Live screen will be shown, if at least one camera is connected, otherwise the Info screen.</li> <li>For usage of raspiCamSrv, please refer to the User Guide</li> </ol>"},{"location":"installation/#installer","title":"Installer","text":"<p>The installer will automatically execute the procedure described for manual installation as well as service configuration.</p> <p>At the beginning, you will be asked if you need to record audio along with video.   If you answer \"y\", the installer will install raspiCamSrv as user service, otherwise as system service.   (See Recording Audio along with Video).</p> <p>The steps shown in the installer protocol correspond to the steps of manual installation.</p> <p>You can run the installer multiple times without any risk.   It will skip steps which were already completed and complete or update the installation.</p> <p>In case of problems during installation and usage, see Troubleshooting or try the manual installation procedure.</p>"},{"location":"installation/#supervision","title":"Supervision","text":"<p>You can check the system logs with   <code>sudo journalctl -ef</code></p> <p>When the Flask server starts up, it will show a warning that this is a development server.  This is, in general, fine for private environments.  How to deploy with a production WSGI server, is described in the Flask documentation</p> <pre><code>Dec 09 18:49:19 raspi06 python[9642]:  * Serving Flask app 'raspiCamSrv'\nDec 09 18:49:19 raspi06 python[9642]:  * Debug mode: off\nDec 09 18:49:19 raspi06 python[9642]: WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.\nDec 09 18:49:19 raspi06 python[9642]:  * Running on all addresses (0.0.0.0)\nDec 09 18:49:19 raspi06 python[9642]:  * Running on http://127.0.0.1:5000\nDec 09 18:49:19 raspi06 python[9642]:  * Running on http://192.168.178.72:5000\nDec 09 18:49:19 raspi06 python[9642]: Press CTRL+C to quit\n\n</code></pre>"},{"location":"installation/#manually-starting-the-server","title":"Manually Starting the Server","text":"<ol> <li>Stop the service   <code>sudo systemctl stop raspiCamSrv</code>  (In case of a system unit)   <code>systemctl --user stop raspiCamSrv</code>  (In case of a user unit)</li> <li>Go to the install directory   <code>cd ~/prg/raspi-cam-srv</code></li> <li>Activate the virtual environment   <code>.venv/bin/activate</code></li> <li>Start raspiCamSrv   <code>python -m flask --app raspiCamSrv run --port 5000 --host=0.0.0.0</code></li> </ol>"},{"location":"installation/#uninstalling-raspicamsrv","title":"Uninstalling raspiCamSrv","text":"<ol> <li>Connect to the Pi using SSH: <code>ssh &lt;user&gt;@&lt;host&gt;</code></li> <li>Run the automatic uninstaller with:   <code>bash &lt;(curl -fsSL https://raw.githubusercontent.com/signag/raspi-cam-srv/main/scripts/uninstall_raspiCamSrv.sh)</code></li> </ol>"},{"location":"installation_man/","title":"Manual raspiCamSrv Installation","text":"<p>The following procedure describes a manual step by step installation.   For automatic installation, see RaspiCamSrv Installation.</p> <p>If you want to update an existing installation to the latest version, see Update Procedure.</p> <p>In case of problems during installation and usage, see Troubleshooting</p> <p>NOTE: For Debian-Trixie, some of the required packages are already preinstalled. To ensure everything is consistently installed in and run from the raspiCamSrv virtual environment, the respective <code>pip install</code> commands, below, have been extended with a <code>--ignore-installed</code> clause and the Flask server is started with <code>python -m flask ...</code></p> <ol> <li>Connect to the Pi using SSH: <code>ssh &lt;user&gt;@&lt;host&gt;</code>with  and  as specified during setup with Imager. <li>Update the system<code>sudo apt update</code> <code>sudo apt full-upgrade</code></li> <li>If you intend to take videos and have installed a lite version of the OS, you may need to install ffmpeg:Check whether ffmpeg is installed with<code>which ffmpeg</code>If you get an empty response, install with<code>sudo apt install ffmpeg</code></li> <li>Create a root directory under which you will install programs (e.g. 'prg')<code>mkdir prg</code><code>cd prg</code></li> <li>Check that git is installed (which is usually the case in current Bullseye, Bookworm or Trixie distributions)<code>git --version</code>If git is not installed, install it with<code>sudo apt install git</code></li> <li>Clone the raspi-cam-srv repository:<code>git clone --branch main --single-branch --depth 1 https://github.com/signag/raspi-cam-srv</code></li> <li>Create a virtual environment ('.venv') on the 'raspi-cam-srv' folder:<code>cd raspi-cam-srv</code><code>python -m venv --system-site-packages .venv</code>For the reasoning to include system site packages, see the picamera2-manual.pdf, chapter 9.5.</li> <li>Activate the virtual environment<code>cd ~/prg/raspi-cam-srv</code><code>source .venv/bin/activate</code>The active virtual environment is indicated by <code>(.venv)</code> preceeding the system prompt.(If you need to leave the virtual environment at some time, use <code>deactivate</code>)</li> <li>Trixie: Skip this step!Make sure that picamera2 is available on the system:<code>python</code><code>&gt;&gt;&gt;import picamera2</code><code>&gt;&gt;&gt;quit()</code>If you get a 'ModuleNotFoundError', see the picamera2 Manual, chapter 2.2, how to install picamera2.For raspiCamSrv it would be sufficient to install without GUI dependencies:<code>sudo apt install -y python3-picamera2 --no-install-recommends</code></li> <li>Install Flask 3.x with the virtual environment activated (Step 8).Raspberry Pi OS distributions come with Flask preinstalled, however we need to run Flask from the virtual environment in order to see other packages which will be located there.<code>pip install --ignore-installed \"Flask&gt;=3,&lt;4\"</code>Make sure that Flask is really installed in the virtual environment:<code>which flask</code> should output<code>/home/&lt;user&gt;/prg/raspi-cam-srv/.venv/bin/flask</code></li> <li>Optional installations:The following installations are only required if you need to visualize histograms of photos or if you are interested in using Extended Motion Capturing Algorithms or Stereo Vision.For use of USB cameras, OpenCV is required.All installations must be done with the virtual environment activated (Step 8)Install OpenCV: <code>sudo apt-get install python3-opencv</code>Install numpy: <code>pip install --ignore-installed numpy</code>(There may be errors, which normally can be ignored)Install matplotlib: Trixie:<code>pip install --ignore-installed matplotlib</code>(There may be errors, which normally can be ignored) Bookworm: <code>pip install --ignore-installed \"matplotlib&lt;3.8\"</code>(The version restriction assures compatibility with numpy 1.x which is required for Picamera2)The following installation is required for enabling the raspiCamSrv APIInstall flask-jwt-extended: <code>pip install --ignore-installed flask-jwt-extended</code>(There may be errors, which normally can be ignored)</li> <li>Initialize the database for Flask (with <code>raspi-cam-srv</code> as active directory and the virual environment activated - see step 8):<code>python -m flask --app raspiCamSrv init-db</code></li> <li>Check that the Flask default port 5000 is available<code>sudo netstat -nlp | grep 5000</code>If an entry is shown, find another free port (e.g. 5001) and replace <code>port 5000</code> by your port in all <code>flask</code> commands, below and also in the URL in step 12.</li> <li>Start the server(with <code>raspi-cam-srv</code> as active directory and the virual environment activated - see step 8):<code>python -m flask --app raspiCamSrv run --port 5000 --host=0.0.0.0</code></li> <li>Connect to the server from a browser:<code>http://&lt;raspi_host&gt;:5000</code>This will open the Login screen.</li> <li>Before you can login, you first need to register.The first user will automatically be SuperUser who can later register other users (User Management)</li> <li>After successful log-in, the Live screen will be shown, if at least one camera is connected, otherwise the Info screen.</li> <li>Done!</li> <li>For usage of raspiCamSrv, please refer to the User Guide</li> <p>When the Flask server starts up, it will show a warning that this is a development server.  This is, in general, fine for private environments.  How to deploy with a production WSGI server, is described in the Flask documentation</p>"},{"location":"picamera2_manual/","title":"Picamera2 Manual","text":"<p>The Picamera2 Library</p>"},{"location":"requirements/","title":"Requirements","text":"<ul> <li>A Raspberry Pi (Zero W, Zero 2 W, Pi 1, Pi 3, Pi 4, Pi 5)</li> <li>A Raspberry Pi camera</li> <li>A suitable camera cable (Pi Zero W, Pi Zero 2 W and Pi 5 have the small CSI-2 camera port, requiring a special cable which is usually not shipped with the camera)</li> <li>A microSD card</li> <li>A suitable power supplyFor Pi Zero W or Pi Zero 2 W, a normal mobile phone charger is sufficient as long as it has a Micro-USB connector</li> <li>Optionally, a case for the specific model may ease handling.For Pi Zero W or Zero 2 W, offerings for the official case (e.g. here) should include a special short (38 mm) camera cable.The cover for the camera is fine for camera models 1 and 2. For camera model 3, some handwork is necessary to enlarge the hole to a square for the camera body.Alternatively, there are various 3D printable variants, e.g. Case for Raspberry Pi Zero Models with Camera.</li> <li>A Wifi network with internet access and known access credentials (SSID, password)</li> <li>A PC or Mac with network access and (micro)SD card reader</li> </ul> <p>The setup description, assumes a completely autonomous or 'headless' setup, where the Raspberry Pi requires nothing but a power supply cable without any necessity to ever connect it to a display, keyboard or mouse.   </p> Official Pi Zero Case with Camera m\u00f3del 2 3D-printed case suitable for tripod-mounting"},{"location":"service_configuration/","title":"Service Configuration","text":"<p>NOTE: This installation step is included in the automatic installation</p> <p>When the Flask server is started in a SSH session as described in Installation Step 11, it will terminate with the SSH session.</p> <p>Instead, you may want the server to start up independently from any user sessions, restart after a failure and automatically start up when the device is powered up.</p> <p>In order to achieve this, the Flask server start can be configured as service under control of systemd.</p> <p>The following procedure is for the case where audio recording with video is not required. Otherwise, see next section.</p> <ol> <li>Open a SSH session on the Raspberry Pi</li> <li>Copy the service template raspiCamSrv.service which is provided with raspiCamSrv to your home directory<code>cp ~/prg/raspi-cam-srv/config/raspiCamSrv.service ~</code> </li> <li>Adjust the service configuration:<code>nano ~/raspiCamSrv.service</code>Replace all (4) occurrences of '<code>&lt;user&gt;</code>' with the user ID, specified during System SetupIf you need a port different from 5000 (see RaspiCamSrv Installation, step 11), replace also <code>port 5000</code> by your port.</li> <li>Stage the service configuration file to systemd:<code>sudo cp ~/raspiCamSrv.service /etc/systemd/system</code></li> <li>Start the service:<code>sudo systemctl start raspiCamSrv.service</code></li> <li>Check that the Flask server has started as service:<code>sudo journalctl -ef</code></li> <li>Enable the service so that it automatically starts with system boot:<code>sudo systemctl enable raspiCamSrv.service</code></li> <li>Reboot the system to test automatic server start:<code>sudo reboot</code></li> </ol>"},{"location":"service_configuration/#service-configuration-for-audio-support","title":"Service Configuration for Audio Support","text":"<p>If it is intended to record audio along with videos, a slightly different setup is required (see Settings):  Instead of installing the service as a system unit, it needs to be installed as user unit (see systemd/User) in order to get access to PulseAudio.</p>"},{"location":"service_configuration/#trixie-and-bookworm-systems","title":"Trixie and Bookworm Systems","text":"<p>If your system is a trixie or a bookworm system (<code>lsb_release -a</code>) follow these steps:</p> <ol> <li>Open a SSH session on the Raspberry Pi</li> <li>Copy the service template raspiCamSrv.service which is provided with raspiCamSrv to your home directory<code>cp ~/prg/raspi-cam-srv/config/raspiCamSrv.service ~</code> </li> <li>Adjust the service configuration:<code>nano ~/raspiCamSrv.service</code>Replace all (4) occurrences of '<code>&lt;user&gt;</code>' with the user ID, specified during System SetupIf necessary, raplace also the standard port 5000 with your port.Remove the entry User=<code>&lt;user&gt;</code> from the [System] sectionIn section [Install], change <code>WantedBy=multi-user.target</code> to <code>WantedBy=default.target</code></li> <li>Create the directory for systemd user units<code>mkdir -p ~/.config/systemd/user</code></li> <li>Stage the service configuration file to systemd for user units:<code>cp ~/raspiCamSrv.service ~/.config/systemd/user</code></li> <li>Start the service:<code>systemctl --user start raspiCamSrv.service</code></li> <li>Check that the Flask server has started as service:<code>journalctl --user -ef</code>If you get <code>No journal files were found.</code>, try<code>sudo journalctl -ef</code></li> <li>Enable the service so that it automatically starts with a session for the active user:<code>systemctl --user enable raspiCamSrv.service</code></li> <li>Enable lingering in order to start the unit right after boot and keep it running independently from a user session<code>loginctl enable-linger</code></li> <li>Reboot the system to test automatic server start:<code>sudo reboot</code></li> </ol>"},{"location":"service_configuration/#bullseye-systems","title":"Bullseye Systems","text":"<p>If your system is a bullseye system (<code>lsb_release -a</code>), which is currently still the case for Pi Zero, follow these steps:</p> <ol> <li>Open a SSH session on the Raspberry Pi</li> <li>Clone branch 0_3_12_next of Picamera2 repository<code>cd ~/prg</code><code>git clone -b 0_3_12_next https://github.com/raspberrypi/picamera2</code></li> <li>Copy the service template raspiCamSrv.service which is provided with raspiCamSrv to your home directory<code>cp ~/prg/raspi-cam-srv/config/raspiCamSrv.service ~</code> </li> <li>Adjust the service configuration:<code>nano ~/raspiCamSrv.service</code>- Replace '<code>&lt;user&gt;</code>' with the user ID, specified during System Setup- If necessary, raplace also the standard port 5000 with your port.- Add another Environment entry: <code>Environment=\"PYTHONPATH=/home/&lt;user&gt;/prg/picamera2\"</code>- Remove the entry User=<code>&lt;user&gt;</code> from the [System] section- In section [Install], change <code>WantedBy=multi-user.target</code> to <code>WantedBy=default.target</code>For an example of the final .service file, see below</li> <li>Create the directory for systemd user units<code>mkdir -p ~/.config/systemd/user</code></li> <li>Stage the service configuration file to systemd for user units:<code>cp ~/raspiCamSrv.service ~/.config/systemd/user</code></li> <li>Start the service:<code>systemctl --user start raspiCamSrv.service</code></li> <li>Check that the Flask server has started as service:<code>journalctl --user -e</code></li> <li>Enable the service so that it automatically starts with a session for the active user:<code>systemctl --user enable raspiCamSrv.service</code></li> <li>Enable lingering in order to start the unit right after boot and keep it running independently from a user session<code>loginctl enable-linger</code></li> <li>Reboot the system to test automatic server start:<code>sudo reboot</code></li> </ol>"},{"location":"service_configuration/#example-service-configuration","title":"Example Service Configuration","text":"<p>Below is an example .service specification for user \"sn\":</p> <pre><code>[Unit]\nDescription=raspiCamSrv\nAfter=network.target\n\n[Service]\nExecStart=/home/sn/prg/raspi-cam-srv/.venv/bin/flask --app raspiCamSrv run --port 5000 --host=0.0.0.0\nEnvironment=\"PATH=/home/sn/prg/raspi-cam-srv/.venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\"\nEnvironment=\"PYTHONPATH=/home/sn/prg/picamera2\"\nWorkingDirectory=/home/sn/prg/raspi-cam-srv\nStandardOutput=inherit\nStandardError=inherit\nRestart=always\n\n[Install]\nWantedBy=default.target\n</code></pre>"},{"location":"system_setup/","title":"System Setup for raspiCamSrv","text":"<p>Follow the instructions of the Raspberry Pi Getting Started Documentation for OS installation using Imager.   </p> <p>NOTE: It is strongly recommended to install the Debian distribution recommended by Imager for your Raspberry Pi device. This is usually the full 64-bit version including desktop.    Lite versions usually miss essential parts of the software stack required by raspiCamSrv.    </p> <p>Make sure that SSH is enabled on the Services tab.</p> <p>Once the SD card is written, insert it into the Raspberry Pi and power it up.  Initially, it will take several minutes until it is visible in the network.</p>"},{"location":"updating_raspiCamSrv/","title":"Updating raspiCamSrv","text":"<p>Before updating, make sure that</p> <ul> <li>video recording is stopped</li> <li>there are no active photoseries</li> <li>triggered capture (motion tracking) is stopped</li> <li>server will not start with stored configuration</li> </ul> <p>The Settings/Update dialog is the easiest way for updating. </p> <p>Alternatively, you can configure Versatile Buttons for the commands described in the following, so that update and server restart can be initiated directly from the Web UI.</p> <p>For update, proceed as follows:   (If running a Docker container see Update Procedure for Docker Container)</p> <ol> <li>Within a SSH session go to the raspiCamSrv root directory   <code>cd ~/prg/raspi-cam-srv</code></li> <li>If you have made local changes (e.g. logging), you may need to reset the workspace with  <code>git reset --hard</code></li> <li>If you have created unversioned files, you may need to clean the workspace with  <code>git clean -fd</code></li> <li>Use git fetch to update to the latest version    (normally you need to fetch only the <code>main</code> branch)    <code>git fetch origin main --depth=1</code>  As a result, you will see a summary of changes with respect to the previously installed version.</li> <li>Use git reset to reset the current branch head to origin/main   <code>git reset --hard origin/main</code>  As a result, you will see the new HEAD version.</li> <li>Restart the service, depending on how the service was installed <code>sudo systemctl restart raspiCamSrv.service</code>  or   <code>systemctl --user restart raspiCamSrv.service</code></li> <li>Check that the service started correctly    <code>sudo journalctl -e</code>  or   <code>journalctl --user -e</code></li> <li>If you used start with stored configuration before updating, you may now try to activate this again.In cases where configuration parameters were not modified with the update, this will usually work.If not, you will need to prepare and store your preferred configuration again.</li> </ol> <p>In case that the server did not start correctly or if you see an unexpected behavior in the UI, you may have forgotten to deactivate start with stored configurationIn this case, you can do the following:</p> <ul> <li><code>cd ~/prg/raspi-cam-srv/raspiCamSrv/static/config</code></li> <li>Check whether a file <code>_loadConfigOnStart.txt</code> exists in this folder.</li> <li>If it exists, remove it:<code>rm _loadConfigOnStart.txt</code></li> <li>Then repeat step 4, above</li> </ul>"},{"location":"gpioDevices/StepperMotor/","title":"StepperMotor","text":"<pre><code>class StepperMotor(*args, **kwargs)\n</code></pre> <p>extends <code>gpiozero.OutputDevice</code> and represents a generic stepper motor connected to a stepper motor driver.   An example combination, for which this class has been developped and tested, is the stepper motor 28BYJ-48 with the motor driver ULN2003A.</p> <ol> <li>Plug in the 5-cable jack of the motor into the socket of the motor driver.   </li> <li>Connect the 4 inputs on the motor driver (IN1 ... IN4) to 4 GPIO pins of the Raspberry Pi.It is important to correctly memorize which pin is connected to which input.</li> <li>Connect the power input of the motor driver to Raspberry Pi 5V and GND pins with the correct polarity.</li> </ol> <p>The following code will rotate the motor counter-clockwise (from the perspective of the motor) by 15\u00b0:</p> <pre><code>from raspiCamSrv.gpioDevices import StepperMotor\nstepper = StepperMotor(6, 13, 19, 26)\nstepper.rotate(-15)\nstepper.close()\n</code></pre>"},{"location":"gpioDevices/StepperMotor/#parameters","title":"Parameters","text":"<ul> <li>in1 (int) - The GPIO pin that the motor drivers IN1 pin is connected to</li> <li>in2 (int) - The GPIO pin that the motor drivers IN2 pin is connected to</li> <li>in3 (int) - The GPIO pin that the motor drivers IN3 pin is connected to</li> <li>in4 (int) - The GPIO pin that the motor drivers IN4 pin is connected to</li> <li>mode (int) The mode in which the motor is operated.Can be <code>0</code> (the default) for selecting half step mode with a resolution of 8 steps per full turn or <code>1</code> for full step mode with 4 steps per turn.</li> <li>speed (float) - The speed with which the motor is operated. The speed is controlled through waiting times between successive steps.A value of <code>0.0</code> results in the lowest speed with a waiting time of 4 ms and a value of <code>1.0</code> (the default) results in the highest speed with a waiting time of 1ms.Values outside of this interval will be set to the nearest interval border.</li> <li>current_angle - (float) The current angle of the motor. Defaults to 0.0</li> <li>swing_from - (float) left boundary angle for swinging. Defaults to -45.0</li> <li>swing_to - (float) right boundary angle for swinging. Defaults to 45.0</li> <li>swing_step - (float) step width for swinging. Defaults to 9.0</li> <li>swing_direction - (int) current swing direction. 1 (default) clockwise, 0 counter-clockwise.</li> <li>stride_angle - (float) The angle incremet for a single step after gearing.The default value of 5.625 is the value for the 28BYJ-48 motor.</li> <li>gear_reduction (int) - The inverse of the transmission ratio of the gear box.The default value of 64 is the value of the 1/64 ratio for the 28BYJ-48 motor.</li> </ul>"},{"location":"gpioDevices/StepperMotor/#property-mode","title":"property mode","text":"<p>Returns or sets the mode of operation.</p>"},{"location":"gpioDevices/StepperMotor/#property-speed","title":"property speed","text":"<p>Returns or sets the speed.</p> <p>Allowed values range from 0 for lowest speed (164.20 seconds for 360\u00b0) to 1 for highest speed (4.24 seconds for 360\u00b0)</p>"},{"location":"gpioDevices/StepperMotor/#property-stride_angle","title":"property stride_angle","text":"<p>Returns the stride angle.</p>"},{"location":"gpioDevices/StepperMotor/#property-gear_reduction","title":"property gear_reduction","text":"<p>Returns the gear_reduction</p>"},{"location":"gpioDevices/StepperMotor/#property-current_angle","title":"property current_angle","text":"<p>Returns or sets the current angle.   When the class is initiated, the angle is set to zero.   Every motor movement will update the current angle.  For step, step_forward and step_backward, the current angle will stay within (-360 &lt;= current_angle &lt;= 360).   For the rotate and swing methods, current_angle* is not restricted to these limits, which allows tracking of multiple turns.</p>"},{"location":"gpioDevices/StepperMotor/#property-value","title":"property value","text":"<p>Returns or sets the current angle.    </p>"},{"location":"gpioDevices/StepperMotor/#property-swing_from","title":"property swing_from","text":"<p>Returns or sets the left boundary for swinging in degree (-360 - 0).    </p>"},{"location":"gpioDevices/StepperMotor/#property-swing_to","title":"property swing_to","text":"<p>Returns or sets the right boundary for swinging in degree (0 - 360).    </p>"},{"location":"gpioDevices/StepperMotor/#property-swing_step","title":"property swing_step","text":"<p>Returns or sets the step width for swinging in degree (0 - 360).</p>"},{"location":"gpioDevices/StepperMotor/#property-swing_direction","title":"property swing_direction","text":"<p>Returns or sets the current swinging direction. 1=right, -1=left</p>"},{"location":"gpioDevices/StepperMotor/#stepsteps","title":"step(steps=?)","text":"<p>Steps forward for positive and backward for negative argument by the given number of steps.   Thus, the angle is changed by steps x stride_angle.  When using this method, </p> <p>Parameters:</p> <ul> <li>steps (int) Number of steps to move (positive or negative)</li> </ul>"},{"location":"gpioDevices/StepperMotor/#step_forwardsteps","title":"step_forward(steps=?)","text":"<p>Steps forward (clockwise rotation) by the given number of steps.   Thus, the angle is increased by steps x stride_angle</p> <p>Parameters:</p> <ul> <li>steps (int) Number of steps to move forward (positive value)</li> </ul>"},{"location":"gpioDevices/StepperMotor/#step_backwardsteps","title":"step_backward(steps=?)","text":"<p>Steps backward (anti-clockwise rotation) by the given number of steps.   Thus, the angle is decreased by steps x stride_angle</p> <p>Parameters:</p> <ul> <li>steps (int) Number of steps to move backward (positive palue)</li> </ul>"},{"location":"gpioDevices/StepperMotor/#rotateangle","title":"rotate(angle=?)","text":"<p>Rotate clockwise (for positive angle) or counter-clockwise (for negative angle) by the given angle.</p> <p>Parameters:</p> <ul> <li>angle (float) Angle to rotate (positive or negative)</li> </ul>"},{"location":"gpioDevices/StepperMotor/#rotate_rightangle","title":"rotate_right(angle=?)","text":"<p>Rotate right (clockwise from the pespective of the motor) by the given angle.</p> <p>Parameters:</p> <ul> <li>angle (float) Angle to rotate (positive)</li> </ul>"},{"location":"gpioDevices/StepperMotor/#rotate_leftangle","title":"rotate_left(angle=?)","text":"<p>Rotate left (anti-clockwise from the pespective of the motor) by the given angle.</p> <p>Parameters:</p> <ul> <li>angle (float) Angle to rotate (positive)</li> </ul>"},{"location":"gpioDevices/StepperMotor/#rotate_totarget","title":"rotate_to(target=?)","text":"<p>Rotate to the given angle.</p> <p>Parameters:</p> <ul> <li>target (float) Angle to rotate to</li> </ul>"},{"location":"gpioDevices/StepperMotor/#swing","title":"swing()","text":"<p>Do one swing step in the current swing_direction with the current swing_step. If the current_angle would exceed swing_from or swing_to, rotation will reverse its direction at the border.</p> <p>Parameters:</p> <ul> <li>angle (float) Angle to rotate (positive)</li> </ul>"},{"location":"gpioDevices/StepperMotor/#wipeangle_from-angle_to-speed-count","title":"wipe(angle_from=?, angle_to=?, speed=?, count=?)","text":"<p>Wipe back and forth within a given range of angles with the given speed.</p> <p>With the count parameter you can specify a certain number of cycles.   in case of count=0, swiping will continue until stop is called.</p> <p>After termination, the motor returns to the starting position.</p> <p>Parameters:</p> <ul> <li>angle_from (float) Start angle (defaults to -45.0)</li> <li>angle_to (float) End angle (defaults to 45.0)</li> <li>speed (float) Speed to be used for swiping. Can be in the range from 0 (slow) to 1 (fast). Default is 0.</li> <li>count (int) Number of cycles. A value of 0 will cause infinite swiping which needs to be stopped with stop()</li> </ul>"},{"location":"gpioDevices/StepperMotor/#stop","title":"stop()*","text":"<p>Terminate swiping after the active cycle is finished.</p>"},{"location":"gpioDevices/StepperMotor/#close","title":"close()","text":"<p>Shut down the device and release all associated resources (such as GPIO pins). </p>"}]}